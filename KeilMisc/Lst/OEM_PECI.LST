C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE OEM_PECI
OBJECT MODULE PLACED IN Code\Oem\OEM_PECI.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\c51.exe Code\Oem\OEM_PECI.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR(.\Code\CORE\IN
                    -CLUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\)

line level    source

   1          /*-----------------------------------------------------------------------------
   2           * TITLE: OEM_PECI.C
   3           *
   4           * Author : Dino
   5           *
   6           * Note : These functions are reference only.
   7           *        Please follow your project software specification to do some modification.
   8           *---------------------------------------------------------------------------*/
   9          
  10          #include <CORE_INCLUDE.H>
  11          #include <OEM_INCLUDE.H>
  12          
  13          //-----------------------------------------------------------------------
  14          // Init Enable PECI interface function
  15          //-----------------------------------------------------------------------
  16          void Init_PECI(void)
  17          {
  18   1          //GPCRF6 = ALT;                      
  19   1          //GCR2 |= PECIE;      // Enable PECI
  20   1      }
  21          
  22          //-----------------------------------------------------------------------
  23          // Init Enable PECI interface function
  24          //-----------------------------------------------------------------------
  25          void PECI_Enable(void)
  26          {
  27   1          //GPCRF6 = ALT;   
  28   1      }
  29          
  30          //-----------------------------------------------------------------------
  31          // Init Disable PECI interface function
  32          //-----------------------------------------------------------------------
  33          void PECI_Disable(void)
  34          {
  35   1          //GPCRF6 = INPUT;   
  36   1      }
  37          
  38          //-----------------------------------------------------------------------
  39          // Init timer1 for interface time-out
  40          //-----------------------------------------------------------------------
  41          void PECI_InitTimeOutTimer(void)
  42          {
  43   1          TR1 = 0;                    // Disable timer1
  44   1          ET1 = 0;                    // Disable timer1 interrupt
  45   1          _nop_();
  46   1          _nop_();
  47   1          _nop_();
  48   1          _nop_();
  49   1          TH1 = Timer_30ms>>8;        // Set timer1 counter 30ms
  50   1          TL1 = Timer_30ms;           // Set timer1 counter 30ms
  51   1          TF1 = 0;                    // Clear overflow flag
  52   1          TR1 = 1;                    // Enable timer1
  53   1      }
  54          
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 2   

  55          //-----------------------------------------------------------------------
  56          // CRC-8 polynomial
  57          //-----------------------------------------------------------------------
  58          void PECI_CalcCRC8(BYTE sourcebyte)
  59          {
  60   1      #if PECI_Softwave_AWFCS    
                  BYTE temp;
                      PECI_CRC8 ^=sourcebyte;
                  temp = PECI_CRC8;
              
                  if(IS_MASK_CLEAR(temp, BIT7))
                  {
                      temp = temp<<1;
                      PECI_CRC8 ^= temp;
                  }
                  else
                  {
                      temp = temp<<1;
                      PECI_CRC8 ^= 0x09;
                      PECI_CRC8 ^= temp;
                  }
                  
                  if(IS_MASK_CLEAR(temp, BIT7))
                  {
                      temp = temp<<1;
                      PECI_CRC8 ^= temp;
                  }
                  else
                  {
                      temp = temp<<1;
                      PECI_CRC8 ^= 0x07;
                      PECI_CRC8 ^= temp;
                  }
              #endif    
  89   1      }
  90          
  91          //-----------------------------------------------------------------------
  92          // Enables the PECI host controller.
  93          //-----------------------------------------------------------------------
  94          void PECI_HostEnable(void)
  95          {
  96   1          HOCTLR |= (FIFOCLR+FCSERR_ABT+PECIHEN+CONCTRL);
  97   1      }
  98          
  99          //-----------------------------------------------------------------------
 100          // Disable the PECI host controller.
 101          //-----------------------------------------------------------------------
 102          void PECI_HostDisable(void)
 103          {
 104   1          HOCTLR = 0x00;
 105   1      }
 106          
 107          //-----------------------------------------------------------------------
 108          // The PECI host controller will perform the desired transaction.
 109          //-----------------------------------------------------------------------
 110          void PECI_HostControl(BYTE control)
 111          {
 112   1          HOCTLR |= control;
 113   1      }
 114          
 115          //-----------------------------------------------------------------------
 116          // Check PECI interface busy or not
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 3   

 117          // return : 
 118          //          0 : 30 ms time out
 119          //          1 : OK
 120          //-----------------------------------------------------------------------
 121          BYTE PECI_CheckHostBusy(void)
 122          {
 123   1          PECI_InitTimeOutTimer();    
 124   1      
 125   1          while (!TF1)
 126   1              { 
 127   2              if(IS_MASK_CLEAR(HOSTAR, HOBY))
 128   2              {
 129   3                  TR1=0;
 130   3                  TF1=0;
 131   3                  ET1=1;
 132   3                  break;
 133   3              }
 134   2          }
 135   1          
 136   1          if(TF1)
 137   1              {
 138   2              TR1=0;
 139   2                      TF1=0;
 140   2              ET1=1;
 141   2              return(0);
 142   2          }
 143   1          return(1);
 144   1      }
 145          
 146          //-----------------------------------------------------------------------
 147          // Check PECI interface finish or not
 148          // return : 
 149          //          0 : time-out or error
 150          //          1 : finish
 151          //-----------------------------------------------------------------------
 152          BYTE PECI_CheckHostFinish(void)
 153          {
 154   1          BYTE error;
 155   1          BYTE status,result;
 156   1          error = 0x04;           // Pre-set error
 157   1          
 158   1          PECI_InitTimeOutTimer();
 159   1          while (!TF1)
 160   1              { 
 161   2              status = HOSTAR;
 162   2      
 163   2              if(status!=0x00)
 164   2              {
 165   3                  if(IS_MASK_SET(status, FINISH))
 166   3                  {
 167   4                      error = 0x00;
 168   4                      break;
 169   4                  }
 170   3                  else if(IS_MASK_SET(status, RD_FCS_ERR))
 171   3                  {
 172   4                      error = 0x01;
 173   4                      break;
 174   4                  }
 175   3                  else if(IS_MASK_SET(status, WR_FCS_ERR))
 176   3                  {
 177   4                      error = 0x01;
 178   4                      break;
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 4   

 179   4                  }
 180   3                  else if(IS_MASK_SET(status, EXTERR))
 181   3                  {
 182   4                      SET_MASK(RSTC4,RPECI);  // Reset PECI interface
 183   4                      error = 0x02;
 184   4                      break;
 185   4                  }
 186   3                  else if(IS_MASK_SET(status, BUSERR))
 187   3                  {
 188   4                      SET_MASK(RSTC4,RPECI);  // Reset PECI interface
 189   4                      error = 0x02;
 190   4                      break;
 191   4                  }
 192   3                  else if(IS_MASK_SET(status, TEMPERR))
 193   3                  {
 194   4                      error = 0x03;
 195   4                      break;
 196   4                  }
 197   3              }
 198   2          }
 199   1      
 200   1          if(error!=0x00)
 201   1          {
 202   2              result=0x00;    // error
 203   2          }    
 204   1          else
 205   1          {
 206   2              result=0x01;    // finish
 207   2          }
 208   1      
 209   1          TR1=0;
 210   1          TF1=0;
 211   1          ET1=1;
 212   1          return(result);
 213   1      }
 214          
 215          //-----------------------------------------------------------------------
 216          // The function of clearing Host Status Register
 217          //-----------------------------------------------------------------------
 218          void ResetPECIStatus(void)
 219          {
 220   1          HOSTAR = 0xFE;
 221   1      }
 222          
 223          //-----------------------------------------------------------------------
 224          // PECI Ping function
 225          //  return : 
 226          //              1 : The targeted address of processor is able to respond
 227          //              0 : no respond
 228          //  Input : 
 229          //              (1) addr : The address of processor
 230          //              (2) ReadLen read length always 0
 231          //              (3) WriteLen Write length always 0
 232          //-----------------------------------------------------------------------
 233          BYTE PECI_Ping(BYTE addr, BYTE ReadLen, BYTE WriteLen)
 234          {
 235   1          BYTE done;
 236   1          done = 0x00;
 237   1          
 238   1          PECI_HostEnable();
 239   1          HOTRADDR = addr;
 240   1          HOWRLR = WriteLen;
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 5   

 241   1          HORDLR = ReadLen;
 242   1          
 243   1          if(PECI_CheckHostBusy())
 244   1          {
 245   2              PECI_HostControl(START);
 246   2              if(PECI_CheckHostFinish())
 247   2              {
 248   3                  done = 0x01;
 249   3              }
 250   2          }
 251   1      
 252   1          PECI_HostDisable();
 253   1          ResetPECIStatus();
 254   1          return(done);
 255   1      }
 256          
 257          //-----------------------------------------------------------------------
 258          // PECI get temperature command
 259          //  return : 
 260          //              1 : done
 261          //              0 : error
 262          //  Input : 
 263          //              (1) addr : The address of processor
 264          //              (2) *ReadData : the start address of variable to save data
 265          //              (3) ReadLen read length always 8
 266          //              (4) WriteLen Write length always 1
 267          //-----------------------------------------------------------------------
 268          BYTE PECI_GetDIB(BYTE addr, XBYTE *ReadData, BYTE ReadLen, BYTE WriteLen)
 269          {
 270   1          BYTE done, index;
 271   1          done = 0x00;
 272   1          
 273   1          PECI_HostEnable();
 274   1          HOTRADDR = addr;
 275   1          HOWRLR = WriteLen;
 276   1          HORDLR = ReadLen;
 277   1          HOCMDR = PECI_CMD_GetDIB;
 278   1          
 279   1          if(PECI_CheckHostBusy())
 280   1          {
 281   2              PECI_HostControl(START);
 282   2              if(PECI_CheckHostFinish())
 283   2              {
 284   3                  for(index=0x00;index<HORDLR;index++)
 285   3                  {
 286   4                      *(ReadData+index)=HORDDR;
 287   4                  }
 288   3                  done = 0x01;
 289   3              }
 290   2          }
 291   1      
 292   1          PECI_HostDisable();
 293   1          ResetPECIStatus();
 294   1          return(done);
 295   1      }
 296          
 297          //-----------------------------------------------------------------------
 298          // PECI get temperature command
 299          //  return : 
 300          //              1 : done
 301          //              0 : error
 302          //  Input : 
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 6   

 303          //              (1) addr : The address of processor
 304          //              (2) *ReadData : the start address of variable to save data
 305          //              (3) Domain : 0 or 1¡C 
 306          //                           0 : Domain 0, 1 : Domain 1¡C
 307          //              (4) ReadLen read length always 2
 308          //              (5) WriteLen Write length always 1
 309          //-----------------------------------------------------------------------
 310          BYTE PECI_GetTemp(BYTE addr, XBYTE *ReadData, BYTE Domain, BYTE ReadLen, BYTE WriteLen)
 311          {
 312   1          BYTE done;
 313   1          done = 0x00;
 314   1          
 315   1          PECI_HostEnable();
 316   1          HOTRADDR = addr;
 317   1          HOWRLR = WriteLen;
 318   1          HORDLR = ReadLen;
 319   1          if(Domain<2)
 320   1          {
 321   2              HOCMDR = PECI_CMD_GetTemp+Domain;
 322   2          }
 323   1          else
 324   1          {
 325   2              HOCMDR = PECI_CMD_GetTemp;
 326   2          }
 327   1          
 328   1          if(PECI_CheckHostBusy())
 329   1          {
 330   2              PECI_HostControl(START);
 331   2              if(PECI_CheckHostFinish())
 332   2              {
 333   3                  *ReadData=HORDDR;
 334   3                  *(++ReadData)=HORDDR;
 335   3                  done = 0x01;
 336   3              }
 337   2          }
 338   1      
 339   1          PECI_HostDisable();
 340   1          ResetPECIStatus();
 341   1          return(done);
 342   1      }
 343          
 344          //-----------------------------------------------------------------------
 345          // Read to the package configuration space (PCS) within the processor
 346          //  return : 
 347          //              1 : done
 348          //              0 : error
 349          //  Input : 
 350          //              (1) addr : The address of processor
 351          //              (2) *ReadData : the start address of variable to save data
 352          //              (3) Domain : 0 or 1¡C 
 353          //                           0 : Domain 0, 1 : Domain 1¡C
 354          //              (4) Retry   0 or 1
 355          //              (5) Index
 356          //              (6) LSB of parameter
 357          //              (7) MSB of parameter
 358          //              (8) ReadLen read length 2 or 3 or 5
 359          //              (9) WriteLen write length 5
 360          //-----------------------------------------------------------------------
 361          BYTE PECI_RdPkgConfig(BYTE addr, XBYTE *ReadData, BYTE Domain, BYTE Retry, BYTE Index, BYTE LSB, BYTE MSB,
             - BYTE ReadLen, BYTE WriteLen)
 362          {
 363   1          BYTE done, cunt;
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 7   

 364   1          done = 0x00;
 365   1          
 366   1          PECI_HostEnable();
 367   1          HOTRADDR = addr;
 368   1          HOWRLR = WriteLen;
 369   1          HORDLR = ReadLen;
 370   1          if(Domain<2)
 371   1          {
 372   2              HOCMDR = PECI_CMD_RdPkgConfig+Domain;
 373   2          }
 374   1          else
 375   1          {
 376   2              HOCMDR = PECI_CMD_RdPkgConfig;
 377   2          }
 378   1      
 379   1          if(Retry<2)
 380   1          {
 381   2              HOWRDR = (PECI_HostID<<1)+Retry;
 382   2          }
 383   1          else
 384   1          {
 385   2              HOWRDR = (PECI_HostID<<1);
 386   2          }
 387   1          
 388   1          HOWRDR = Index;
 389   1          HOWRDR = LSB;
 390   1          HOWRDR = MSB;
 391   1              
 392   1          if(PECI_CheckHostBusy())
 393   1          {
 394   2              PECI_HostControl(START);
 395   2              if(PECI_CheckHostFinish())
 396   2              {
 397   3                  if(HORDLR!=0x00)
 398   3                  {
 399   4                      for(cunt=0x00;cunt<HORDLR;cunt++)
 400   4                      {
 401   5                          if(cunt==0x00)
 402   5                          {
 403   6                              PECI_CompletionCode = HORDDR;
 404   6                          }
 405   5                          else
 406   5                          {
 407   6                              *(ReadData+cunt-1)=HORDDR;
 408   6                          }
 409   5                      }
 410   4      
 411   4                      if(PECI_CompletionCode == PECI_CC_Valid)
 412   4                      {
 413   5                          done = 0x01;
 414   5                      }
 415   4                      else
 416   4                      {
 417   5                          done = 0x00;
 418   5                      }
 419   4                  }
 420   3                  else
 421   3                  {
 422   4                      done = 0x00;
 423   4                  }
 424   3              }
 425   2          }
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 8   

 426   1      
 427   1          PECI_HostDisable();
 428   1          ResetPECIStatus();
 429   1          return(done);
 430   1      }
 431          
 432          //-----------------------------------------------------------------------
 433          // Write to the package configuration space (PCS) within the processor
 434          //  return : 
 435          //              1 : done
 436          //              0 : error
 437          //  Input : 
 438          //              (1) addr : The address of processor
 439          //              (2) *WriteData : the start address of variable to wirte data
 440          //              (3) Domain : 0 or 1¡C 
 441          //                           0 : Domain 0, 1 : Domain 1¡C
 442          //              (4) Retry   0 or 1
 443          //              (5) Index
 444          //              (6) LSB of parameter
 445          //              (7) MSB of parameter
 446          //              (8) ReadLen read length 1
 447          //              (9) WriteLen write length 0x07 or 0x08 or 0x0A
 448          //-----------------------------------------------------------------------
 449          BYTE PECI_WrPkgConfig(BYTE addr, XBYTE *WriteData, BYTE Domain, BYTE Retry, BYTE Index, BYTE LSB, BYTE MSB
             -, BYTE ReadLen, BYTE WriteLen)
 450          {
 451   1          BYTE done, cunt;
 452   1          done = 0x00;
 453   1          
 454   1          PECI_CompletionCode = 0x00;
 455   1          PECI_HostEnable();
 456   1          
 457   1          #if PECI_Softwave_AWFCS
                  PECI_CRC8 = 0x00;
                  #else
 460   1          PECI_HostControl(AWFCS_EN);
 461   1          #endif
 462   1          
 463   1          HOTRADDR = addr;
 464   1          PECI_CalcCRC8(addr);
 465   1          HOWRLR = WriteLen;
 466   1          PECI_CalcCRC8(WriteLen);
 467   1          HORDLR = ReadLen;
 468   1          PECI_CalcCRC8(ReadLen);
 469   1      
 470   1          if(Domain<2)
 471   1          {
 472   2              HOCMDR = PECI_CMD_WrPkgConfig+Domain;
 473   2              PECI_CalcCRC8(PECI_CMD_WrPkgConfig+Domain);
 474   2          }
 475   1          else
 476   1          {
 477   2              HOCMDR = PECI_CMD_WrPkgConfig;
 478   2              PECI_CalcCRC8(PECI_CMD_WrPkgConfig);
 479   2          }
 480   1      
 481   1          if(Retry<2)
 482   1          {
 483   2              HOWRDR = (PECI_HostID<<1)+Retry;
 484   2              PECI_CalcCRC8((PECI_HostID<<1)+Retry);
 485   2          }
 486   1          else
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 9   

 487   1          {
 488   2              HOWRDR = (PECI_HostID<<1);
 489   2              PECI_CalcCRC8(PECI_HostID<<1);
 490   2          }
 491   1      
 492   1          HOWRDR = Index;
 493   1          PECI_CalcCRC8(Index);
 494   1          HOWRDR = LSB;
 495   1          PECI_CalcCRC8(LSB);
 496   1          HOWRDR = MSB;
 497   1          PECI_CalcCRC8(MSB);
 498   1      
 499   1          for(cunt=0x00; cunt<(WriteLen-6); cunt++)
 500   1          {
 501   2              HOWRDR = *(WriteData+cunt);
 502   2              PECI_CalcCRC8(*(WriteData+cunt));
 503   2          }
 504   1      
 505   1          #if PECI_Softwave_AWFCS
                  PECI_CRC8 ^= 0x80;          // Inverted MSb of preliminary FCS reslut
                  HOWRDR = PECI_CRC8;
                  #endif
 509   1               
 510   1          if(PECI_CheckHostBusy())
 511   1          {
 512   2              PECI_HostControl(START);
 513   2              if(PECI_CheckHostFinish())
 514   2              {
 515   3                  PECI_CompletionCode = HORDDR;
 516   3                  if(PECI_CompletionCode == PECI_CC_Valid)
 517   3                  {
 518   4                      done = 0x01;
 519   4                  }
 520   3                  else
 521   3                  {
 522   4                      done = 0x00;
 523   4                  }
 524   3              }
 525   2          }
 526   1      
 527   1          PECI_HostDisable();
 528   1          ResetPECIStatus();
 529   1          return(done);
 530   1      }
 531          
 532          //-----------------------------------------------------------------------
 533          // Read to Model Specific Registers function
 534          //  return : 
 535          //              1 : done
 536          //              0 : error
 537          //  Input : 
 538          //              (1) addr : The address of processor
 539          //              (2) *ReadData : the start address of variable to save data
 540          //              (3) Domain : 0 or 1¡C 
 541          //                           0 : Domain 0, 1 : Domain 1¡C
 542          //              (4) Retry   0 or 1
 543          //              (5) ProcessorID
 544          //              (6) LSB of parameter
 545          //              (7) MSB of parameter
 546          //              (8) ReadLen read length 0x02 or 0x03 or 0x05 or 0x09
 547          //              (9) WriteLen write length 0x05
 548          //-----------------------------------------------------------------------
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 10  

 549          BYTE PECI_RdIAMSR(BYTE addr, XBYTE *ReadData, BYTE Domain, BYTE Retry, BYTE ProcessorID, BYTE LSB, BYTE MS
             -B, BYTE ReadLen, BYTE WriteLen)
 550          {
 551   1          BYTE done, cunt;
 552   1          done = 0x00;
 553   1          
 554   1          PECI_HostEnable();
 555   1          HOTRADDR = addr;
 556   1          HOWRLR = WriteLen;
 557   1          HORDLR = ReadLen;
 558   1          if(Domain<2)
 559   1          {
 560   2              HOCMDR = PECI_CMD_RdIAMSR+Domain;
 561   2          }
 562   1          else
 563   1          {
 564   2              HOCMDR = PECI_CMD_RdIAMSR;
 565   2          }
 566   1      
 567   1          if(Retry<2)
 568   1          {
 569   2              HOWRDR = (PECI_HostID<<1)+Retry;
 570   2          }
 571   1          else
 572   1          {
 573   2              HOWRDR = (PECI_HostID<<1);
 574   2          }
 575   1          
 576   1          HOWRDR = ProcessorID;
 577   1          HOWRDR = LSB;
 578   1          HOWRDR = MSB;
 579   1              
 580   1          if(PECI_CheckHostBusy())
 581   1          {
 582   2              PECI_HostControl(START);
 583   2              if(PECI_CheckHostFinish())
 584   2              {
 585   3                  for(cunt=0x00;cunt<HORDLR;cunt++)
 586   3                  {
 587   4                      if(cunt==0x00)
 588   4                      {
 589   5                          PECI_CompletionCode = HORDDR;
 590   5                      }
 591   4                      else
 592   4                      {
 593   5                          *(ReadData+cunt-1)=HORDDR;
 594   5                      }
 595   4                  }
 596   3      
 597   3                  if(PECI_CompletionCode == PECI_CC_Valid)
 598   3                  {
 599   4                      done = 0x01;
 600   4                  }
 601   3                  else
 602   3                  {
 603   4                      done = 0x00;
 604   4                  }
 605   3              }
 606   2          }
 607   1      
 608   1          PECI_HostDisable();
 609   1          ResetPECIStatus();
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 11  

 610   1          return(done);
 611   1      }
 612          
 613          // ----------------------------------------------------------------------------
 614          // Clear PECI turbo control variables
 615          // ----------------------------------------------------------------------------
 616          void PECI_ClearTCVariables(void)
 617          {
 618   1          PECI_ClearPowerSKUUnit();
 619   1          PowerLimit1TDP=0x00;
 620   1          PowerLimit2Max=0x00; 
 621   1          PECI_PL2Watts=0x00;
 622   1          PowerLimit1Tau=0x00;
 623   1          PECI_Ctrl = 0x00;
 624   1          PECI_Algorithm_Delay = 0x00;
 625   1      }
 626          
 627          // ----------------------------------------------------------------------------
 628          // Clear Power SKU unit variables
 629          // ----------------------------------------------------------------------------
 630          void PECI_ClearPowerSKUUnit(void)
 631          {
 632   1          PECI_PowerUnit = 0x00;
 633   1          PECI_EnergyUnit = 0x00;
 634   1          PECI_TimeUnit = 0x00;
 635   1      }
 636          
 637          // ----------------------------------------------------------------------------
 638          // The function of PECI3.0 Package power SKU unit read
 639          // Output:
 640          //          0 : Fail
 641          //          1 : OK
 642          // ----------------------------------------------------------------------------
 643          BYTE PECI_ReadPowerUnit(void)
 644          {
 645   1          BYTE result;
 646   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_PPSH, 0x00, 0x00, 0x0
             -5, 0x05))
 647   1          {
 648   2              PECI_PowerUnit = (PECIReadBuffer[0]&0x0F);      // bit 0 ~ bit3
 649   2              PECI_EnergyUnit = (PECIReadBuffer[1]&0x1F);     // bit 8 ~ bit12
 650   2              PECI_TimeUnit = (PECIReadBuffer[2]&0x0F);       // bit 16 ~ bit19
 651   2              result = 0x01;
 652   2          }
 653   1          else
 654   1          {
 655   2              result = 0x00;
 656   2          }
 657   1          return(result);
 658   1      }
 659          
 660          // ----------------------------------------------------------------------------
 661          // The function of PECI3.0 Package power limit 1 write 
 662          // Output:
 663          //          0 : Fail
 664          //          1 : OK
 665          // ----------------------------------------------------------------------------
 666          BYTE PECI_WritePowerLimit1(void)
 667          {
 668   1          BYTE reslut;
 669   1          WORD UnitofPower;
 670   1          WORD UnitofTau;
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 12  

 671   1          WORD PL1_TDPWatts;
 672   1          BYTE PL1_PL1T;
 673   1          
 674   1          UnitofPower = 1<<PECI_PowerUnit;
 675   1          PL1_TDPWatts = PowerLimit1TDP * UnitofPower;
 676   1      
 677   1          UnitofTau = 1<<PECI_TimeUnit;
 678   1          //PL1_PL1T = (PowerLimit1Tau * UnitofTau)<<1;
 679   1          PL1_PL1T = 0x6E<<1;
 680   1              
 681   1          PECIWriteBuffer[0]=(PL1_TDPWatts);
 682   1          PECIWriteBuffer[1]=(PL1_TDPWatts)>>8;   // Set power limit 1 TDP value
 683   1          PECIWriteBuffer[2]=PL1_PL1T;            // bit17 ~ bit23 Power_Limit_1_Time
 684   1          PECIWriteBuffer[3]=0x00;
 685   1          
 686   1          if(PECI_WrPkgConfig(PECI_CPU_ADDR, &PECIWriteBuffer, PECI_Domain_0, 0, PECI_Index_PPL1, 0x00, 0x00, 0x
             -01, 0x0A))
 687   1          {
 688   2              reslut = 0x01;
 689   2          }
 690   1          else
 691   1          {
 692   2              reslut = 0x00;
 693   2          }
 694   1          return(reslut);
 695   1      }
 696          
 697          
 698          // ----------------------------------------------------------------------------
 699          // The function of PECI3.0 Package power limit 1 read
 700          // Output:
 701          //          0 : Fail
 702          //          1 : OK
 703          // ----------------------------------------------------------------------------
 704          BYTE PECI_ReadPowerLimit1(void)
 705          {
 706   1          BYTE reslut;
 707   1          
 708   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_PPL1, 0x00, 0x00, 0x0
             -5, 0x05))
 709   1          {
 710   2              PowerLimit1TDP = (PECIReadBuffer[0]+((PECIReadBuffer[1] &= 0x7F) *256))/(1<<PECI_PowerUnit);
 711   2              PowerLimit1Tau = PECIReadBuffer[2]>>1;
 712   2              reslut = 0x01;
 713   2          }
 714   1          else
 715   1          {
 716   2              reslut = 0x00;
 717   2          }
 718   1          return(reslut);
 719   1      }
 720          
 721          // ----------------------------------------------------------------------------
 722          // The function of battery mode turbo control
 723          // ----------------------------------------------------------------------------
 724          void PECI_ACToDCModeTurboCtrl(void)
 725          {
 726   1          BYTE retry;
 727   1          
 728   1          //PCH_PROCHOT_ON();
 729   1          for(retry=0x00;retry<5;retry++)         // Re-try
 730   1          {
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 13  

 731   2              PECI_SETPL2Watts(PowerLimit1TDP);
 732   2              if(IS_MASK_CLEAR(PECI_Ctrl, SetPL2Request))
 733   2              {
 734   3                  break;
 735   3              }
 736   2          }
 737   1          //PCH_PROCHOT_OFF();
 738   1      }
 739          
 740          // ----------------------------------------------------------------------------
 741          // The function of setting PL2 watts
 742          // ----------------------------------------------------------------------------
 743          void PECI_SETPL2Watts(BYTE watts)
 744          {
 745   1          PECI_PL2Watts = watts;
 746   1          SET_MASK(PECI_Ctrl, SetPL2Request);
 747   1          PECI_WritePowerLimit2(PECI_PL2Watts);
 748   1      }
 749          
 750          // ----------------------------------------------------------------------------
 751          // The function of PECI3.0 Package power limit 2 write 
 752          // ----------------------------------------------------------------------------
 753          void PECI_WritePowerLimit2(BYTE watts)
 754          {
 755   1           WORD UnitofPower;
 756   1           WORD PL2_SettingWatts;
 757   1          //if(PECI_ReadPowerUnit()==0x01)
 758   1          //{
 759   1              UnitofPower = 1<<PECI_PowerUnit;
 760   1              PL2_SettingWatts = watts * UnitofPower;
 761   1              
 762   1              PECIWriteBuffer[0]=(PL2_SettingWatts);
 763   1              PECIWriteBuffer[1]=(PL2_SettingWatts)>>8;   // Set power limit 2 value
 764   1              PECIWriteBuffer[1]|=0x80;                   // Enables power limit 2
 765   1              PECIWriteBuffer[2]=0x00;
 766   1              PECIWriteBuffer[3]=0x00;
 767   1              if(PECI_WrPkgConfig(PECI_CPU_ADDR, &PECIWriteBuffer, PECI_Domain_0, 0, PECI_Index_PPL2, 0x00, 0x00
             -, 0x01, 0x0A))
 768   1              {
 769   2                  CLEAR_MASK(PECI_Ctrl, SetPL2Request);
 770   2              }
 771   1              else
 772   1              {
 773   2      
 774   2              }
 775   1          //}
 776   1          //else
 777   1          //{
 778   1      
 779   1          //}
 780   1      }
 781          
 782          // ----------------------------------------------------------------------------
 783          // The function of PECI3.0 Package power limit 2 read 
 784          // ----------------------------------------------------------------------------
 785          void PECI_ReadPowerLimit2(void)
 786          {
 787   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_PPL2, 0x00, 0x00, 0x0
             -5, 0x05))
 788   1          {
 789   2              ;
 790   2          }
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 14  

 791   1          else
 792   1          {
 793   2              ;
 794   2          }
 795   1      }
 796          
 797          // ----------------------------------------------------------------------------
 798          // The function of PECI3.0 CPU temperature read
 799          // ----------------------------------------------------------------------------
 800          void PECI_ReadCPUTemp(void)
 801          {
 802   1          WORD cputemp;
 803   1          BYTE tempoffset;
 804   1          
 805   1          if(PECI_GetTemp(PECI_CPU_ADDR,&PECIReadBuffer,PECI_Domain_0,2,1)) // Read OK
 806   1          {
 807   2              cputemp = (PECIReadBuffer[1]<<8)+PECIReadBuffer[0]; // MSB+LSB
 808   2              cputemp = (~cputemp)+1;                             // 2's complement
 809   2              tempoffset = cputemp>>6;                            // 1/64 degrees centigrade
 810   2              if(tempoffset<=CPUTjmax)        // PECI thermal reading temperature readings are                
 811   2              {                               // not reliable at temperatures above Tjmax
 812   3                  PECI_CPU_temp = CPUTjmax-tempoffset;  // Save temperature
 813   3      
 814   3                              if(PECI_CPU_temp == CPUTjmax)
 815   3                              {
 816   4                                      BRAM_PECI_Error = 0x66;
 817   4                                      return;
 818   4                              }
 819   3      
 820   3                              if(Debugtemperature1==0x00)
 821   3                              {                                       
 822   4                                      TCPU_temp = PECI_CPU_temp;
 823   4                                      DebugTCPU = PECI_CPU_temp;
 824   4                              }
 825   3                              else
 826   3                              {
 827   4                                      TCPU_temp = Debugtemperature1;
 828   4                              }                       
 829   3      
 830   3                              EC_CPU_TEMP = PECI_CPU_temp;
 831   3              }
 832   2              else
 833   2              {
 834   3      
 835   3              }
 836   2          }
 837   1          else        // Read fail
 838   1          {
 839   2      
 840   2          }
 841   1      }
 842          
 843          // ----------------------------------------------------------------------------
 844          // The function of PECI3.0 Read the Maximum Allowed Processor Temperature
 845          // ----------------------------------------------------------------------------
 846          void PECI_ReadCPUTJMAX(void)
 847          {
 848   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_TTR, 0x00, 0x00, 0x05
             -, 0x05))
 849   1          {
 850   2              ReadCPUTjmaxCUNT = 0x00;
 851   2              CPUTjmax = PECIReadBuffer[2];
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 15  

 852   2          }
 853   1          else
 854   1          {
 855   2              if(++ReadCPUTjmaxCUNT>=PECI_Read_TjmaxTO)
 856   2              {
 857   3                  ReadCPUTjmaxCUNT = 0x00;
 858   3                  CPUTjmax = PECI_CPU_Tjmax; // Set default value if re-try PECI_Read_TjmaxTO times
 859   3              }
 860   2          }
 861   1      }
 862          
 863          // ----------------------------------------------------------------------------
 864          // The function of PECI3.0 DRAM rank channel temperature read
 865          // ----------------------------------------------------------------------------
 866          void PECI_ReadDRAMTemperature(void)
 867          {
 868   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_DRCTR, 0x00, 0x00, 0x
             -05, 0x05))
 869   1          {
 870   2              TDIM0_temp = PECIReadBuffer[0];
 871   2              TDIM1_temp = PECIReadBuffer[1];
 872   2          }
 873   1          else
 874   1          {
 875   2              ;
 876   2          }
 877   1      }
 878          
 879          // ----------------------------------------------------------------------------
 880          // The function of PECI3.0 Package Power read
 881          // ----------------------------------------------------------------------------
 882          BYTE PECI_ReadPkgPower(void)
 883          {
 884   1          LWORD pkgtemp1,pkgtemp2;
 885   1              BYTE result;
 886   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_Power, 0xFF, 0x00, 0x
             -05, 0x05))
 887   1          {           
 888   2                
 889   2              pkgtemp1 = ((PECIReadBuffer[3]<<8)+PECIReadBuffer[2]);
 890   2                      pkgtemp2 = ((PECIReadBuffer[1]<<8)+PECIReadBuffer[0]); 
 891   2      
 892   2                      PECI_PkgPower_Cur = (pkgtemp1 << 16) + pkgtemp2;
 893   2                         
 894   2                      //PECI_PkgPower_Cur = (PECI_PkgPower_Cur >> PECI_EnergyUnit);
 895   2                              
 896   2                      if(PECI_PkgPower_Pre == 0)
 897   2                              PECI_PkgPower_Pre = PECI_PkgPower_Cur;
 898   2                      
 899   2                      PECI_PkgPower =  PECI_PkgPower_Cur - PECI_PkgPower_Pre;
 900   2                      
 901   2                      PECI_PkgPower_Pre = PECI_PkgPower_Cur;
 902   2                      
 903   2                      result = 0x01;
 904   2          }
 905   1          else
 906   1          {
 907   2              result = 0x00;
 908   2          }
 909   1      
 910   1              return result;
 911   1      }
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 16  

 912          
 913          
 914          // ----------------------------------------------------------------------------
 915          // The function of Calculate Package Power 
 916          // ----------------------------------------------------------------------------
 917          void PECI_CalculatePkgPower(void)
 918          {
 919   1              if(IS_MASK_CLEAR(OEM_flag_1,Oem_PECI_ReadUnit))
 920   1              {
 921   2                  if(PECI_ReadPowerUnit()==0x01)
 922   2                  {
 923   3                              SET_MASK(OEM_flag_1,Oem_PECI_ReadUnit);
 924   3      
 925   3                  }
 926   2              }       
 927   1              else
 928   1              {    
 929   2              if(PECI_ReadPkgPower() == 0x01)
 930   2              {
 931   3                      PECI_PkgPower = (PECI_PkgPower>>(PECI_EnergyUnit-1));
 932   3                              
 933   3                              
 934   3              }
 935   2          }
 936   1      }
 937                  
 938          // ----------------------------------------------------------------------------
 939          // The function of PECI3.0 Package temperature read
 940          // ----------------------------------------------------------------------------
 941          void PECI_ReadPkgTemperature(void)
 942          {
 943   1          WORD pkgtemp;
 944   1          BYTE tempoffset;
 945   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_PTR, 0xFF, 0x00, 0x05
             -, 0x05))
 946   1          {
 947   2              pkgtemp = (PECIReadBuffer[1]<<8)+PECIReadBuffer[0]; // MSB+LSB
 948   2              pkgtemp = (~pkgtemp)+1;                             // 2's complement
 949   2              tempoffset = pkgtemp>>6;                            // 1/64 degrees centigrade
 950   2              if(tempoffset<=CPUTjmax)  // PECI thermal reading temperature readings are                
 951   2              {                               // not reliable at temperatures above Tjmax
 952   3                  TPkg_temp = CPUTjmax-tempoffset;  // Save temperature
 953   3              }
 954   2          }
 955   1          else
 956   1          {
 957   2              ;
 958   2          }
 959   1      }
 960          
 961          // ----------------------------------------------------------------------------
 962          // The example of PECI3.0 read MSR address 0x0400
 963          // ----------------------------------------------------------------------------
 964          void PECI_ReadMSRExample(void)
 965          {
 966   1          if(PECI_RdIAMSR(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, 0, 0x00, 0x04, 0x09, 0x05))
 967   1          {
 968   2      
 969   2          }
 970   1          else
 971   1          {
 972   2      
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 17  

 973   2          }
 974   1      }
 975          
 976          // ----------------------------------------------------------------------------
 977          // Get current platform total power
 978          // ----------------------------------------------------------------------------
 979          void PECI_CheckCurrentPlatformPower(void)
 980          {
 981   1          WORD _SysCurrent;
 982   1          _SysCurrent = Read_SYS_I();
 983   1              //guoyong003 = ((19*2*5*SysCurrent)/0x3ff);
 984   1              PECI_SystemWatts = ((19*5*_SysCurrent)/0x3ff)*2;
 985   1              
 986   1          //PECI_SystemWatts
 987   1      }
 988          
 989          // ----------------------------------------------------------------------------
 990          // The Algorithm of AC turbo control
 991          // ----------------------------------------------------------------------------
 992          void PECI_ACTurboControlAlgorithm(void)
 993          {
 994   1          BYTE NewPL2Watts,BATTERY_CHARGE_BUDGET,UpdatPL2;
 995   1      
 996   1              //NewPL2Watts    the power cpu can consumption
 997   1              //PECI_PL2Watts   the current power  cpu consuming  
 998   1              
 999   1          //if(PECI_PL2Watts==0x00)                   // Not ready
1000   1          //{
1001   1          //    return;
1002   1          //}
1003   1          
1004   1          if(IS_MASK_CLEAR(PECI_Ctrl, SetPL2Request)) // No any request of PL2 power setting
1005   1          {
1006   2              UpdatPL2=0x00;
1007   2              BATTERY_CHARGE_BUDGET=0x00;
1008   2      
1009   2              if(IS_MASK_SET(BT1_STATUS1,bat_InCharge))
1010   2              {
1011   3                  if(BAT1_RSOC>50)
1012   3                  {
1013   4                      BATTERY_CHARGE_BUDGET = 0x00;   // 0W
1014   4                  }
1015   3                  else
1016   3                  {
1017   4                      BATTERY_CHARGE_BUDGET = 20;     // 20W
1018   4                  }
1019   3              }
1020   2              
1021   2              NewPL2Watts = PECI_PL2Watts+PECI_AdaptorWatts-PECI_SystemWatts-BATTERY_CHARGE_BUDGET;
1022   2              
1023   2              if(NewPL2Watts>PowerLimit2Max)
1024   2              {
1025   3                  NewPL2Watts = PowerLimit2Max;
1026   3                  if(NewPL2Watts!=PECI_PL2Watts)
1027   3                  {
1028   4                      UpdatPL2=0x01;
1029   4                  }
1030   3                  //UpdatPL2=0x01;
1031   3              }
1032   2              else if(NewPL2Watts<PowerLimit1TDP)
1033   2              {
1034   3                  NewPL2Watts = PowerLimit1TDP;
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 18  

1035   3                  if(NewPL2Watts!=PECI_PL2Watts)
1036   3                  {
1037   4                      UpdatPL2=0x01;
1038   4                  }
1039   3                  //UpdatPL2=0x01;
1040   3              }                       
1041   2              else
1042   2              {
1043   3                  if(NewPL2Watts!=PECI_PL2Watts)
1044   3                  {
1045   4                      UpdatPL2=0x01;
1046   4                  }
1047   3              }
1048   2      
1049   2             if(guoyong001 == 1)
1050   2              {
1051   3                NewPL2Watts = PowerLimit1TDP;
1052   3                  if(NewPL2Watts!=PECI_PL2Watts)
1053   3                  {
1054   4                      UpdatPL2=0x01;
1055   4                  }
1056   3              }
1057   2                 
1058   2              if(UpdatPL2==0x01)
1059   2              {
1060   3                  PECI_SETPL2Watts(NewPL2Watts);
1061   3              }
1062   2          }
1063   1          else
1064   1          {
1065   2              PECI_WritePowerLimit2(PECI_PL2Watts);
1066   2          }
1067   1      }
1068          
1069          // ----------------------------------------------------------------------------
1070          // decide adaptor watts
1071          // ----------------------------------------------------------------------------
1072          void ChecknSetAdaptorWatts(void)
1073          {
1074   1          PECI_AdaptorWatts = ACPowerWatts;   // Set 65w adaptor
1075   1          PowerLimit2Max = PowerLimit2Max_Value;
1076   1      }
1077          
1078          // ----------------------------------------------------------------------------
1079          // PECI power limit 2 control function
1080          // ----------------------------------------------------------------------------
1081          void PECI_PowerCtrlAlgorithm(void)
1082          {
1083   1          switch(PECI_PowerCtrlStep)
1084   1          {
1085   2              case PECI_Step_Start:
1086   2                  if(SystemIsS0)
1087   2                  {
1088   3                      if(IS_MASK_SET(POWER_FLAG1, adapter_in))    // AC mode
1089   3                      {
1090   4                          ChecknSetAdaptorWatts();
1091   4                          SetPECIPowerCtrlStep(PECI_Step_ReadPSKUUnit);
1092   4                      }
1093   3                      else                                            // DC mode
1094   3                      {
1095   4      
1096   4                      }
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 19  

1097   3                  }
1098   2                  break;
1099   2      
1100   2              case PECI_Step_ReadPSKUUnit:
1101   2                  if(PECI_ReadPowerUnit()==0x01)                              // Read power SKU unit OK
1102   2                  {
1103   3                      SetPECIPowerCtrlStep(PECI_Step_ReadPL1);
1104   3                  }
1105   2                  break;
1106   2      
1107   2              case PECI_Step_ReadPL1:
1108   2                  if(PECI_ReadPowerLimit1()==0x01)                            // Read power limit 1 done
1109   2                  {
1110   3                      if(PowerLimit1TDP!=0x00)
1111   3                      {
1112   4                          SetPECIPowerCtrlStep(PECI_Step_Algorithm);
1113   4                      }
1114   3                      else
1115   3                      {
1116   4                          PowerLimit1TDP = PowerLimit1_TDP;
1117   4                          SetPECIPowerCtrlStep(PECI_Step_WritePL1);
1118   4                      }
1119   3                  }
1120   2                  break;
1121   2      
1122   2              case PECI_Step_WritePL1:
1123   2                  if(PECI_WritePowerLimit1()==0x01)
1124   2                  {
1125   3                      SetPECIPowerCtrlStep(PECI_Step_Algorithm);
1126   3                  }
1127   2                  break;
1128   2                      
1129   2              case PECI_Step_Algorithm:
1130   2                  if(++PECI_Algorithm_Delay>=AlgorithmDelayTime)
1131   2                  {
1132   3                      PECI_Algorithm_Delay = 0x00;
1133   3                      PECI_ACTurboControlAlgorithm();
1134   3                  }
1135   2                  break;
1136   2                  
1137   2              case PECI_Step_Stop:
1138   2                  break;
1139   2              
1140   2              case PECI_Step_StopRequest:
1141   2                  PECI_ClearTCVariables();
1142   2                  SetPECIPowerCtrlStep(PECI_Step_Stop);
1143   2                  break;
1144   2                      
1145   2              default:
1146   2                  break;
1147   2          }  
1148   1      }
1149          
1150          // ----------------------------------------------------------------------------
1151          // CPU Power control via PECI     5ms  time base
1152          // ----------------------------------------------------------------------------
1153          void PECI_PowerCtrlCenter(void)
1154          {
1155   1          if(SystemIsS0)          // For PECI stress tool
1156   1          {
1157   2              if(IS_MASK_SET(PSTB_CmdStatus, ServivePECIStressTool))
1158   2              {
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 20  

1159   3                  if(++PSTB_Timer >=0x02)    // 10 ms
1160   3                  {
1161   4                      PSTB_Timer=0x00;
1162   4                      if(PSTB_RepeatIntervalCount==0x00)
1163   4                      {
1164   5                          ProcessPSTCmd();
1165   5                      }
1166   4                      else
1167   4                      {
1168   5                          PSTB_RepeatIntervalCount--;
1169   5                      }
1170   4                  }
1171   3                  return;
1172   3              }
1173   2          }
1174   1      
1175   1          #ifdef PECI_Support
                      #if ACTurboControlAlgorithm
                                  if(SystemIsS0)
                                  {
                                      PECI_CheckCurrentPlatformPower();       // Get current platform total power every 5ms
                                  }           
              
                                      PECI_PowerCtrlAlgorithm();
                      #endif
                  #endif
1185   1          
1186   1      
1187   1      }
1188          
1189          // ----------------------------------------------------------------------------
1190          // Set PECI power control step
1191          // ----------------------------------------------------------------------------
1192          void SetPECIPowerCtrlStep(BYTE step)
1193          {
1194   1          PECI_PowerCtrlStep = step;
1195   1      }
1196          
1197          // ****************************************************************************
1198          // PECI Stress Tool
1199          // ****************************************************************************
1200          // ----------------------------------------------------------------------------
1201          // Process PECP stress tool command
1202          // ----------------------------------------------------------------------------
1203          void ProcessPSTCmd(void)
1204          {
1205   1          BYTE writelen, readlen,bufindex;
1206   1          BYTE error;
1207   1          XBYTE *bufpoint;
1208   1          
1209   1          error = 0x00;
1210   1          bufindex = 0x00;
1211   1      
1212   1          bufpoint = &PSTB_RepeatCycle;
1213   1          
1214   1          if(PSTB_RepeatCycle!=0x00)
1215   1          {
1216   2              writelen = PECI_StressToolBuf[PSTB_WriteLength];
1217   2              readlen = PECI_StressToolBuf[PSTB_ReadLength];
1218   2              
1219   2              PECI_HostEnable();
1220   2              HOTRADDR = PECI_StressToolBuf[PSTB_ClientAddress];
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 21  

1221   2              HOWRLR = PECI_StressToolBuf[PSTB_WriteLength];
1222   2              HORDLR = PECI_StressToolBuf[PSTB_ReadLength];
1223   2                  
1224   2              if(writelen!=0x00)
1225   2              {
1226   3                  HOCMDR = PECI_StressToolBuf[PSTB_CmdCode];
1227   3                  writelen--;
1228   3                  bufindex++;
1229   3              }
1230   2              if(PECI_StressToolBuf[PSTB_CmdCode]==PECI_CMD_WrPkgConfig)
1231   2              {
1232   3                  PECI_HostControl(AWFCS_EN);
1233   3                  writelen--;
1234   3              }
1235   2      
1236   2              while(writelen!=0x00)
1237   2              {
1238   3                  HOWRDR = PECI_StressToolBuf[PSTB_CmdCode+bufindex];
1239   3                  writelen--;
1240   3                  bufindex++;
1241   3              }
1242   2      
1243   2              if(PECI_CheckHostBusy())
1244   2              {
1245   3                  PECI_HostControl(START);
1246   3                  if(PECI_CheckHostFinish())  // OK
1247   3                  {
1248   4                      if(PECI_StressToolBuf[PSTB_CmdCode]==PECI_CMD_WrPkgConfig)
1249   4                      {
1250   5                          bufindex++;         // AWFCS
1251   5                      }
1252   4                      bufindex++;             // FCS
1253   4      
1254   4                      while(readlen!=0x00)
1255   4                      {
1256   5                          PECI_StressToolBuf[PSTB_CmdCode+bufindex] = HORDDR;
1257   5                          readlen--;
1258   5                          bufindex++;
1259   5                      }
1260   4                      error = 0x00;
1261   4                  }
1262   3                  else                        // error
1263   3                  {
1264   4                      error = 0x01;
1265   4                  }
1266   3              }
1267   2              else
1268   2              {
1269   3                  error = 0x01;
1270   3              }
1271   2              
1272   2              PSTB_RepeatCycle--;
1273   2              PECI_StressToolBuf[PSTB_RepeatCycle3] = *bufpoint;
1274   2              bufpoint++;
1275   2              PECI_StressToolBuf[PSTB_RepeatCycle2] = *bufpoint;
1276   2              bufpoint++;
1277   2              PECI_StressToolBuf[PSTB_RepeatCycle1] = *bufpoint;
1278   2              bufpoint++;
1279   2              PECI_StressToolBuf[PSTB_RepeatCycle0] = *bufpoint;
1280   2              
1281   2              PSTB_RepeatIntervalCount = PECI_StressToolBuf[PSTB_RepeatInterval];
1282   2              PECI_HostDisable();
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 22  

1283   2              ResetPECIStatus();
1284   2              
1285   2              if(error==0x01)
1286   2              {
1287   3                  if(PECI_StressToolBuf[PSTB_CmdCode]==PECI_CMD_WrPkgConfig)
1288   3                  {
1289   4                      bufindex++;             // AWFCS
1290   4                  }
1291   3                  bufindex++;                 // FCS
1292   3      
1293   3                  while(readlen!=0x00)        // Clear read length buffer
1294   3                  {
1295   4                      PECI_StressToolBuf[PSTB_CmdCode+bufindex] = 0x00;
1296   4                      readlen--;
1297   4                      bufindex++;
1298   4                  }
1299   3      
1300   3                  PECI_ErrorCount++;
1301   3                  if(PECI_StressToolBuf[PSTB_StopOnError]!=0x00)
1302   3                  {
1303   4                      CLEAR_MASK(PSTB_CmdStatus, ServivePECIStressTool);
1304   4                  }
1305   3              }
1306   2          }
1307   1          else
1308   1          {
1309   2              CLEAR_MASK(PSTB_CmdStatus, ServivePECIStressTool);
1310   2          }
1311   1      }
1312          
1313          // ----------------------------------------------------------------------------
1314          // Issue PECI command
1315          // ----------------------------------------------------------------------------
1316          void PECI_PSTIssueCmd(void)
1317          {
1318   1          XBYTE *xptr;
1319   1          
1320   1          PECI_ErrorCount = 0x00;
1321   1          PSTB_Timer = 0x00;
1322   1          PSTB_RepeatIntervalCount = 0x00;
1323   1          SET_MASK(PSTB_CmdStatus, ServivePECIStressTool);
1324   1          xptr = &PSTB_RepeatCycle;
1325   1          *xptr = PECI_StressToolBuf[PSTB_RepeatCycle3];
1326   1          xptr++;
1327   1          *xptr = PECI_StressToolBuf[PSTB_RepeatCycle2];
1328   1          xptr++;
1329   1          *xptr = PECI_StressToolBuf[PSTB_RepeatCycle1];
1330   1          xptr++;
1331   1          *xptr = PECI_StressToolBuf[PSTB_RepeatCycle0];
1332   1      }
1333          
1334          // ----------------------------------------------------------------------------
1335          // End PECI command
1336          // ----------------------------------------------------------------------------
1337          void PECI_PSTEndCmd(void)
1338          {
1339   1          PECI_ClearPSTVariables();
1340   1      }
1341          
1342          // ----------------------------------------------------------------------------
1343          // Write PECI stress tool buffer command
1344          // ----------------------------------------------------------------------------
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 23  

1345          void PECI_PSTWriteBuffer(void)
1346          {
1347   1          PECI_StressToolBuf[BufferLength-PM3DataCount] = PM3Data;
1348   1      }
1349          
1350          // ----------------------------------------------------------------------------
1351          // Read PECI stress tool buffer command
1352          // ----------------------------------------------------------------------------
1353          void PECI_PSTReadBuffer(void)
1354          {
1355   1          StressToolReadBufIndex = BufferLength;
1356   1          
1357   1          /*
1358   1          BYTE index, timeout;
1359   1      
1360   1          timeout = 0x00;
1361   1      
1362   1          for(index=0x00;index<BufferLength;index++)
1363   1          {
1364   1              TR1 = 0;                            // Disable timer1
1365   1              ET1 = 0;                            // Disable timer1 interrupt
1366   1              _nop_();
1367   1              _nop_();
1368   1              _nop_();
1369   1              _nop_();
1370   1              TH1 = Timer_30ms>>8;            // Set timer1 counter 30ms
1371   1              TL1 = Timer_30ms;               // Set timer1 counter 30ms
1372   1              TF1 = 0;                            // Clear overflow flag
1373   1              TR1 = 1;                            // Enable timer1
1374   1              
1375   1              while(IS_MASK_SET(PM3STS, P_OBF))
1376   1              {
1377   1                  if(TF1)
1378   1                  {
1379   1                      timeout = 0x01;
1380   1                      break;
1381   1                  }
1382   1                  else
1383   1                  {
1384   1                      timeout = 0x00;
1385   1                  }
1386   1              }
1387   1              
1388   1              if(timeout==0x01)
1389   1              {
1390   1                  break;
1391   1              }
1392   1              else
1393   1              {
1394   1                  PMC3Output(PECI_StressToolBuf[index]);
1395   1              }
1396   1          }
1397   1      
1398   1          TR1 = 0;                        // Disable timer1
1399   1          TF1 = 0;                        // Clear overflow flag
1400   1          ET1 = 1;                        // Enable timer1 interrupt
1401   1          */
1402   1      }
1403          
1404          // ----------------------------------------------------------------------------
1405          // Read PECI error count command
1406          // ----------------------------------------------------------------------------
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 24  

1407          void PECI_PSTReadErrorCount(void)
1408          {
1409   1          BYTE index, timeout;
1410   1          BYTE buffer[4];
1411   1          XBYTE *xptr;
1412   1      
1413   1          timeout = 0x00;
1414   1          
1415   1          xptr = &PECI_ErrorCount;
1416   1          buffer[3] = *xptr;
1417   1          xptr++;
1418   1          buffer[2] = *xptr;
1419   1          xptr++;
1420   1          buffer[1] = *xptr;
1421   1          xptr++;
1422   1          buffer[0] = *xptr;
1423   1      
1424   1      
1425   1          for(index=0x00;index<4;index++)
1426   1          {
1427   2              TR1 = 0;                            // Disable timer1
1428   2              ET1 = 0;                            // Disable timer1 interrupt
1429   2              _nop_();
1430   2              _nop_();
1431   2              _nop_();
1432   2              _nop_();
1433   2              TH1 = Timer_30ms>>8;            // Set timer1 counter 30ms
1434   2              TL1 = Timer_30ms;               // Set timer1 counter 30ms
1435   2              TF1 = 0;                            // Clear overflow flag
1436   2              TR1 = 1;                            // Enable timer1
1437   2              
1438   2              while(IS_MASK_SET(PM3STS, P_OBF))
1439   2              {
1440   3                  if(TF1)
1441   3                  {
1442   4                      timeout = 0x01;
1443   4                      break;
1444   4                  }
1445   3                  else
1446   3                  {
1447   4                      timeout = 0x00;
1448   4                  }
1449   3              }
1450   2              
1451   2              if(timeout==0x01)
1452   2              {
1453   3                  break;
1454   3              }
1455   2              else
1456   2              {
1457   3                  PMC3Output(buffer[index]);
1458   3              }
1459   2          }
1460   1      
1461   1          TR1 = 0;                        // Disable timer1
1462   1          TF1 = 0;                        // Clear overflow flag
1463   1          ET1 = 1;                        // Enable timer1 interrupt
1464   1      }
1465          
1466          // ----------------------------------------------------------------------------
1467          // Read PECI status command
1468          // ----------------------------------------------------------------------------
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 25  

1469          void PECI_PSTReadStatus(void)
1470          {
1471   1          TR1 = 0;                        // Disable timer1
1472   1          ET1 = 0;                        // Disable timer1 interrupt
1473   1          _nop_();
1474   1          _nop_();
1475   1          _nop_();
1476   1          _nop_();
1477   1          TH1 = Timer_30ms>>8;            // Set timer1 counter 30ms
1478   1          TL1 = Timer_30ms;               // Set timer1 counter 30ms
1479   1          TF1 = 0;                        // Clear overflow flag
1480   1          TR1 = 1;                        // Enable timer1
1481   1              
1482   1          while(IS_MASK_SET(PM3STS, P_OBF))
1483   1          {
1484   2              if(TF1)
1485   2              {
1486   3                  break;
1487   3              }
1488   2          }
1489   1      
1490   1          if(!TF1)
1491   1          {    
1492   2              PMC3Output(PSTB_CmdStatus);
1493   2          }
1494   1      
1495   1          TR1 = 0;                        // Disable timer1
1496   1          TF1 = 0;                        // Clear overflow flag
1497   1          ET1 = 1;                        // Enable timer1 interrupt
1498   1      }
1499          
1500          // ----------------------------------------------------------------------------
1501          // Clear PECI stress tool variables
1502          // ----------------------------------------------------------------------------
1503          void PECI_ClearPSTVariables(void)
1504          {
1505   1          PSTB_Timer = 0x00;
1506   1          PSTB_CmdStatus = 0x00; 
1507   1          PSTB_RepeatIntervalCount = 0x00;
1508   1          PSTB_RepeatCycle = 0x00;
1509   1          StressToolReadBufIndex = 0x00;
1510   1      }
1511          
1512          // ----------------------------------------------------------------------------
1513          // Send buffer data to PECI stress tool (5ms time base)
1514          // ----------------------------------------------------------------------------
1515          void PECI_SendBufferData(void)
1516          {
1517   1          if(StressToolReadBufIndex!=0x00)
1518   1          {
1519   2              if(IS_MASK_CLEAR(PM3STS, P_OBF))
1520   2              {
1521   3                  PMC3Output(PECI_StressToolBuf[BufferLength-StressToolReadBufIndex]);
1522   3                  StressToolReadBufIndex--;
1523   3              }
1524   2          }
1525   1      }
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 26  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com0101 (BEGIN)
0000         L?0258:
0000 A3                INC     DPTR
0001         L?0259:
0001 F0                MOVX    @DPTR,A
0002 E4                CLR     A
0003 A3                INC     DPTR
0004 F0                MOVX    @DPTR,A
0005         L?0260:
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
0007 A3                INC     DPTR
0008 7405              MOV     A,#05H
000A F0                MOVX    @DPTR,A
000B A3                INC     DPTR
000C F0                MOVX    @DPTR,A
000D E4                CLR     A
000E FB                MOV     R3,A
000F 7F30              MOV     R7,#030H
0011 22                RET     
0012         L?0261:
0012         L?0262:
0012 F0                MOVX    @DPTR,A
0013 900000      R     MOV     DPTR,#bufpoint
0016 E4                CLR     A
0017 75F001            MOV     B,#01H
001A 120000      E     LCALL   ?C?IILDX
001D         L?0263:
001D 900000      R     MOV     DPTR,#bufpoint
0020 E0                MOVX    A,@DPTR
0021 FE                MOV     R6,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 F582              MOV     DPL,A
0026 8E83              MOV     DPH,R6
0028 E0                MOVX    A,@DPTR
0029 22                RET     
002A         L?0264:
002A         L?0265:
002A EC                MOV     A,R4
002B F0                MOVX    @DPTR,A
002C A3                INC     DPTR
002D ED                MOV     A,R5
002E F0                MOVX    @DPTR,A
002F         L?0266:
002F E4                CLR     A
0030 FC                MOV     R4,A
0031 120000      R     LCALL   PECI_HostEnable
0034 900000      E     MOV     DPTR,#HOTRADDR
0037 EF                MOV     A,R7
0038 F0                MOVX    @DPTR,A
0039 22                RET     
003A         L?0267:
003A         L?0268:
003A 900000      R     MOV     DPTR,#?_PECI_RdPkgConfig?BYTE+04H
003D         L?0269:
003D 7C00        E     MOV     R4,#HIGH PECIReadBuffer
003F 7D00        E     MOV     R5,#LOW PECIReadBuffer
0041 E4                CLR     A
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 27  

0042 F0                MOVX    @DPTR,A
0043 22                RET     
0044         L?0270:
0044         L?0271:
0044 7F01              MOV     R7,#01H
0046 120000      R     LCALL   _PECI_HostControl
0049 120000      R     LCALL   PECI_CheckHostFinish
004C EF                MOV     A,R7
004D 22                RET     
004E         L?0272:
004E         L?0273:
004E 900000      E     MOV     DPTR,#PECIReadBuffer+01H
0051 E0                MOVX    A,@DPTR
0052 900000      E     MOV     DPTR,#PECIReadBuffer
0055         L?0274:
0055 FE                MOV     R6,A
0056 E0                MOVX    A,@DPTR
0057 7C00              MOV     R4,#00H
0059 2400              ADD     A,#00H
005B FF                MOV     R7,A
005C EC                MOV     A,R4
005D 3E                ADDC    A,R6
005E 22                RET     
005F         L?0275:
005F         L?0276:
005F 900000      E     MOV     DPTR,#PECI_PowerUnit
0062         L?0277:
0062 E0                MOVX    A,@DPTR
0063 FF                MOV     R7,A
0064 7401              MOV     A,#01H
0066 7E00              MOV     R6,#00H
0068 C8                XCH     A,R0
0069 EF                MOV     A,R7
006A C8                XCH     A,R0
006B 08                INC     R0
006C 22                RET     
006D         L?0278:
006D         L?0279:
006D 120000      R     LCALL   PECI_HostDisable
0070 120000      R     LCALL   ResetPECIStatus
0073 CF                XCH     A,R7
0074 EC                MOV     A,R4
0075 CF                XCH     A,R7
0076 22                RET     
0077         L?0280:
0077 FE                MOV     R6,A
0078 E0                MOVX    A,@DPTR
0079 FA                MOV     R2,A
007A A3                INC     DPTR
007B E0                MOVX    A,@DPTR
007C 2F                ADD     A,R7
007D F582              MOV     DPL,A
007F E4                CLR     A
0080 3A                ADDC    A,R2
0081 F583              MOV     DPH,A
0083 E582              MOV     A,DPL
0085 24FF              ADD     A,#0FFH
0087 F582              MOV     DPL,A
0089 E583              MOV     A,DPH
008B 34FF              ADDC    A,#0FFH
008D F583              MOV     DPH,A
008F EE                MOV     A,R6
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 28  

0090 F0                MOVX    @DPTR,A
0091 22                RET     
0092         L?0281:
0092         L?0282:
0092 900000      R     MOV     DPTR,#bufindex
0095 E0                MOVX    A,@DPTR
0096 2400        E     ADD     A,#LOW PECI_StressToolBuf+09H
0098 F582              MOV     DPL,A
009A E4                CLR     A
009B 3400        E     ADDC    A,#HIGH PECI_StressToolBuf+09H
009D F583              MOV     DPH,A
009F 22                RET     
00A0         L?0283:
00A0 A3                INC     DPTR
00A1 F0                MOVX    @DPTR,A
00A2 E4                CLR     A
00A3 A3                INC     DPTR
00A4 F0                MOVX    @DPTR,A
00A5 A3                INC     DPTR
00A6 F0                MOVX    @DPTR,A
00A7 A3                INC     DPTR
00A8 04                INC     A
00A9 F0                MOVX    @DPTR,A
00AA 740A              MOV     A,#0AH
00AC         L?0284:
00AC A3                INC     DPTR
00AD F0                MOVX    @DPTR,A
00AE E4                CLR     A
00AF FB                MOV     R3,A
00B0 7F30              MOV     R7,#030H
00B2 22                RET     
00B3         L?0285:
00B3 F0                MOVX    @DPTR,A
00B4 1E                DEC     R6
00B5         L?0286:
00B5 900000      R     MOV     DPTR,#bufindex
00B8 E0                MOVX    A,@DPTR
00B9 04                INC     A
00BA F0                MOVX    @DPTR,A
00BB 22                RET     
00BC         L?0287:
00BC F4                CPL     A
00BD FF                MOV     R7,A
00BE EE                MOV     A,R6
00BF F4                CPL     A
00C0 FE                MOV     R6,A
00C1 EF                MOV     A,R7
00C2 2401              ADD     A,#01H
00C4 FF                MOV     R7,A
00C5 E4                CLR     A
00C6 3E                ADDC    A,R6
00C7 F0                MOVX    @DPTR,A
00C8 A3                INC     DPTR
00C9 EF                MOV     A,R7
00CA F0                MOVX    @DPTR,A
00CB 22                RET     
00CC         L?0288:
00CC C3                CLR     C
00CD 7418              MOV     A,#018H
00CF 9F                SUBB    A,R7
00D0 FF                MOV     R7,A
00D1 E4                CLR     A
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 29  

00D2 9400              SUBB    A,#00H
00D4 FE                MOV     R6,A
00D5 7400        E     MOV     A,#LOW PECI_StressToolBuf
00D7 2F                ADD     A,R7
00D8 F582              MOV     DPL,A
00DA 7400        E     MOV     A,#HIGH PECI_StressToolBuf
00DC 3E                ADDC    A,R6
00DD F583              MOV     DPH,A
00DF 22                RET     
00E0         L?0289:
00E0         L?0290:
00E0 758DA6            MOV     TH1,#0A6H
00E3 758B29            MOV     TL1,#029H
00E6 C28F              CLR     TF1
00E8 D28E              SETB    TR1
00EA 22                RET     
00EB         L?0291:
00EB         L?0292:
00EB C28E              CLR     TR1
00ED C28F              CLR     TF1
00EF D2AB              SETB    ET1
00F1 22                RET     
00F2         L?0293:
00F2         L?0294:
00F2 E0                MOVX    A,@DPTR
00F3 900000      E     MOV     DPTR,#HORDLR
00F6 F0                MOVX    @DPTR,A
00F7 EB                MOV     A,R3
00F8 C3                CLR     C
00F9 9402              SUBB    A,#02H
00FB 22                RET     
00FC         L?0295:
00FC         L?0296:
00FC E0                MOVX    A,@DPTR
00FD FE                MOV     R6,A
00FE 900000      E     MOV     DPTR,#PECI_PL2Watts
0101 E0                MOVX    A,@DPTR
0102 FD                MOV     R5,A
0103 EE                MOV     A,R6
0104 6D                XRL     A,R5
0105 22                RET     
0106         L?0298:
0106         L?0299:
0106 900000      E     MOV     DPTR,#HORDLR
0109 E0                MOVX    A,@DPTR
010A FE                MOV     R6,A
010B EF                MOV     A,R7
010C C3                CLR     C
010D 9E                SUBB    A,R6
010E 22                RET     
010F         L?0300:
010F E4                CLR     A
0110 FF                MOV     R7,A
0111 FE                MOV     R6,A
0112 FD                MOV     R5,A
0113 FC                MOV     R4,A
0114 120000      E     LCALL   ?C?LLDXDATA0
0117 C3                CLR     C
0118 020000      E     LJMP    ?C?ULCMP
011B         L?0301:
011B 900000      E     MOV     DPTR,#PECI_PkgPower_Cur
011E 120000      E     LCALL   ?C?LLDXDATA
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 30  

0121 900000      E     MOV     DPTR,#PECI_PkgPower_Pre
0124 020000      E     LJMP    ?C?LSTXDATA
0127         L?0302:
0127         L?0303:
0127 E0                MOVX    A,@DPTR
0128 8F82              MOV     DPL,R7
012A 8E83              MOV     DPH,R6
012C F0                MOVX    @DPTR,A
012D 22                RET     
012E         L?0304:
012E A3                INC     DPTR
012F F0                MOVX    @DPTR,A
0130 7C00        E     MOV     R4,#HIGH PECIWriteBuffer
0132 7D00        E     MOV     R5,#LOW PECIWriteBuffer
0134 900000      R     MOV     DPTR,#?_PECI_WrPkgConfig?BYTE+04H
0137 F0                MOVX    @DPTR,A
0138 22                RET     
0139         L?0305:
0139         L?0306:
0139 900000      E     MOV     DPTR,#HOWRDR
013C 7402              MOV     A,#02H
013E F0                MOVX    @DPTR,A
013F 22                RET     
0140         L?0307:
0140 E0                MOVX    A,@DPTR
0141 900000      E     MOV     DPTR,#HOWRDR
0144 F0                MOVX    @DPTR,A
0145 120000      R     LCALL   PECI_CheckHostBusy
0148 EF                MOV     A,R7
0149 22                RET     
014A         L?0308:
014A ED                MOV     A,R5
014B 2E                ADD     A,R6
014C F582              MOV     DPL,A
014E E4                CLR     A
014F 3C                ADDC    A,R4
0150 F583              MOV     DPH,A
0152 E0                MOVX    A,@DPTR
0153 22                RET     
0154         L?0309:
0154 FF                MOV     R7,A
0155 900000      E     MOV     DPTR,#CPUTjmax
0158 E0                MOVX    A,@DPTR
0159 FE                MOV     R6,A
015A EF                MOV     A,R7
015B D3                SETB    C
015C 9E                SUBB    A,R6
015D 22                RET     
             ; FUNCTION Com0101 (END)

             ; FUNCTION Init_PECI (BEGIN)
                                           ; SOURCE LINE # 16
                                           ; SOURCE LINE # 17
                                           ; SOURCE LINE # 20
0000 22                RET     
             ; FUNCTION Init_PECI (END)

             ; FUNCTION PECI_Enable (BEGIN)
                                           ; SOURCE LINE # 25
                                           ; SOURCE LINE # 26
                                           ; SOURCE LINE # 28
0000 22                RET     
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 31  

             ; FUNCTION PECI_Enable (END)

             ; FUNCTION PECI_Disable (BEGIN)
                                           ; SOURCE LINE # 33
                                           ; SOURCE LINE # 34
                                           ; SOURCE LINE # 36
0000 22                RET     
             ; FUNCTION PECI_Disable (END)

             ; FUNCTION PECI_InitTimeOutTimer (BEGIN)
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 42
                                           ; SOURCE LINE # 43
0000 C28E              CLR     TR1
                                           ; SOURCE LINE # 44
0002 C2AB              CLR     ET1
                                           ; SOURCE LINE # 45
0004 00                NOP     
                                           ; SOURCE LINE # 46
0005 00                NOP     
                                           ; SOURCE LINE # 47
0006 00                NOP     
                                           ; SOURCE LINE # 48
0007 00                NOP     
                                           ; SOURCE LINE # 49
                                           ; SOURCE LINE # 50
                                           ; SOURCE LINE # 51
                                           ; SOURCE LINE # 52
0008 120000      R     LCALL   L?0289
                                           ; SOURCE LINE # 53
000B 22                RET     
             ; FUNCTION PECI_InitTimeOutTimer (END)

             ; FUNCTION _PECI_CalcCRC8 (BEGIN)
                                           ; SOURCE LINE # 58
0000 900000      R     MOV     DPTR,#sourcebyte
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 59
                                           ; SOURCE LINE # 89
0005 22                RET     
             ; FUNCTION _PECI_CalcCRC8 (END)

             ; FUNCTION PECI_HostEnable (BEGIN)
                                           ; SOURCE LINE # 94
                                           ; SOURCE LINE # 95
                                           ; SOURCE LINE # 96
0000 900000      E     MOV     DPTR,#HOCTLR
0003 E0                MOVX    A,@DPTR
0004 443C              ORL     A,#03CH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 97
0007 22                RET     
             ; FUNCTION PECI_HostEnable (END)

             ; FUNCTION PECI_HostDisable (BEGIN)
                                           ; SOURCE LINE # 102
                                           ; SOURCE LINE # 103
                                           ; SOURCE LINE # 104
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#HOCTLR
0004 F0                MOVX    @DPTR,A
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 32  

                                           ; SOURCE LINE # 105
0005 22                RET     
             ; FUNCTION PECI_HostDisable (END)

             ; FUNCTION _PECI_HostControl (BEGIN)
                                           ; SOURCE LINE # 110
;---- Variable 'control' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 111
                                           ; SOURCE LINE # 112
0000 900000      E     MOV     DPTR,#HOCTLR
0003 E0                MOVX    A,@DPTR
0004 4F                ORL     A,R7
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 113
0006 22                RET     
             ; FUNCTION _PECI_HostControl (END)

             ; FUNCTION PECI_CheckHostBusy (BEGIN)
                                           ; SOURCE LINE # 121
                                           ; SOURCE LINE # 122
                                           ; SOURCE LINE # 123
0000 120000      R     LCALL   PECI_InitTimeOutTimer
0003         ?C0009:
                                           ; SOURCE LINE # 125
0003 208F0A            JB      TF1,?C0010
                                           ; SOURCE LINE # 126
                                           ; SOURCE LINE # 127
0006 900000      E     MOV     DPTR,#HOSTAR
0009 E0                MOVX    A,@DPTR
000A 20E0F6            JB      ACC.0,?C0009
                                           ; SOURCE LINE # 128
                                           ; SOURCE LINE # 129
                                           ; SOURCE LINE # 130
                                           ; SOURCE LINE # 131
000D 120000      R     LCALL   L?0291
                                           ; SOURCE LINE # 132
                                           ; SOURCE LINE # 133
                                           ; SOURCE LINE # 134
0010         ?C0010:
                                           ; SOURCE LINE # 136
0010 308F06            JNB     TF1,?C0012
                                           ; SOURCE LINE # 137
                                           ; SOURCE LINE # 138
                                           ; SOURCE LINE # 139
                                           ; SOURCE LINE # 140
0013 120000      R     LCALL   L?0291
                                           ; SOURCE LINE # 141
0016 7F00              MOV     R7,#00H
0018 22                RET     
                                           ; SOURCE LINE # 142
0019         ?C0012:
                                           ; SOURCE LINE # 143
0019 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 144
001B         ?C0013:
001B 22                RET     
             ; FUNCTION PECI_CheckHostBusy (END)

             ; FUNCTION PECI_CheckHostFinish (BEGIN)
                                           ; SOURCE LINE # 152
;---- Variable 'status' assigned to Register 'R3' ----
;---- Variable 'result' assigned to Register 'R6' ----
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 33  

                                           ; SOURCE LINE # 153
                                           ; SOURCE LINE # 156
;---- Variable 'error' assigned to Register 'R5' ----
0000 7D04              MOV     R5,#04H
                                           ; SOURCE LINE # 158
0002 120000      R     LCALL   PECI_InitTimeOutTimer
0005         ?C0014:
                                           ; SOURCE LINE # 159
0005 208F39            JB      TF1,?C0015
                                           ; SOURCE LINE # 160
                                           ; SOURCE LINE # 161
0008 900000      E     MOV     DPTR,#HOSTAR
000B E0                MOVX    A,@DPTR
000C FB                MOV     R3,A
                                           ; SOURCE LINE # 163
000D 60F6              JZ      ?C0014
                                           ; SOURCE LINE # 164
                                           ; SOURCE LINE # 165
000F 30E104            JNB     ACC.1,?C0017
                                           ; SOURCE LINE # 166
                                           ; SOURCE LINE # 167
0012 E4                CLR     A
0013 FD                MOV     R5,A
                                           ; SOURCE LINE # 168
0014 802B              SJMP    ?C0015
                                           ; SOURCE LINE # 169
0016         ?C0017:
                                           ; SOURCE LINE # 170
0016 EB                MOV     A,R3
0017 30E204            JNB     ACC.2,?C0019
                                           ; SOURCE LINE # 171
                                           ; SOURCE LINE # 172
001A 7D01              MOV     R5,#01H
                                           ; SOURCE LINE # 173
001C 8023              SJMP    ?C0015
                                           ; SOURCE LINE # 174
001E         ?C0019:
                                           ; SOURCE LINE # 175
001E EB                MOV     A,R3
001F 30E304            JNB     ACC.3,?C0021
                                           ; SOURCE LINE # 176
                                           ; SOURCE LINE # 177
0022 7D01              MOV     R5,#01H
                                           ; SOURCE LINE # 178
0024 801B              SJMP    ?C0015
                                           ; SOURCE LINE # 179
0026         ?C0021:
                                           ; SOURCE LINE # 180
0026 EB                MOV     A,R3
0027 30E502            JNB     ACC.5,?C0023
                                           ; SOURCE LINE # 181
                                           ; SOURCE LINE # 182
                                           ; SOURCE LINE # 183
                                           ; SOURCE LINE # 184
002A 8004              SJMP    ?C0245
                                           ; SOURCE LINE # 185
002C         ?C0023:
                                           ; SOURCE LINE # 186
002C EB                MOV     A,R3
002D 30E60B            JNB     ACC.6,?C0025
                                           ; SOURCE LINE # 187
                                           ; SOURCE LINE # 188
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 34  

0030         ?C0245:
0030 900000      E     MOV     DPTR,#RSTC4
0033 E0                MOVX    A,@DPTR
0034 4410              ORL     A,#010H
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 189
0037 7D02              MOV     R5,#02H
                                           ; SOURCE LINE # 190
0039 8006              SJMP    ?C0015
                                           ; SOURCE LINE # 191
003B         ?C0025:
                                           ; SOURCE LINE # 192
003B EB                MOV     A,R3
003C 30E7C6            JNB     ACC.7,?C0014
                                           ; SOURCE LINE # 193
                                           ; SOURCE LINE # 194
003F 7D03              MOV     R5,#03H
                                           ; SOURCE LINE # 195
                                           ; SOURCE LINE # 196
                                           ; SOURCE LINE # 197
                                           ; SOURCE LINE # 198
0041         ?C0015:
                                           ; SOURCE LINE # 200
0041 ED                MOV     A,R5
0042 6004              JZ      ?C0028
                                           ; SOURCE LINE # 201
                                           ; SOURCE LINE # 202
0044 E4                CLR     A
0045 FE                MOV     R6,A
                                           ; SOURCE LINE # 203
0046 8002              SJMP    ?C0029
0048         ?C0028:
                                           ; SOURCE LINE # 205
                                           ; SOURCE LINE # 206
0048 7E01              MOV     R6,#01H
                                           ; SOURCE LINE # 207
004A         ?C0029:
                                           ; SOURCE LINE # 209
                                           ; SOURCE LINE # 210
                                           ; SOURCE LINE # 211
004A 120000      R     LCALL   L?0292
                                           ; SOURCE LINE # 212
004D CF                XCH     A,R7
004E EE                MOV     A,R6
004F CF                XCH     A,R7
                                           ; SOURCE LINE # 213
0050         ?C0030:
0050 22                RET     
             ; FUNCTION PECI_CheckHostFinish (END)

             ; FUNCTION ResetPECIStatus (BEGIN)
                                           ; SOURCE LINE # 218
                                           ; SOURCE LINE # 219
                                           ; SOURCE LINE # 220
0000 900000      E     MOV     DPTR,#HOSTAR
0003 74FE              MOV     A,#0FEH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 221
0006 22                RET     
             ; FUNCTION ResetPECIStatus (END)

             ; FUNCTION _PECI_Ping (BEGIN)
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 35  

                                           ; SOURCE LINE # 233
;---- Variable 'addr' assigned to Register 'R7' ----
;---- Variable 'WriteLen' assigned to Register 'R3' ----
;---- Variable 'ReadLen' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 234
                                           ; SOURCE LINE # 236
;---- Variable 'done' assigned to Register 'R4' ----
                                           ; SOURCE LINE # 238
                                           ; SOURCE LINE # 239
0000 120000      R     LCALL   L?0266
                                           ; SOURCE LINE # 240
0003 900000      E     MOV     DPTR,#HOWRLR
0006 EB                MOV     A,R3
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 241
0008 900000      E     MOV     DPTR,#HORDLR
000B ED                MOV     A,R5
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 243
000D 120000      R     LCALL   PECI_CheckHostBusy
0010 EF                MOV     A,R7
0011 6006              JZ      ?C0032
                                           ; SOURCE LINE # 244
                                           ; SOURCE LINE # 245
                                           ; SOURCE LINE # 246
0013 120000      R     LCALL   L?0270
0016 6001              JZ      ?C0032
                                           ; SOURCE LINE # 247
                                           ; SOURCE LINE # 248
0018 0C                INC     R4
                                           ; SOURCE LINE # 249
                                           ; SOURCE LINE # 250
0019         ?C0032:
                                           ; SOURCE LINE # 252
                                           ; SOURCE LINE # 253
                                           ; SOURCE LINE # 254
0019 120000      R     LCALL   L?0278
                                           ; SOURCE LINE # 255
001C         ?C0034:
001C 22                RET     
             ; FUNCTION _PECI_Ping (END)

             ; FUNCTION _PECI_GetDIB (BEGIN)
                                           ; SOURCE LINE # 268
0000 900000      R     MOV     DPTR,#ReadData
;---- Variable 'addr' assigned to Register 'R7' ----
;---- Variable 'ReadLen' assigned to Register 'R3' ----
                                           ; SOURCE LINE # 269
                                           ; SOURCE LINE # 271
;---- Variable 'done' assigned to Register 'R4' ----
                                           ; SOURCE LINE # 273
                                           ; SOURCE LINE # 274
0003 120000      R     LCALL   L?0264
                                           ; SOURCE LINE # 275
0006 900000      R     MOV     DPTR,#WriteLen
0009 E0                MOVX    A,@DPTR
000A 900000      E     MOV     DPTR,#HOWRLR
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 276
000E 900000      E     MOV     DPTR,#HORDLR
0011 EB                MOV     A,R3
0012 F0                MOVX    @DPTR,A
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 36  

                                           ; SOURCE LINE # 277
0013 900000      E     MOV     DPTR,#HOCMDR
0016 74F7              MOV     A,#0F7H
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 279
0019 120000      R     LCALL   PECI_CheckHostBusy
001C EF                MOV     A,R7
001D 6026              JZ      ?C0035
                                           ; SOURCE LINE # 280
                                           ; SOURCE LINE # 281
                                           ; SOURCE LINE # 282
001F 120000      R     LCALL   L?0270
0022 6021              JZ      ?C0035
                                           ; SOURCE LINE # 283
                                           ; SOURCE LINE # 284
;---- Variable 'index' assigned to Register 'R7' ----
0024 E4                CLR     A
0025 FF                MOV     R7,A
0026         ?C0037:
0026 120000      R     LCALL   L?0298
0029 5018              JNC     ?C0038
                                           ; SOURCE LINE # 285
                                           ; SOURCE LINE # 286
002B 900000      E     MOV     DPTR,#HORDDR
002E E0                MOVX    A,@DPTR
002F FE                MOV     R6,A
0030 900000      R     MOV     DPTR,#ReadData
0033 E0                MOVX    A,@DPTR
0034 FA                MOV     R2,A
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 2F                ADD     A,R7
0038 F582              MOV     DPL,A
003A E4                CLR     A
003B 3A                ADDC    A,R2
003C F583              MOV     DPH,A
003E EE                MOV     A,R6
003F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 287
0040 0F                INC     R7
0041 80E3              SJMP    ?C0037
0043         ?C0038:
                                           ; SOURCE LINE # 288
0043 7C01              MOV     R4,#01H
                                           ; SOURCE LINE # 289
                                           ; SOURCE LINE # 290
0045         ?C0035:
                                           ; SOURCE LINE # 292
                                           ; SOURCE LINE # 293
                                           ; SOURCE LINE # 294
0045 120000      R     LCALL   L?0278
                                           ; SOURCE LINE # 295
0048         ?C0040:
0048 22                RET     
             ; FUNCTION _PECI_GetDIB (END)

             ; FUNCTION _PECI_GetTemp (BEGIN)
                                           ; SOURCE LINE # 310
0000 900000      R     MOV     DPTR,#ReadData
;---- Variable 'addr' assigned to Register 'R7' ----
;---- Variable 'Domain' assigned to Register 'R3' ----
                                           ; SOURCE LINE # 311
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 37  

                                           ; SOURCE LINE # 313
;---- Variable 'done' assigned to Register 'R4' ----
                                           ; SOURCE LINE # 315
                                           ; SOURCE LINE # 316
0003 120000      R     LCALL   L?0264
                                           ; SOURCE LINE # 317
0006 900000      R     MOV     DPTR,#WriteLen
0009 E0                MOVX    A,@DPTR
000A 900000      E     MOV     DPTR,#HOWRLR
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 318
000E 900000      R     MOV     DPTR,#ReadLen
                                           ; SOURCE LINE # 319
0011 120000      R     LCALL   L?0293
0014 5008              JNC     ?C0041
                                           ; SOURCE LINE # 320
                                           ; SOURCE LINE # 321
0016 EB                MOV     A,R3
0017 04                INC     A
0018 900000      E     MOV     DPTR,#HOCMDR
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 322
001C 8006              SJMP    ?C0042
001E         ?C0041:
                                           ; SOURCE LINE # 324
                                           ; SOURCE LINE # 325
001E 900000      E     MOV     DPTR,#HOCMDR
0021 7401              MOV     A,#01H
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 326
0024         ?C0042:
                                           ; SOURCE LINE # 328
0024 120000      R     LCALL   PECI_CheckHostBusy
0027 EF                MOV     A,R7
0028 602F              JZ      ?C0043
                                           ; SOURCE LINE # 329
                                           ; SOURCE LINE # 330
                                           ; SOURCE LINE # 331
002A 120000      R     LCALL   L?0271
002D 602A              JZ      ?C0043
                                           ; SOURCE LINE # 332
                                           ; SOURCE LINE # 333
002F 900000      E     MOV     DPTR,#HORDDR
0032 E0                MOVX    A,@DPTR
0033 FF                MOV     R7,A
0034 900000      R     MOV     DPTR,#ReadData
0037 E0                MOVX    A,@DPTR
0038 FC                MOV     R4,A
0039 A3                INC     DPTR
003A E0                MOVX    A,@DPTR
003B F582              MOV     DPL,A
003D 8C83              MOV     DPH,R4
003F EF                MOV     A,R7
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 334
0041 900000      E     MOV     DPTR,#HORDDR
0044 E0                MOVX    A,@DPTR
0045 FF                MOV     R7,A
0046 900000      R     MOV     DPTR,#ReadData
0049 E4                CLR     A
004A 75F001            MOV     B,#01H
004D 120000      E     LCALL   ?C?IILDX
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 38  

0050 85F082            MOV     DPL,B
0053 F583              MOV     DPH,A
0055 EF                MOV     A,R7
0056 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 335
0057 7C01              MOV     R4,#01H
                                           ; SOURCE LINE # 336
                                           ; SOURCE LINE # 337
0059         ?C0043:
                                           ; SOURCE LINE # 339
                                           ; SOURCE LINE # 340
                                           ; SOURCE LINE # 341
0059 120000      R     LCALL   L?0279
                                           ; SOURCE LINE # 342
005C         ?C0045:
005C 22                RET     
             ; FUNCTION _PECI_GetTemp (END)

             ; FUNCTION _PECI_RdPkgConfig (BEGIN)
                                           ; SOURCE LINE # 361
0000 900000      R     MOV     DPTR,#ReadData
;---- Variable 'addr' assigned to Register 'R7' ----
;---- Variable 'Domain' assigned to Register 'R3' ----
                                           ; SOURCE LINE # 362
                                           ; SOURCE LINE # 364
;---- Variable 'done' assigned to Register 'R4' ----
                                           ; SOURCE LINE # 366
                                           ; SOURCE LINE # 367
0003 120000      R     LCALL   L?0265
                                           ; SOURCE LINE # 368
0006 900000      R     MOV     DPTR,#WriteLen
0009 E0                MOVX    A,@DPTR
000A 900000      E     MOV     DPTR,#HOWRLR
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 369
000E 900000      R     MOV     DPTR,#ReadLen
                                           ; SOURCE LINE # 370
0011 120000      R     LCALL   L?0293
0014 5009              JNC     ?C0046
                                           ; SOURCE LINE # 371
                                           ; SOURCE LINE # 372
0016 EB                MOV     A,R3
0017 24A1              ADD     A,#0A1H
0019 900000      E     MOV     DPTR,#HOCMDR
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 373
001D 8006              SJMP    ?C0047
001F         ?C0046:
                                           ; SOURCE LINE # 375
                                           ; SOURCE LINE # 376
001F 900000      E     MOV     DPTR,#HOCMDR
0022 74A1              MOV     A,#0A1H
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 377
0025         ?C0047:
                                           ; SOURCE LINE # 379
0025 900000      R     MOV     DPTR,#Retry
0028 E0                MOVX    A,@DPTR
0029 FF                MOV     R7,A
002A C3                CLR     C
002B 9402              SUBB    A,#02H
002D 5009              JNC     ?C0048
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 39  

                                           ; SOURCE LINE # 380
                                           ; SOURCE LINE # 381
002F EF                MOV     A,R7
0030 2402              ADD     A,#02H
0032 900000      E     MOV     DPTR,#HOWRDR
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 382
0036 8003              SJMP    ?C0049
0038         ?C0048:
                                           ; SOURCE LINE # 384
                                           ; SOURCE LINE # 385
0038 120000      R     LCALL   L?0305
                                           ; SOURCE LINE # 386
003B         ?C0049:
                                           ; SOURCE LINE # 388
003B 900000      R     MOV     DPTR,#Index
003E E0                MOVX    A,@DPTR
003F 900000      E     MOV     DPTR,#HOWRDR
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 389
0043 900000      R     MOV     DPTR,#LSB
0046 E0                MOVX    A,@DPTR
0047 900000      E     MOV     DPTR,#HOWRDR
004A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 390
004B 900000      R     MOV     DPTR,#MSB
                                           ; SOURCE LINE # 392
004E 120000      R     LCALL   L?0307
0051 603A              JZ      ?C0050
                                           ; SOURCE LINE # 393
                                           ; SOURCE LINE # 394
                                           ; SOURCE LINE # 395
0053 120000      R     LCALL   L?0271
0056 6035              JZ      ?C0050
                                           ; SOURCE LINE # 396
                                           ; SOURCE LINE # 397
0058 900000      E     MOV     DPTR,#HORDLR
005B E0                MOVX    A,@DPTR
005C 602D              JZ      ?C0052
                                           ; SOURCE LINE # 398
                                           ; SOURCE LINE # 399
;---- Variable 'cunt' assigned to Register 'R7' ----
005E E4                CLR     A
005F FF                MOV     R7,A
0060         ?C0053:
0060 120000      R     LCALL   L?0298
0063 5017              JNC     ?C0054
                                           ; SOURCE LINE # 400
                                           ; SOURCE LINE # 401
0065 EF                MOV     A,R7
0066 900000      E     MOV     DPTR,#HORDDR
0069 7007              JNZ     ?C0056
                                           ; SOURCE LINE # 402
                                           ; SOURCE LINE # 403
006B E0                MOVX    A,@DPTR
006C 900000      E     MOV     DPTR,#PECI_CompletionCode
006F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 404
0070 8007              SJMP    ?C0055
0072         ?C0056:
                                           ; SOURCE LINE # 406
                                           ; SOURCE LINE # 407
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 40  

0072 E0                MOVX    A,@DPTR
0073 900000      R     MOV     DPTR,#ReadData
0076 120000      R     LCALL   L?0280
                                           ; SOURCE LINE # 408
                                           ; SOURCE LINE # 409
0079         ?C0055:
0079 0F                INC     R7
007A 80E4              SJMP    ?C0053
007C         ?C0054:
                                           ; SOURCE LINE # 411
007C 900000      E     MOV     DPTR,#PECI_CompletionCode
007F E0                MOVX    A,@DPTR
0080 B44004            CJNE    A,#040H,?C0058
                                           ; SOURCE LINE # 412
                                           ; SOURCE LINE # 413
0083 7C01              MOV     R4,#01H
                                           ; SOURCE LINE # 414
0085 8006              SJMP    ?C0050
0087         ?C0058:
                                           ; SOURCE LINE # 416
                                           ; SOURCE LINE # 417
0087 E4                CLR     A
0088 FC                MOV     R4,A
                                           ; SOURCE LINE # 418
                                           ; SOURCE LINE # 419
0089 8002              SJMP    ?C0050
008B         ?C0052:
                                           ; SOURCE LINE # 421
                                           ; SOURCE LINE # 422
008B E4                CLR     A
008C FC                MOV     R4,A
                                           ; SOURCE LINE # 423
                                           ; SOURCE LINE # 424
                                           ; SOURCE LINE # 425
008D         ?C0050:
                                           ; SOURCE LINE # 427
                                           ; SOURCE LINE # 428
                                           ; SOURCE LINE # 429
008D 120000      R     LCALL   L?0279
                                           ; SOURCE LINE # 430
0090         ?C0061:
0090 22                RET     
             ; FUNCTION _PECI_RdPkgConfig (END)

             ; FUNCTION _PECI_WrPkgConfig (BEGIN)
                                           ; SOURCE LINE # 449
;---- Variable 'addr' assigned to Register 'R6' ----
0000 CE                XCH     A,R6
0001 EF                MOV     A,R7
0002 CE                XCH     A,R6
;---- Variable 'Domain' assigned to Register 'R3' ----
;---- Variable 'WriteData' assigned to Register 'R4/R5' ----
                                           ; SOURCE LINE # 450
                                           ; SOURCE LINE # 452
;---- Variable 'done' assigned to Register 'R2' ----
0003 E4                CLR     A
0004 FA                MOV     R2,A
                                           ; SOURCE LINE # 454
0005 900000      E     MOV     DPTR,#PECI_CompletionCode
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 455
0009 120000      R     LCALL   PECI_HostEnable
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 41  

                                           ; SOURCE LINE # 460
000C 7F02              MOV     R7,#02H
000E 120000      R     LCALL   _PECI_HostControl
                                           ; SOURCE LINE # 463
0011 900000      E     MOV     DPTR,#HOTRADDR
0014 EE                MOV     A,R6
0015 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 464
0016 FF                MOV     R7,A
0017 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 465
001A 900000      R     MOV     DPTR,#WriteLen
001D E0                MOVX    A,@DPTR
001E FF                MOV     R7,A
001F 900000      E     MOV     DPTR,#HOWRLR
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 466
0023 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 467
0026 900000      R     MOV     DPTR,#ReadLen
0029 E0                MOVX    A,@DPTR
002A FF                MOV     R7,A
002B 900000      E     MOV     DPTR,#HORDLR
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 468
002F 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 470
0032 EB                MOV     A,R3
0033 C3                CLR     C
0034 9402              SUBB    A,#02H
0036 500A              JNC     ?C0062
                                           ; SOURCE LINE # 471
                                           ; SOURCE LINE # 472
0038 EB                MOV     A,R3
0039 24A5              ADD     A,#0A5H
003B FF                MOV     R7,A
003C 900000      E     MOV     DPTR,#HOCMDR
003F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 473
                                           ; SOURCE LINE # 474
0040 8007              SJMP    ?C0246
0042         ?C0062:
                                           ; SOURCE LINE # 476
                                           ; SOURCE LINE # 477
0042 900000      E     MOV     DPTR,#HOCMDR
0045 74A5              MOV     A,#0A5H
0047 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 478
0048 FF                MOV     R7,A
0049         ?C0246:
0049 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 479
004C         ?C0063:
                                           ; SOURCE LINE # 481
004C 900000      R     MOV     DPTR,#Retry
004F E0                MOVX    A,@DPTR
0050 FF                MOV     R7,A
0051 C3                CLR     C
0052 9402              SUBB    A,#02H
0054 500A              JNC     ?C0064
                                           ; SOURCE LINE # 482
                                           ; SOURCE LINE # 483
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 42  

0056 EF                MOV     A,R7
0057 2402              ADD     A,#02H
0059 FF                MOV     R7,A
005A 900000      E     MOV     DPTR,#HOWRDR
005D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 484
                                           ; SOURCE LINE # 485
005E 8004              SJMP    ?C0247
0060         ?C0064:
                                           ; SOURCE LINE # 487
                                           ; SOURCE LINE # 488
0060 120000      R     LCALL   L?0305
                                           ; SOURCE LINE # 489
0063 FF                MOV     R7,A
0064         ?C0247:
0064 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 490
0067         ?C0065:
                                           ; SOURCE LINE # 492
0067 900000      R     MOV     DPTR,#Index
                                           ; SOURCE LINE # 493
006A 120000      R     LCALL   L?0297
                                           ; SOURCE LINE # 494
006D 900000      R     MOV     DPTR,#LSB
                                           ; SOURCE LINE # 495
0070 120000      R     LCALL   L?0297
                                           ; SOURCE LINE # 496
0073 900000      R     MOV     DPTR,#MSB
0076 E0                MOVX    A,@DPTR
0077 FF                MOV     R7,A
0078 900000      E     MOV     DPTR,#HOWRDR
007B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 497
007C 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 499
;---- Variable 'cunt' assigned to Register 'R6' ----
007F E4                CLR     A
0080 FE                MOV     R6,A
0081         ?C0066:
0081 900000      R     MOV     DPTR,#WriteLen
0084 E0                MOVX    A,@DPTR
0085 24FA              ADD     A,#0FAH
0087 FF                MOV     R7,A
0088 EE                MOV     A,R6
0089 C3                CLR     C
008A 9F                SUBB    A,R7
008B 5011              JNC     ?C0067
                                           ; SOURCE LINE # 500
                                           ; SOURCE LINE # 501
008D 120000      R     LCALL   L?0308
0090 900000      E     MOV     DPTR,#HOWRDR
0093 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 502
0094 120000      R     LCALL   L?0308
0097 FF                MOV     R7,A
0098 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 503
009B 0E                INC     R6
009C 80E3              SJMP    ?C0066
009E         ?C0067:
                                           ; SOURCE LINE # 510
009E 120000      R     LCALL   PECI_CheckHostBusy
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 43  

00A1 EF                MOV     A,R7
00A2 6017              JZ      ?C0069
                                           ; SOURCE LINE # 511
                                           ; SOURCE LINE # 512
                                           ; SOURCE LINE # 513
00A4 120000      R     LCALL   L?0271
00A7 6012              JZ      ?C0069
                                           ; SOURCE LINE # 514
                                           ; SOURCE LINE # 515
00A9 900000      E     MOV     DPTR,#HORDDR
00AC E0                MOVX    A,@DPTR
00AD 900000      E     MOV     DPTR,#PECI_CompletionCode
00B0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 516
00B1 E0                MOVX    A,@DPTR
00B2 B44004            CJNE    A,#040H,?C0071
                                           ; SOURCE LINE # 517
                                           ; SOURCE LINE # 518
00B5 7A01              MOV     R2,#01H
                                           ; SOURCE LINE # 519
00B7 8002              SJMP    ?C0069
00B9         ?C0071:
                                           ; SOURCE LINE # 521
                                           ; SOURCE LINE # 522
00B9 E4                CLR     A
00BA FA                MOV     R2,A
                                           ; SOURCE LINE # 523
                                           ; SOURCE LINE # 524
                                           ; SOURCE LINE # 525
00BB         ?C0069:
                                           ; SOURCE LINE # 527
00BB 120000      R     LCALL   PECI_HostDisable
                                           ; SOURCE LINE # 528
00BE 120000      R     LCALL   ResetPECIStatus
                                           ; SOURCE LINE # 529
00C1 CF                XCH     A,R7
00C2 EA                MOV     A,R2
00C3 CF                XCH     A,R7
                                           ; SOURCE LINE # 530
00C4         ?C0073:
00C4 22                RET     
00C5         L?0297:
00C5 E0                MOVX    A,@DPTR
00C6 FF                MOV     R7,A
00C7 900000      E     MOV     DPTR,#HOWRDR
00CA F0                MOVX    @DPTR,A
00CB 120000      R     LCALL   _PECI_CalcCRC8
00CE 22                RET     
             ; FUNCTION _PECI_WrPkgConfig (END)

             ; FUNCTION _PECI_RdIAMSR (BEGIN)
                                           ; SOURCE LINE # 549
0000 900000      R     MOV     DPTR,#ReadData
;---- Variable 'addr' assigned to Register 'R7' ----
;---- Variable 'Domain' assigned to Register 'R3' ----
                                           ; SOURCE LINE # 550
                                           ; SOURCE LINE # 552
;---- Variable 'done' assigned to Register 'R4' ----
                                           ; SOURCE LINE # 554
                                           ; SOURCE LINE # 555
0003 120000      R     LCALL   L?0265
                                           ; SOURCE LINE # 556
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 44  

0006 900000      R     MOV     DPTR,#WriteLen
0009 E0                MOVX    A,@DPTR
000A 900000      E     MOV     DPTR,#HOWRLR
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 557
000E 900000      R     MOV     DPTR,#ReadLen
                                           ; SOURCE LINE # 558
0011 120000      R     LCALL   L?0294
0014 5009              JNC     ?C0074
                                           ; SOURCE LINE # 559
                                           ; SOURCE LINE # 560
0016 EB                MOV     A,R3
0017 24B1              ADD     A,#0B1H
0019 900000      E     MOV     DPTR,#HOCMDR
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 561
001D 8006              SJMP    ?C0075
001F         ?C0074:
                                           ; SOURCE LINE # 563
                                           ; SOURCE LINE # 564
001F 900000      E     MOV     DPTR,#HOCMDR
0022 74B1              MOV     A,#0B1H
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 565
0025         ?C0075:
                                           ; SOURCE LINE # 567
0025 900000      R     MOV     DPTR,#Retry
0028 E0                MOVX    A,@DPTR
0029 FF                MOV     R7,A
002A C3                CLR     C
002B 9402              SUBB    A,#02H
002D 5009              JNC     ?C0076
                                           ; SOURCE LINE # 568
                                           ; SOURCE LINE # 569
002F EF                MOV     A,R7
0030 2402              ADD     A,#02H
0032 900000      E     MOV     DPTR,#HOWRDR
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 570
0036 8003              SJMP    ?C0077
0038         ?C0076:
                                           ; SOURCE LINE # 572
                                           ; SOURCE LINE # 573
0038 120000      R     LCALL   L?0306
                                           ; SOURCE LINE # 574
003B         ?C0077:
                                           ; SOURCE LINE # 576
003B 900000      R     MOV     DPTR,#ProcessorID
003E E0                MOVX    A,@DPTR
003F 900000      E     MOV     DPTR,#HOWRDR
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 577
0043 900000      R     MOV     DPTR,#LSB
0046 E0                MOVX    A,@DPTR
0047 900000      E     MOV     DPTR,#HOWRDR
004A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 578
004B 900000      R     MOV     DPTR,#MSB
                                           ; SOURCE LINE # 580
004E 120000      R     LCALL   L?0307
0051 6030              JZ      ?C0078
                                           ; SOURCE LINE # 581
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 45  

                                           ; SOURCE LINE # 582
                                           ; SOURCE LINE # 583
0053 120000      R     LCALL   L?0271
0056 602B              JZ      ?C0078
                                           ; SOURCE LINE # 584
                                           ; SOURCE LINE # 585
;---- Variable 'cunt' assigned to Register 'R7' ----
0058 E4                CLR     A
0059 FF                MOV     R7,A
005A         ?C0080:
005A 120000      R     LCALL   L?0299
005D 5017              JNC     ?C0081
                                           ; SOURCE LINE # 586
                                           ; SOURCE LINE # 587
005F EF                MOV     A,R7
0060 900000      E     MOV     DPTR,#HORDDR
0063 7007              JNZ     ?C0083
                                           ; SOURCE LINE # 588
                                           ; SOURCE LINE # 589
0065 E0                MOVX    A,@DPTR
0066 900000      E     MOV     DPTR,#PECI_CompletionCode
0069 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 590
006A 8007              SJMP    ?C0082
006C         ?C0083:
                                           ; SOURCE LINE # 592
                                           ; SOURCE LINE # 593
006C E0                MOVX    A,@DPTR
006D 900000      R     MOV     DPTR,#ReadData
0070 120000      R     LCALL   L?0280
                                           ; SOURCE LINE # 594
                                           ; SOURCE LINE # 595
0073         ?C0082:
0073 0F                INC     R7
0074 80E4              SJMP    ?C0080
0076         ?C0081:
                                           ; SOURCE LINE # 597
0076 900000      E     MOV     DPTR,#PECI_CompletionCode
0079 E0                MOVX    A,@DPTR
007A B44004            CJNE    A,#040H,?C0085
                                           ; SOURCE LINE # 598
                                           ; SOURCE LINE # 599
007D 7C01              MOV     R4,#01H
                                           ; SOURCE LINE # 600
007F 8002              SJMP    ?C0078
0081         ?C0085:
                                           ; SOURCE LINE # 602
                                           ; SOURCE LINE # 603
0081 E4                CLR     A
0082 FC                MOV     R4,A
                                           ; SOURCE LINE # 604
                                           ; SOURCE LINE # 605
                                           ; SOURCE LINE # 606
0083         ?C0078:
                                           ; SOURCE LINE # 608
                                           ; SOURCE LINE # 609
                                           ; SOURCE LINE # 610
0083 120000      R     LCALL   L?0279
                                           ; SOURCE LINE # 611
0086         ?C0087:
0086 22                RET     
             ; FUNCTION _PECI_RdIAMSR (END)
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 46  


             ; FUNCTION PECI_ClearTCVariables (BEGIN)
                                           ; SOURCE LINE # 616
                                           ; SOURCE LINE # 617
                                           ; SOURCE LINE # 618
0000 120000      R     LCALL   PECI_ClearPowerSKUUnit
                                           ; SOURCE LINE # 619
0003 E4                CLR     A
0004 900000      E     MOV     DPTR,#PECI_PL1TDP
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 620
0008 900000      E     MOV     DPTR,#PECI_MAXPL2
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 621
000C 900000      E     MOV     DPTR,#PECI_PL2Watts
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 622
0010 900000      E     MOV     DPTR,#PECI_PL1Time
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 623
0014 900000      E     MOV     DPTR,#PECI_Ctrl
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 624
0018 900000      E     MOV     DPTR,#PECI_Algorithm_Delay
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 625
001C 22                RET     
             ; FUNCTION PECI_ClearTCVariables (END)

             ; FUNCTION PECI_ClearPowerSKUUnit (BEGIN)
                                           ; SOURCE LINE # 630
                                           ; SOURCE LINE # 631
                                           ; SOURCE LINE # 632
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#PECI_PowerUnit
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 633
0005 900000      E     MOV     DPTR,#PECI_EnergyUnit
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 634
0009 900000      E     MOV     DPTR,#PECI_TimeUnit
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 635
000D 22                RET     
             ; FUNCTION PECI_ClearPowerSKUUnit (END)

             ; FUNCTION PECI_ReadPowerUnit (BEGIN)
                                           ; SOURCE LINE # 643
;---- Variable 'result' assigned to Register 'R1' ----
                                           ; SOURCE LINE # 644
                                           ; SOURCE LINE # 646
0000 120000      R     LCALL   L?0267
0003 741E              MOV     A,#01EH
0005 120000      R     LCALL   L?0258
0008 120000      R     LCALL   _PECI_RdPkgConfig
000B EF                MOV     A,R7
000C 6022              JZ      ?C0090
                                           ; SOURCE LINE # 647
                                           ; SOURCE LINE # 648
000E 900000      E     MOV     DPTR,#PECIReadBuffer
0011 E0                MOVX    A,@DPTR
0012 540F              ANL     A,#0FH
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 47  

0014 900000      E     MOV     DPTR,#PECI_PowerUnit
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 649
0018 900000      E     MOV     DPTR,#PECIReadBuffer+01H
001B E0                MOVX    A,@DPTR
001C 541F              ANL     A,#01FH
001E 900000      E     MOV     DPTR,#PECI_EnergyUnit
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 650
0022 900000      E     MOV     DPTR,#PECIReadBuffer+02H
0025 E0                MOVX    A,@DPTR
0026 540F              ANL     A,#0FH
0028 900000      E     MOV     DPTR,#PECI_TimeUnit
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 651
002C 7901              MOV     R1,#01H
                                           ; SOURCE LINE # 652
002E 8002              SJMP    ?C0091
0030         ?C0090:
                                           ; SOURCE LINE # 654
                                           ; SOURCE LINE # 655
0030 E4                CLR     A
0031 F9                MOV     R1,A
                                           ; SOURCE LINE # 656
0032         ?C0091:
                                           ; SOURCE LINE # 657
0032 CF                XCH     A,R7
0033 E9                MOV     A,R1
0034 CF                XCH     A,R7
                                           ; SOURCE LINE # 658
0035         ?C0092:
0035 22                RET     
             ; FUNCTION PECI_ReadPowerUnit (END)

             ; FUNCTION PECI_WritePowerLimit1 (BEGIN)
                                           ; SOURCE LINE # 666
;---- Variable 'reslut' assigned to Register 'R1' ----
                                           ; SOURCE LINE # 667
                                           ; SOURCE LINE # 674
0000 120000      R     LCALL   L?0275
0003 8005              SJMP    ?C0229
0005         ?C0228:
0005 C3                CLR     C
0006 33                RLC     A
0007 CE                XCH     A,R6
0008 33                RLC     A
0009 CE                XCH     A,R6
000A         ?C0229:
000A D8F9              DJNZ    R0,?C0228
000C 900000      R     MOV     DPTR,#UnitofPower+01H
000F F0                MOVX    @DPTR,A
0010 EE                MOV     A,R6
0011 900000      R     MOV     DPTR,#UnitofPower
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 675
0015 900000      E     MOV     DPTR,#PECI_PL1TDP
0018 E0                MOVX    A,@DPTR
0019 FF                MOV     R7,A
001A 7E00              MOV     R6,#00H
001C 900000      R     MOV     DPTR,#UnitofPower
001F E0                MOVX    A,@DPTR
0020 FC                MOV     R4,A
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 48  

0021 A3                INC     DPTR
0022 E0                MOVX    A,@DPTR
0023 FD                MOV     R5,A
0024 120000      E     LCALL   ?C?IMUL
0027 900000      R     MOV     DPTR,#PL1_TDPWatts
002A EE                MOV     A,R6
002B F0                MOVX    @DPTR,A
002C A3                INC     DPTR
002D EF                MOV     A,R7
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 677
002F 900000      E     MOV     DPTR,#PECI_TimeUnit
0032 120000      R     LCALL   L?0277
0035 8005              SJMP    ?C0231
0037         ?C0230:
0037 C3                CLR     C
0038 33                RLC     A
0039 CE                XCH     A,R6
003A 33                RLC     A
003B CE                XCH     A,R6
003C         ?C0231:
003C D8F9              DJNZ    R0,?C0230
003E 900000      R     MOV     DPTR,#UnitofTau+01H
0041 F0                MOVX    @DPTR,A
0042 EE                MOV     A,R6
0043 900000      R     MOV     DPTR,#UnitofTau
0046 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 679
;---- Variable 'PL1_PL1T' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 681
0047 900000      R     MOV     DPTR,#PL1_TDPWatts
004A E0                MOVX    A,@DPTR
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D 900000      E     MOV     DPTR,#PECIWriteBuffer
0050 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 682
0051 900000      R     MOV     DPTR,#PL1_TDPWatts
0054 E0                MOVX    A,@DPTR
0055 900000      E     MOV     DPTR,#PECIWriteBuffer+01H
0058 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 683
0059 A3                INC     DPTR
005A 74DC              MOV     A,#0DCH
005C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 684
005D E4                CLR     A
                                           ; SOURCE LINE # 686
005E 120000      R     LCALL   L?0304
0061 741A              MOV     A,#01AH
0063 120000      R     LCALL   L?0283
0066 120000      R     LCALL   _PECI_WrPkgConfig
0069 EF                MOV     A,R7
006A 6004              JZ      ?C0093
                                           ; SOURCE LINE # 687
                                           ; SOURCE LINE # 688
006C 7901              MOV     R1,#01H
                                           ; SOURCE LINE # 689
006E 8002              SJMP    ?C0094
0070         ?C0093:
                                           ; SOURCE LINE # 691
                                           ; SOURCE LINE # 692
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 49  

0070 E4                CLR     A
0071 F9                MOV     R1,A
                                           ; SOURCE LINE # 693
0072         ?C0094:
                                           ; SOURCE LINE # 694
0072 CF                XCH     A,R7
0073 E9                MOV     A,R1
0074 CF                XCH     A,R7
                                           ; SOURCE LINE # 695
0075         ?C0095:
0075 22                RET     
             ; FUNCTION PECI_WritePowerLimit1 (END)

             ; FUNCTION PECI_ReadPowerLimit1 (BEGIN)
                                           ; SOURCE LINE # 704
                                           ; SOURCE LINE # 705
                                           ; SOURCE LINE # 708
0000 120000      R     LCALL   L?0267
0003 741A              MOV     A,#01AH
0005 120000      R     LCALL   L?0258
0008 120000      R     LCALL   _PECI_RdPkgConfig
000B EF                MOV     A,R7
000C 6044              JZ      ?C0096
                                           ; SOURCE LINE # 709
                                           ; SOURCE LINE # 710
000E 900000      E     MOV     DPTR,#PECIReadBuffer+01H
0011 E0                MOVX    A,@DPTR
0012 547F              ANL     A,#07FH
0014 F0                MOVX    @DPTR,A
0015 FE                MOV     R6,A
0016 900000      E     MOV     DPTR,#PECIReadBuffer
0019 E0                MOVX    A,@DPTR
001A 7C00              MOV     R4,#00H
001C 2400              ADD     A,#00H
001E FB                MOV     R3,A
001F EC                MOV     A,R4
0020 3E                ADDC    A,R6
0021 FA                MOV     R2,A
0022 120000      R     LCALL   L?0275
0025 8005              SJMP    ?C0233
0027         ?C0232:
0027 C3                CLR     C
0028 33                RLC     A
0029 CE                XCH     A,R6
002A 33                RLC     A
002B CE                XCH     A,R6
002C         ?C0233:
002C D8F9              DJNZ    R0,?C0232
002E FD                MOV     R5,A
002F CC                XCH     A,R4
0030 EE                MOV     A,R6
0031 CC                XCH     A,R4
0032 CF                XCH     A,R7
0033 EB                MOV     A,R3
0034 CF                XCH     A,R7
0035 CE                XCH     A,R6
0036 EA                MOV     A,R2
0037 CE                XCH     A,R6
0038 120000      E     LCALL   ?C?UIDIV
003B 900000      E     MOV     DPTR,#PECI_PL1TDP
003E EF                MOV     A,R7
003F F0                MOVX    @DPTR,A
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 50  

                                           ; SOURCE LINE # 711
0040 900000      E     MOV     DPTR,#PECIReadBuffer+02H
0043 E0                MOVX    A,@DPTR
0044 C3                CLR     C
0045 13                RRC     A
0046 900000      E     MOV     DPTR,#PECI_PL1Time
0049 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 712
004A 900000      R     MOV     DPTR,#reslut
004D 7401              MOV     A,#01H
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 713
0050 8005              SJMP    ?C0097
0052         ?C0096:
                                           ; SOURCE LINE # 715
                                           ; SOURCE LINE # 716
0052 E4                CLR     A
0053 900000      R     MOV     DPTR,#reslut
0056 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 717
0057         ?C0097:
                                           ; SOURCE LINE # 718
0057 900000      R     MOV     DPTR,#reslut
005A E0                MOVX    A,@DPTR
005B FF                MOV     R7,A
                                           ; SOURCE LINE # 719
005C         ?C0098:
005C 22                RET     
             ; FUNCTION PECI_ReadPowerLimit1 (END)

             ; FUNCTION PECI_ACToDCModeTurboCtrl (BEGIN)
                                           ; SOURCE LINE # 724
                                           ; SOURCE LINE # 725
                                           ; SOURCE LINE # 729
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#retry
0004 F0                MOVX    @DPTR,A
0005         ?C0099:
                                           ; SOURCE LINE # 730
                                           ; SOURCE LINE # 731
0005 900000      E     MOV     DPTR,#PECI_PL1TDP
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A 120000      R     LCALL   _PECI_SETPL2Watts
                                           ; SOURCE LINE # 732
000D 900000      E     MOV     DPTR,#PECI_Ctrl
0010 E0                MOVX    A,@DPTR
0011 30E00C            JNB     ACC.0,?C0103
                                           ; SOURCE LINE # 733
                                           ; SOURCE LINE # 734
                                           ; SOURCE LINE # 735
                                           ; SOURCE LINE # 736
0014         ?C0101:
0014 900000      R     MOV     DPTR,#retry
0017 E0                MOVX    A,@DPTR
0018 04                INC     A
0019 F0                MOVX    @DPTR,A
001A E0                MOVX    A,@DPTR
001B C3                CLR     C
001C 9405              SUBB    A,#05H
001E 40E5              JC      ?C0099
                                           ; SOURCE LINE # 738
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 51  

0020         ?C0103:
0020 22                RET     
             ; FUNCTION PECI_ACToDCModeTurboCtrl (END)

             ; FUNCTION _PECI_SETPL2Watts (BEGIN)
                                           ; SOURCE LINE # 743
;---- Variable 'watts' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 744
                                           ; SOURCE LINE # 745
0000 900000      E     MOV     DPTR,#PECI_PL2Watts
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 746
0005 900000      E     MOV     DPTR,#PECI_Ctrl
0008 E0                MOVX    A,@DPTR
0009 4401              ORL     A,#01H
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 747
000C 900000      E     MOV     DPTR,#PECI_PL2Watts
000F E0                MOVX    A,@DPTR
0010 FF                MOV     R7,A
0011 020000      R     LJMP    _PECI_WritePowerLimit2
             ; FUNCTION _PECI_SETPL2Watts (END)

             ; FUNCTION _PECI_WritePowerLimit2 (BEGIN)
                                           ; SOURCE LINE # 753
;---- Variable 'watts' assigned to Register 'R5' ----
0000 CD                XCH     A,R5
0001 EF                MOV     A,R7
0002 CD                XCH     A,R5
                                           ; SOURCE LINE # 754
                                           ; SOURCE LINE # 759
0003 120000      R     LCALL   L?0276
0006 8005              SJMP    ?C0235
0008         ?C0234:
0008 C3                CLR     C
0009 33                RLC     A
000A CE                XCH     A,R6
000B 33                RLC     A
000C CE                XCH     A,R6
000D         ?C0235:
000D D8F9              DJNZ    R0,?C0234
000F 900000      R     MOV     DPTR,#UnitofPower+01H
0012 F0                MOVX    @DPTR,A
0013 EE                MOV     A,R6
0014 900000      R     MOV     DPTR,#UnitofPower
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 760
0018 CF                XCH     A,R7
0019 ED                MOV     A,R5
001A CF                XCH     A,R7
001B 7E00              MOV     R6,#00H
001D E0                MOVX    A,@DPTR
001E FC                MOV     R4,A
001F A3                INC     DPTR
0020 E0                MOVX    A,@DPTR
0021 FD                MOV     R5,A
0022 120000      E     LCALL   ?C?IMUL
0025 900000      R     MOV     DPTR,#PL2_SettingWatts
0028 EE                MOV     A,R6
0029 F0                MOVX    @DPTR,A
002A A3                INC     DPTR
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 52  

002B EF                MOV     A,R7
002C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 762
002D 900000      R     MOV     DPTR,#PL2_SettingWatts
0030 E0                MOVX    A,@DPTR
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
0033 900000      E     MOV     DPTR,#PECIWriteBuffer
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 763
0037 900000      R     MOV     DPTR,#PL2_SettingWatts
003A E0                MOVX    A,@DPTR
003B 900000      E     MOV     DPTR,#PECIWriteBuffer+01H
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 764
003F E0                MOVX    A,@DPTR
0040 4480              ORL     A,#080H
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 765
0043 E4                CLR     A
0044 A3                INC     DPTR
0045 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 766
                                           ; SOURCE LINE # 767
0046 120000      R     LCALL   L?0304
0049 741B              MOV     A,#01BH
004B 120000      R     LCALL   L?0283
004E 120000      R     LCALL   _PECI_WrPkgConfig
0051 EF                MOV     A,R7
0052 6007              JZ      ?C0107
                                           ; SOURCE LINE # 768
                                           ; SOURCE LINE # 769
0054 900000      E     MOV     DPTR,#PECI_Ctrl
0057 E0                MOVX    A,@DPTR
0058 54FE              ANL     A,#0FEH
005A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 770
                                           ; SOURCE LINE # 772
                                           ; SOURCE LINE # 774
                                           ; SOURCE LINE # 780
005B         ?C0107:
005B 22                RET     
             ; FUNCTION _PECI_WritePowerLimit2 (END)

             ; FUNCTION PECI_ReadPowerLimit2 (BEGIN)
                                           ; SOURCE LINE # 785
                                           ; SOURCE LINE # 786
                                           ; SOURCE LINE # 787
0000 120000      R     LCALL   L?0268
0003 A3                INC     DPTR
0004 741B              MOV     A,#01BH
0006 120000      R     LCALL   L?0259
0009 120000      R     LCALL   _PECI_RdPkgConfig
                                           ; SOURCE LINE # 788
                                           ; SOURCE LINE # 790
                                           ; SOURCE LINE # 792
                                           ; SOURCE LINE # 794
                                           ; SOURCE LINE # 795
000C         ?C0110:
000C 22                RET     
             ; FUNCTION PECI_ReadPowerLimit2 (END)

C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 53  

             ; FUNCTION PECI_ReadCPUTemp (BEGIN)
                                           ; SOURCE LINE # 800
                                           ; SOURCE LINE # 801
                                           ; SOURCE LINE # 805
0000 7C00        E     MOV     R4,#HIGH PECIReadBuffer
0002 7D00        E     MOV     R5,#LOW PECIReadBuffer
0004 900000      R     MOV     DPTR,#?_PECI_GetTemp?BYTE+04H
0007 7402              MOV     A,#02H
0009 F0                MOVX    @DPTR,A
000A A3                INC     DPTR
000B 14                DEC     A
000C F0                MOVX    @DPTR,A
000D E4                CLR     A
000E FB                MOV     R3,A
000F 7F30              MOV     R7,#030H
0011 120000      R     LCALL   _PECI_GetTemp
0014 EF                MOV     A,R7
0015 606E              JZ      ?C0114
                                           ; SOURCE LINE # 806
                                           ; SOURCE LINE # 807
0017 120000      R     LCALL   L?0272
001A 900000      R     MOV     DPTR,#cputemp
001D F0                MOVX    @DPTR,A
001E A3                INC     DPTR
001F EF                MOV     A,R7
0020 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 808
0021 900000      R     MOV     DPTR,#cputemp
0024 E0                MOVX    A,@DPTR
0025 FE                MOV     R6,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 900000      R     MOV     DPTR,#cputemp
002B 120000      R     LCALL   L?0287
                                           ; SOURCE LINE # 809
002E 900000      R     MOV     DPTR,#cputemp
0031 E0                MOVX    A,@DPTR
0032 FE                MOV     R6,A
0033 A3                INC     DPTR
0034 E0                MOVX    A,@DPTR
0035 7806              MOV     R0,#06H
0037         ?C0236:
0037 CE                XCH     A,R6
0038 C3                CLR     C
0039 13                RRC     A
003A CE                XCH     A,R6
003B 13                RRC     A
003C D8F9              DJNZ    R0,?C0236
;---- Variable 'tempoffset' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 810
003E 120000      R     LCALL   L?0309
0041 5042              JNC     ?C0114
                                           ; SOURCE LINE # 811
                                           ; SOURCE LINE # 812
0043 E0                MOVX    A,@DPTR
0044 C3                CLR     C
0045 9F                SUBB    A,R7
0046 900000      E     MOV     DPTR,#PECI_CPU_temp
0049 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 814
004A 900000      E     MOV     DPTR,#CPUTjmax
004D E0                MOVX    A,@DPTR
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 54  

004E FF                MOV     R7,A
004F 900000      E     MOV     DPTR,#PECI_CPU_temp
0052 E0                MOVX    A,@DPTR
0053 6F                XRL     A,R7
0054 7007              JNZ     ?C0113
                                           ; SOURCE LINE # 815
                                           ; SOURCE LINE # 816
0056 900000      E     MOV     DPTR,#BRAM_OEM+05H
0059 7466              MOV     A,#066H
005B F0                MOVX    @DPTR,A
005C 22                RET     
                                           ; SOURCE LINE # 818
005D         ?C0113:
                                           ; SOURCE LINE # 820
005D 900000      E     MOV     DPTR,#Debugtemperature1
0060 E0                MOVX    A,@DPTR
0061 7012              JNZ     ?C0115
                                           ; SOURCE LINE # 821
                                           ; SOURCE LINE # 822
0063 900000      E     MOV     DPTR,#PECI_CPU_temp
0066 E0                MOVX    A,@DPTR
0067 900000      E     MOV     DPTR,#TCPU_temp
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 823
006B 900000      E     MOV     DPTR,#PECI_CPU_temp
006E E0                MOVX    A,@DPTR
006F 900000      E     MOV     DPTR,#DebugTCPU
0072 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 824
0073 8008              SJMP    ?C0116
0075         ?C0115:
                                           ; SOURCE LINE # 826
                                           ; SOURCE LINE # 827
0075 900000      E     MOV     DPTR,#Debugtemperature1
0078 E0                MOVX    A,@DPTR
0079 900000      E     MOV     DPTR,#TCPU_temp
007C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 828
007D         ?C0116:
                                           ; SOURCE LINE # 830
007D 900000      E     MOV     DPTR,#PECI_CPU_temp
0080 E0                MOVX    A,@DPTR
0081 900000      E     MOV     DPTR,#EC_CPU_TEMP
0084 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 831
                                           ; SOURCE LINE # 833
                                           ; SOURCE LINE # 835
                                           ; SOURCE LINE # 836
                                           ; SOURCE LINE # 838
                                           ; SOURCE LINE # 840
                                           ; SOURCE LINE # 841
0085         ?C0114:
0085 22                RET     
             ; FUNCTION PECI_ReadCPUTemp (END)

             ; FUNCTION PECI_ReadCPUTJMAX (BEGIN)
                                           ; SOURCE LINE # 846
                                           ; SOURCE LINE # 847
                                           ; SOURCE LINE # 848
0000 120000      R     LCALL   L?0268
0003 A3                INC     DPTR
0004 7410              MOV     A,#010H
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 55  

0006 120000      R     LCALL   L?0259
0009 120000      R     LCALL   _PECI_RdPkgConfig
000C EF                MOV     A,R7
000D 600E              JZ      ?C0119
                                           ; SOURCE LINE # 849
                                           ; SOURCE LINE # 850
000F E4                CLR     A
0010 900000      E     MOV     DPTR,#ReadCPUTjmaxCUNT
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 851
0014 900000      E     MOV     DPTR,#PECIReadBuffer+02H
0017 E0                MOVX    A,@DPTR
0018 900000      E     MOV     DPTR,#CPUTjmax
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 852
001C 22                RET     
001D         ?C0119:
                                           ; SOURCE LINE # 854
                                           ; SOURCE LINE # 855
001D 900000      E     MOV     DPTR,#ReadCPUTjmaxCUNT
0020 E0                MOVX    A,@DPTR
0021 04                INC     A
0022 F0                MOVX    @DPTR,A
0023 C3                CLR     C
0024 940A              SUBB    A,#0AH
0026 4008              JC      ?C0122
                                           ; SOURCE LINE # 856
                                           ; SOURCE LINE # 857
0028 E4                CLR     A
0029 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 858
002A 900000      E     MOV     DPTR,#CPUTjmax
002D 7464              MOV     A,#064H
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 859
                                           ; SOURCE LINE # 860
                                           ; SOURCE LINE # 861
0030         ?C0122:
0030 22                RET     
             ; FUNCTION PECI_ReadCPUTJMAX (END)

             ; FUNCTION PECI_ReadDRAMTemperature (BEGIN)
                                           ; SOURCE LINE # 866
                                           ; SOURCE LINE # 867
                                           ; SOURCE LINE # 868
0000 120000      R     LCALL   L?0268
0003 A3                INC     DPTR
0004 7416              MOV     A,#016H
0006 120000      R     LCALL   L?0259
0009 120000      R     LCALL   _PECI_RdPkgConfig
000C EF                MOV     A,R7
000D 6010              JZ      ?C0125
                                           ; SOURCE LINE # 869
                                           ; SOURCE LINE # 870
000F 900000      E     MOV     DPTR,#PECIReadBuffer
0012 E0                MOVX    A,@DPTR
0013 900000      E     MOV     DPTR,#TDIM0_temp
0016 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 871
0017 900000      E     MOV     DPTR,#PECIReadBuffer+01H
001A E0                MOVX    A,@DPTR
001B 900000      E     MOV     DPTR,#TDIM1_temp
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 56  

001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 872
                                           ; SOURCE LINE # 874
                                           ; SOURCE LINE # 876
                                           ; SOURCE LINE # 877
001F         ?C0125:
001F 22                RET     
             ; FUNCTION PECI_ReadDRAMTemperature (END)

             ; FUNCTION PECI_ReadPkgPower (BEGIN)
                                           ; SOURCE LINE # 882
                                           ; SOURCE LINE # 883
                                           ; SOURCE LINE # 886
0000 120000      R     LCALL   L?0268
0003 A3                INC     DPTR
0004 7403              MOV     A,#03H
0006 F0                MOVX    @DPTR,A
0007 A3                INC     DPTR
0008 74FF              MOV     A,#0FFH
000A F0                MOVX    @DPTR,A
000B E4                CLR     A
000C 120000      R     LCALL   L?0260
000F 120000      R     LCALL   _PECI_RdPkgConfig
0012 EF                MOV     A,R7
0013 6064              JZ      ?C0126
                                           ; SOURCE LINE # 887
                                           ; SOURCE LINE # 889
0015 900000      E     MOV     DPTR,#PECIReadBuffer+03H
0018 E0                MOVX    A,@DPTR
0019 900000      E     MOV     DPTR,#PECIReadBuffer+02H
001C 120000      R     LCALL   L?0274
001F FE                MOV     R6,A
0020 E4                CLR     A
0021 FD                MOV     R5,A
0022 900000      R     MOV     DPTR,#pkgtemp1
0025 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 890
0028 120000      R     LCALL   L?0272
002B FE                MOV     R6,A
002C E4                CLR     A
002D FD                MOV     R5,A
002E 900000      R     MOV     DPTR,#pkgtemp2
0031 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 892
0034 900000      R     MOV     DPTR,#pkgtemp1
0037 120000      E     LCALL   ?C?LLDXDATA
003A 7810              MOV     R0,#010H
003C 120000      E     LCALL   ?C?LSHL
003F 900000      R     MOV     DPTR,#pkgtemp2
0042 120000      E     LCALL   ?C?LLDXDATA0
0045 120000      E     LCALL   ?C?LADD
0048 900000      E     MOV     DPTR,#PECI_PkgPower_Cur
004B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 896
004E 900000      E     MOV     DPTR,#PECI_PkgPower_Pre
0051 120000      R     LCALL   L?0300
0054 7003              JNZ     ?C0127
                                           ; SOURCE LINE # 897
0056 120000      R     LCALL   L?0301
0059         ?C0127:
                                           ; SOURCE LINE # 899
0059 900000      E     MOV     DPTR,#PECI_PkgPower_Pre
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 57  

005C 120000      E     LCALL   ?C?LLDXDATA0
005F 900000      E     MOV     DPTR,#PECI_PkgPower_Cur
0062 120000      E     LCALL   ?C?LLDXDATA
0065 120000      E     LCALL   ?C?LSUB
0068 900000      E     MOV     DPTR,#PECI_PkgPower
006B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 901
006E 120000      R     LCALL   L?0301
                                           ; SOURCE LINE # 903
0071 900000      R     MOV     DPTR,#result
0074 7401              MOV     A,#01H
0076 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 904
0077 8005              SJMP    ?C0128
0079         ?C0126:
                                           ; SOURCE LINE # 906
                                           ; SOURCE LINE # 907
0079 E4                CLR     A
007A 900000      R     MOV     DPTR,#result
007D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 908
007E         ?C0128:
                                           ; SOURCE LINE # 910
007E 900000      R     MOV     DPTR,#result
0081 E0                MOVX    A,@DPTR
0082 FF                MOV     R7,A
                                           ; SOURCE LINE # 911
0083         ?C0129:
0083 22                RET     
             ; FUNCTION PECI_ReadPkgPower (END)

             ; FUNCTION PECI_CalculatePkgPower (BEGIN)
                                           ; SOURCE LINE # 917
                                           ; SOURCE LINE # 918
                                           ; SOURCE LINE # 919
0000 900000      E     MOV     DPTR,#OEM_flag_1
0003 E0                MOVX    A,@DPTR
0004 20E10E            JB      ACC.1,?C0130
                                           ; SOURCE LINE # 920
                                           ; SOURCE LINE # 921
0007 120000      R     LCALL   PECI_ReadPowerUnit
000A BF0124            CJNE    R7,#01H,?C0134
                                           ; SOURCE LINE # 922
                                           ; SOURCE LINE # 923
000D 900000      E     MOV     DPTR,#OEM_flag_1
0010 E0                MOVX    A,@DPTR
0011 4402              ORL     A,#02H
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 925
                                           ; SOURCE LINE # 926
0014 22                RET     
0015         ?C0130:
                                           ; SOURCE LINE # 928
                                           ; SOURCE LINE # 929
0015 120000      R     LCALL   PECI_ReadPkgPower
0018 BF0116            CJNE    R7,#01H,?C0134
                                           ; SOURCE LINE # 930
                                           ; SOURCE LINE # 931
001B 900000      E     MOV     DPTR,#PECI_PkgPower
001E 120000      E     LCALL   ?C?LLDXDATA
0021 900000      E     MOV     DPTR,#PECI_EnergyUnit
0024 E0                MOVX    A,@DPTR
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 58  

0025 14                DEC     A
0026 F9                MOV     R1,A
0027 F8                MOV     R0,A
0028 120000      E     LCALL   ?C?ULSHR
002B 900000      E     MOV     DPTR,#PECI_PkgPower
002E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 934
                                           ; SOURCE LINE # 935
                                           ; SOURCE LINE # 936
0031         ?C0134:
0031 22                RET     
             ; FUNCTION PECI_CalculatePkgPower (END)

             ; FUNCTION PECI_ReadPkgTemperature (BEGIN)
                                           ; SOURCE LINE # 941
                                           ; SOURCE LINE # 942
                                           ; SOURCE LINE # 945
0000 120000      R     LCALL   L?0268
0003 A3                INC     DPTR
0004 7402              MOV     A,#02H
0006 F0                MOVX    @DPTR,A
0007 A3                INC     DPTR
0008 74FF              MOV     A,#0FFH
000A F0                MOVX    @DPTR,A
000B E4                CLR     A
000C 120000      R     LCALL   L?0260
000F 120000      R     LCALL   _PECI_RdPkgConfig
0012 EF                MOV     A,R7
0013 6033              JZ      ?C0138
                                           ; SOURCE LINE # 946
                                           ; SOURCE LINE # 947
0015 120000      R     LCALL   L?0273
0018 900000      R     MOV     DPTR,#pkgtemp
001B F0                MOVX    @DPTR,A
001C A3                INC     DPTR
001D EF                MOV     A,R7
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 948
001F 900000      R     MOV     DPTR,#pkgtemp
0022 E0                MOVX    A,@DPTR
0023 FE                MOV     R6,A
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 900000      R     MOV     DPTR,#pkgtemp
0029 120000      R     LCALL   L?0287
                                           ; SOURCE LINE # 949
002C 900000      R     MOV     DPTR,#pkgtemp
002F E0                MOVX    A,@DPTR
0030 FE                MOV     R6,A
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
0033 7806              MOV     R0,#06H
0035         ?C0237:
0035 CE                XCH     A,R6
0036 C3                CLR     C
0037 13                RRC     A
0038 CE                XCH     A,R6
0039 13                RRC     A
003A D8F9              DJNZ    R0,?C0237
;---- Variable 'tempoffset' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 950
003C 120000      R     LCALL   L?0309
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 59  

003F 5007              JNC     ?C0138
                                           ; SOURCE LINE # 951
                                           ; SOURCE LINE # 952
0041 E0                MOVX    A,@DPTR
0042 C3                CLR     C
0043 9F                SUBB    A,R7
0044 900000      E     MOV     DPTR,#TPkg_temp
0047 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 953
                                           ; SOURCE LINE # 954
                                           ; SOURCE LINE # 956
                                           ; SOURCE LINE # 958
                                           ; SOURCE LINE # 959
0048         ?C0138:
0048 22                RET     
             ; FUNCTION PECI_ReadPkgTemperature (END)

             ; FUNCTION PECI_ReadMSRExample (BEGIN)
                                           ; SOURCE LINE # 964
                                           ; SOURCE LINE # 965
                                           ; SOURCE LINE # 966
0000 900000      R     MOV     DPTR,#?_PECI_RdIAMSR?BYTE+04H
0003 120000      R     LCALL   L?0269
0006 A3                INC     DPTR
0007 F0                MOVX    @DPTR,A
0008 A3                INC     DPTR
0009 F0                MOVX    @DPTR,A
000A A3                INC     DPTR
000B 7404              MOV     A,#04H
000D F0                MOVX    @DPTR,A
000E A3                INC     DPTR
000F 7409              MOV     A,#09H
0011 F0                MOVX    @DPTR,A
0012 7405              MOV     A,#05H
0014 120000      R     LCALL   L?0284
0017 120000      R     LCALL   _PECI_RdIAMSR
                                           ; SOURCE LINE # 967
                                           ; SOURCE LINE # 969
                                           ; SOURCE LINE # 971
                                           ; SOURCE LINE # 973
                                           ; SOURCE LINE # 974
001A         ?C0141:
001A 22                RET     
             ; FUNCTION PECI_ReadMSRExample (END)

             ; FUNCTION PECI_CheckCurrentPlatformPower (BEGIN)
                                           ; SOURCE LINE # 979
                                           ; SOURCE LINE # 980
                                           ; SOURCE LINE # 982
0000 900000      R     MOV     DPTR,#_SysCurrent
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 04                INC     A
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 984
0008 900000      R     MOV     DPTR,#_SysCurrent
000B E0                MOVX    A,@DPTR
000C FE                MOV     R6,A
000D A3                INC     DPTR
000E E0                MOVX    A,@DPTR
000F FF                MOV     R7,A
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 60  

0010 7C00              MOV     R4,#00H
0012 7D5F              MOV     R5,#05FH
0014 120000      E     LCALL   ?C?IMUL
0017 7C03              MOV     R4,#03H
0019 7DFF              MOV     R5,#0FFH
001B 120000      E     LCALL   ?C?UIDIV
001E EF                MOV     A,R7
001F 25E0              ADD     A,ACC
0021 900000      E     MOV     DPTR,#PECI_SystemWatts
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 987
0025 22                RET     
             ; FUNCTION PECI_CheckCurrentPlatformPower (END)

             ; FUNCTION PECI_ACTurboControlAlgorithm (BEGIN)
                                           ; SOURCE LINE # 992
                                           ; SOURCE LINE # 993
                                           ; SOURCE LINE # 1004
0000 900000      E     MOV     DPTR,#PECI_Ctrl
0003 E0                MOVX    A,@DPTR
0004 20E07C            JB      ACC.0,?C0143
                                           ; SOURCE LINE # 1005
                                           ; SOURCE LINE # 1006
;---- Variable 'UpdatPL2' assigned to Register 'R7' ----
0007 E4                CLR     A
0008 FF                MOV     R7,A
                                           ; SOURCE LINE # 1007
;---- Variable 'BATTERY_CHARGE_BUDGET' assigned to Register 'R6' ----
0009 FE                MOV     R6,A
                                           ; SOURCE LINE # 1009
000A 900000      E     MOV     DPTR,#BT1_STATUS1
000D E0                MOVX    A,@DPTR
000E 30E20D            JNB     ACC.2,?C0144
                                           ; SOURCE LINE # 1010
                                           ; SOURCE LINE # 1011
0011 900000      E     MOV     DPTR,#BAT1_RSOC
0014 E0                MOVX    A,@DPTR
0015 D3                SETB    C
0016 9432              SUBB    A,#032H
0018 4002              JC      ?C0145
                                           ; SOURCE LINE # 1012
                                           ; SOURCE LINE # 1013
                                           ; SOURCE LINE # 1014
001A 8002              SJMP    ?C0144
001C         ?C0145:
                                           ; SOURCE LINE # 1016
                                           ; SOURCE LINE # 1017
001C 7E14              MOV     R6,#014H
                                           ; SOURCE LINE # 1018
                                           ; SOURCE LINE # 1019
001E         ?C0144:
                                           ; SOURCE LINE # 1021
001E 900000      E     MOV     DPTR,#PECI_AdaptorWatts
0021 E0                MOVX    A,@DPTR
0022 FD                MOV     R5,A
0023 900000      E     MOV     DPTR,#PECI_PL2Watts
0026 E0                MOVX    A,@DPTR
0027 2D                ADD     A,R5
0028 FD                MOV     R5,A
0029 900000      E     MOV     DPTR,#PECI_SystemWatts
002C E0                MOVX    A,@DPTR
002D FC                MOV     R4,A
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 61  

002E C3                CLR     C
002F ED                MOV     A,R5
0030 9C                SUBB    A,R4
0031 C3                CLR     C
0032 9E                SUBB    A,R6
0033 FE                MOV     R6,A
;---- Variable 'NewPL2Watts' assigned to Register 'R6' ----
                                           ; SOURCE LINE # 1023
0034 900000      E     MOV     DPTR,#PECI_MAXPL2
0037 E0                MOVX    A,@DPTR
0038 FD                MOV     R5,A
0039 EE                MOV     A,R6
003A D3                SETB    C
003B 9D                SUBB    A,R5
003C 4009              JC      ?C0147
                                           ; SOURCE LINE # 1024
                                           ; SOURCE LINE # 1025
                                           ; SOURCE LINE # 1026
003E 120000      R     LCALL   L?0295
0041 6020              JZ      ?C0149
                                           ; SOURCE LINE # 1027
                                           ; SOURCE LINE # 1028
0043 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 1029
                                           ; SOURCE LINE # 1031
0045 801C              SJMP    ?C0149
0047         ?C0147:
                                           ; SOURCE LINE # 1032
0047 900000      E     MOV     DPTR,#PECI_PL1TDP
004A E0                MOVX    A,@DPTR
004B FD                MOV     R5,A
004C EE                MOV     A,R6
004D C3                CLR     C
004E 9D                SUBB    A,R5
004F 5009              JNC     ?C0150
                                           ; SOURCE LINE # 1033
                                           ; SOURCE LINE # 1034
                                           ; SOURCE LINE # 1035
0051 120000      R     LCALL   L?0295
0054 600D              JZ      ?C0149
                                           ; SOURCE LINE # 1036
                                           ; SOURCE LINE # 1037
0056 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 1038
                                           ; SOURCE LINE # 1040
0058 8009              SJMP    ?C0149
005A         ?C0150:
                                           ; SOURCE LINE # 1042
                                           ; SOURCE LINE # 1043
005A 900000      E     MOV     DPTR,#PECI_PL2Watts
005D E0                MOVX    A,@DPTR
005E 6E                XRL     A,R6
005F 6002              JZ      ?C0149
                                           ; SOURCE LINE # 1044
                                           ; SOURCE LINE # 1045
0061 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 1046
                                           ; SOURCE LINE # 1047
0063         ?C0149:
                                           ; SOURCE LINE # 1049
0063 900000      E     MOV     DPTR,#guoyong001
0066 E0                MOVX    A,@DPTR
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 62  

0067 7004              JNZ     ?C0238
0069 A3                INC     DPTR
006A E0                MOVX    A,@DPTR
006B 6401              XRL     A,#01H
006D         ?C0238:
006D 700A              JNZ     ?C0154
                                           ; SOURCE LINE # 1050
                                           ; SOURCE LINE # 1051
006F 900000      E     MOV     DPTR,#PECI_PL1TDP
                                           ; SOURCE LINE # 1052
0072 120000      R     LCALL   L?0296
0075 6002              JZ      ?C0154
                                           ; SOURCE LINE # 1053
                                           ; SOURCE LINE # 1054
0077 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 1055
                                           ; SOURCE LINE # 1056
0079         ?C0154:
                                           ; SOURCE LINE # 1058
0079 EF                MOV     A,R7
007A B4010E            CJNE    A,#01H,?C0158
                                           ; SOURCE LINE # 1059
                                           ; SOURCE LINE # 1060
007D CF                XCH     A,R7
007E EE                MOV     A,R6
007F CF                XCH     A,R7
0080 020000      R     LJMP    _PECI_SETPL2Watts
                                           ; SOURCE LINE # 1061
                                           ; SOURCE LINE # 1062
0083         ?C0143:
                                           ; SOURCE LINE # 1064
                                           ; SOURCE LINE # 1065
0083 900000      E     MOV     DPTR,#PECI_PL2Watts
0086 E0                MOVX    A,@DPTR
0087 FF                MOV     R7,A
0088 120000      R     LCALL   _PECI_WritePowerLimit2
                                           ; SOURCE LINE # 1066
                                           ; SOURCE LINE # 1067
008B         ?C0158:
008B 22                RET     
             ; FUNCTION PECI_ACTurboControlAlgorithm (END)

             ; FUNCTION ChecknSetAdaptorWatts (BEGIN)
                                           ; SOURCE LINE # 1072
                                           ; SOURCE LINE # 1073
                                           ; SOURCE LINE # 1074
0000 900000      E     MOV     DPTR,#PECI_AdaptorWatts
0003 7478              MOV     A,#078H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1075
0006 900000      E     MOV     DPTR,#PECI_MAXPL2
0009 7414              MOV     A,#014H
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1076
000C 22                RET     
             ; FUNCTION ChecknSetAdaptorWatts (END)

             ; FUNCTION PECI_PowerCtrlAlgorithm (BEGIN)
                                           ; SOURCE LINE # 1081
                                           ; SOURCE LINE # 1082
                                           ; SOURCE LINE # 1083
0000 900000      E     MOV     DPTR,#PECI_PowerCtrlStep
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 63  

0003 E0                MOVX    A,@DPTR
0004 24FE              ADD     A,#0FEH
0006 6027              JZ      ?C0165
0008 14                DEC     A
0009 6030              JZ      ?C0167
000B 14                DEC     A
000C 6049              JZ      ?C0171
000E 14                DEC     A
000F 6050              JZ      ?C0173
0011 24F4              ADD     A,#0F4H
0013 605C              JZ      ?C0176
0015 2410              ADD     A,#010H
0017 7060              JNZ     ?C0178
                                           ; SOURCE LINE # 1084
                                           ; SOURCE LINE # 1085
0019         ?C0161:
                                           ; SOURCE LINE # 1086
0019 900000      E     MOV     DPTR,#SysPowState
001C E0                MOVX    A,@DPTR
001D 6410              XRL     A,#010H
001F 7058              JNZ     ?C0178
                                           ; SOURCE LINE # 1087
                                           ; SOURCE LINE # 1088
0021 900000      E     MOV     DPTR,#POWER_FLAG1
0024 E0                MOVX    A,@DPTR
0025 30E051            JNB     ACC.0,?C0178
                                           ; SOURCE LINE # 1089
                                           ; SOURCE LINE # 1090
0028 120000      R     LCALL   ChecknSetAdaptorWatts
                                           ; SOURCE LINE # 1091
002B 7F02              MOV     R7,#02H
                                           ; SOURCE LINE # 1092
002D 8047              SJMP    ?C0252
                                           ; SOURCE LINE # 1094
                                           ; SOURCE LINE # 1096
                                           ; SOURCE LINE # 1097
                                           ; SOURCE LINE # 1098
                                           ; SOURCE LINE # 1100
002F         ?C0165:
                                           ; SOURCE LINE # 1101
002F 120000      R     LCALL   PECI_ReadPowerUnit
0032 EF                MOV     A,R7
0033 6401              XRL     A,#01H
0035 7042              JNZ     ?C0178
                                           ; SOURCE LINE # 1102
                                           ; SOURCE LINE # 1103
0037 7F03              MOV     R7,#03H
0039         ?C0248:
                                           ; SOURCE LINE # 1104
                                           ; SOURCE LINE # 1105
0039 803B              SJMP    ?C0252
                                           ; SOURCE LINE # 1107
003B         ?C0167:
                                           ; SOURCE LINE # 1108
003B 120000      R     LCALL   PECI_ReadPowerLimit1
003E EF                MOV     A,R7
003F 6401              XRL     A,#01H
0041 7036              JNZ     ?C0178
                                           ; SOURCE LINE # 1109
                                           ; SOURCE LINE # 1110
0043 900000      E     MOV     DPTR,#PECI_PL1TDP
0046 E0                MOVX    A,@DPTR
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 64  

0047 6004              JZ      ?C0169
                                           ; SOURCE LINE # 1111
                                           ; SOURCE LINE # 1112
0049 7F05              MOV     R7,#05H
004B         ?C0249:
                                           ; SOURCE LINE # 1113
004B 8029              SJMP    ?C0252
004D         ?C0169:
                                           ; SOURCE LINE # 1115
                                           ; SOURCE LINE # 1116
004D 900000      E     MOV     DPTR,#PECI_PL1TDP
0050 740C              MOV     A,#0CH
0052 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1117
0053 7F04              MOV     R7,#04H
0055         ?C0250:
                                           ; SOURCE LINE # 1118
                                           ; SOURCE LINE # 1119
                                           ; SOURCE LINE # 1120
0055 801F              SJMP    ?C0252
                                           ; SOURCE LINE # 1122
0057         ?C0171:
                                           ; SOURCE LINE # 1123
0057 120000      R     LCALL   PECI_WritePowerLimit1
005A BF011C            CJNE    R7,#01H,?C0178
                                           ; SOURCE LINE # 1124
                                           ; SOURCE LINE # 1125
005D 7F05              MOV     R7,#05H
005F         ?C0251:
                                           ; SOURCE LINE # 1126
                                           ; SOURCE LINE # 1127
005F 8015              SJMP    ?C0252
                                           ; SOURCE LINE # 1129
0061         ?C0173:
                                           ; SOURCE LINE # 1130
0061 900000      E     MOV     DPTR,#PECI_Algorithm_Delay
0064 E0                MOVX    A,@DPTR
0065 04                INC     A
0066 F0                MOVX    @DPTR,A
0067 C3                CLR     C
0068 9464              SUBB    A,#064H
006A 400D              JC      ?C0178
                                           ; SOURCE LINE # 1131
                                           ; SOURCE LINE # 1132
006C E4                CLR     A
006D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1133
006E 020000      R     LJMP    PECI_ACTurboControlAlgorithm
                                           ; SOURCE LINE # 1134
                                           ; SOURCE LINE # 1135
                                           ; SOURCE LINE # 1137
                                           ; SOURCE LINE # 1138
                                           ; SOURCE LINE # 1140
0071         ?C0176:
                                           ; SOURCE LINE # 1141
0071 120000      R     LCALL   PECI_ClearTCVariables
                                           ; SOURCE LINE # 1142
0074 7F10              MOV     R7,#010H
0076         ?C0252:
0076 120000      R     LCALL   _SetPECIPowerCtrlStep
                                           ; SOURCE LINE # 1143
                                           ; SOURCE LINE # 1145
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 65  

                                           ; SOURCE LINE # 1146
                                           ; SOURCE LINE # 1147
                                           ; SOURCE LINE # 1148
0079         ?C0178:
0079 22                RET     
             ; FUNCTION PECI_PowerCtrlAlgorithm (END)

             ; FUNCTION PECI_PowerCtrlCenter (BEGIN)
                                           ; SOURCE LINE # 1153
                                           ; SOURCE LINE # 1154
                                           ; SOURCE LINE # 1155
0000 900000      E     MOV     DPTR,#SysPowState
0003 E0                MOVX    A,@DPTR
0004 6410              XRL     A,#010H
0006 7023              JNZ     ?C0184
                                           ; SOURCE LINE # 1156
                                           ; SOURCE LINE # 1157
0008 900000      E     MOV     DPTR,#PSTB_CmdStatus
000B E0                MOVX    A,@DPTR
000C 30E01C            JNB     ACC.0,?C0184
                                           ; SOURCE LINE # 1158
                                           ; SOURCE LINE # 1159
000F 900000      E     MOV     DPTR,#PSTB_Timer
0012 E0                MOVX    A,@DPTR
0013 04                INC     A
0014 F0                MOVX    @DPTR,A
0015 C3                CLR     C
0016 9402              SUBB    A,#02H
0018 4011              JC      ?C0184
                                           ; SOURCE LINE # 1160
                                           ; SOURCE LINE # 1161
001A E4                CLR     A
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1162
001C 900000      E     MOV     DPTR,#PSTB_RepeatIntervalCount
001F E0                MOVX    A,@DPTR
0020 7003              JNZ     ?C0182
                                           ; SOURCE LINE # 1163
                                           ; SOURCE LINE # 1164
0022 020000      R     LJMP    ProcessPSTCmd
                                           ; SOURCE LINE # 1165
0025         ?C0182:
                                           ; SOURCE LINE # 1167
                                           ; SOURCE LINE # 1168
0025 900000      E     MOV     DPTR,#PSTB_RepeatIntervalCount
0028 E0                MOVX    A,@DPTR
0029 14                DEC     A
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1169
                                           ; SOURCE LINE # 1170
                                           ; SOURCE LINE # 1172
                                           ; SOURCE LINE # 1173
                                           ; SOURCE LINE # 1187
002B         ?C0184:
002B 22                RET     
             ; FUNCTION PECI_PowerCtrlCenter (END)

             ; FUNCTION _SetPECIPowerCtrlStep (BEGIN)
                                           ; SOURCE LINE # 1192
;---- Variable 'step' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1193
                                           ; SOURCE LINE # 1194
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 66  

0000 900000      E     MOV     DPTR,#PECI_PowerCtrlStep
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1195
0005 22                RET     
             ; FUNCTION _SetPECIPowerCtrlStep (END)

             ; FUNCTION ProcessPSTCmd (BEGIN)
                                           ; SOURCE LINE # 1203
                                           ; SOURCE LINE # 1204
                                           ; SOURCE LINE # 1209
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#error
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1210
0005 900000      R     MOV     DPTR,#bufindex
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1212
0009 900000      R     MOV     DPTR,#bufpoint
000C 7400        E     MOV     A,#HIGH PSTB_RepeatCycle
000E F0                MOVX    @DPTR,A
000F A3                INC     DPTR
0010 7400        E     MOV     A,#LOW PSTB_RepeatCycle
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1214
0013 900000      E     MOV     DPTR,#PSTB_RepeatCycle
0016 120000      R     LCALL   L?0300
0019 7003              JNZ     $ + 5H
001B 020000      R     LJMP    ?C0186
                                           ; SOURCE LINE # 1215
                                           ; SOURCE LINE # 1216
001E 900000      E     MOV     DPTR,#PECI_StressToolBuf+07H
0021 E0                MOVX    A,@DPTR
;---- Variable 'writelen' assigned to Register 'R6' ----
0022 FE                MOV     R6,A
                                           ; SOURCE LINE # 1217
0023 A3                INC     DPTR
0024 E0                MOVX    A,@DPTR
;---- Variable 'readlen' assigned to Register 'R2' ----
0025 FA                MOV     R2,A
                                           ; SOURCE LINE # 1219
0026 120000      R     LCALL   PECI_HostEnable
                                           ; SOURCE LINE # 1220
0029 900000      E     MOV     DPTR,#PECI_StressToolBuf+06H
002C E0                MOVX    A,@DPTR
002D 900000      E     MOV     DPTR,#HOTRADDR
0030 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1221
0031 900000      E     MOV     DPTR,#PECI_StressToolBuf+07H
0034 E0                MOVX    A,@DPTR
0035 900000      E     MOV     DPTR,#HOWRLR
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1222
0039 900000      E     MOV     DPTR,#PECI_StressToolBuf+08H
003C E0                MOVX    A,@DPTR
003D 900000      E     MOV     DPTR,#HORDLR
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1224
0041 EE                MOV     A,R6
0042 600A              JZ      ?C0187
                                           ; SOURCE LINE # 1225
                                           ; SOURCE LINE # 1226
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 67  

0044 900000      E     MOV     DPTR,#PECI_StressToolBuf+09H
0047 E0                MOVX    A,@DPTR
0048 900000      E     MOV     DPTR,#HOCMDR
                                           ; SOURCE LINE # 1227
                                           ; SOURCE LINE # 1228
004B 120000      R     LCALL   L?0285
                                           ; SOURCE LINE # 1229
004E         ?C0187:
                                           ; SOURCE LINE # 1230
004E 900000      E     MOV     DPTR,#PECI_StressToolBuf+09H
0051 E0                MOVX    A,@DPTR
0052 B4A506            CJNE    A,#0A5H,?C0189
                                           ; SOURCE LINE # 1231
                                           ; SOURCE LINE # 1232
0055 7F02              MOV     R7,#02H
0057 120000      R     LCALL   _PECI_HostControl
                                           ; SOURCE LINE # 1233
005A 1E                DEC     R6
                                           ; SOURCE LINE # 1234
005B         ?C0189:
                                           ; SOURCE LINE # 1236
005B EE                MOV     A,R6
005C 600C              JZ      ?C0190
                                           ; SOURCE LINE # 1237
                                           ; SOURCE LINE # 1238
005E 120000      R     LCALL   L?0281
0061 E0                MOVX    A,@DPTR
0062 900000      E     MOV     DPTR,#HOWRDR
                                           ; SOURCE LINE # 1239
                                           ; SOURCE LINE # 1240
0065 120000      R     LCALL   L?0285
                                           ; SOURCE LINE # 1241
0068 80F1              SJMP    ?C0189
006A         ?C0190:
                                           ; SOURCE LINE # 1243
006A 120000      R     LCALL   PECI_CheckHostBusy
006D EF                MOV     A,R7
006E 602B              JZ      ?C0191
                                           ; SOURCE LINE # 1244
                                           ; SOURCE LINE # 1245
                                           ; SOURCE LINE # 1246
0070 120000      R     LCALL   L?0271
0073 6026              JZ      ?C0254
                                           ; SOURCE LINE # 1247
                                           ; SOURCE LINE # 1248
0075 900000      E     MOV     DPTR,#PECI_StressToolBuf+09H
0078 E0                MOVX    A,@DPTR
0079 B4A503            CJNE    A,#0A5H,?C0193
                                           ; SOURCE LINE # 1249
                                           ; SOURCE LINE # 1250
007C 120000      R     LCALL   L?0286
                                           ; SOURCE LINE # 1251
007F         ?C0193:
                                           ; SOURCE LINE # 1252
007F 800E              SJMP    ?C0253
0081         ?C0194:
                                           ; SOURCE LINE # 1254
0081 EA                MOV     A,R2
0082 6010              JZ      ?C0195
                                           ; SOURCE LINE # 1255
                                           ; SOURCE LINE # 1256
0084 900000      E     MOV     DPTR,#HORDDR
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 68  

0087 E0                MOVX    A,@DPTR
0088 FF                MOV     R7,A
0089 120000      R     LCALL   L?0281
008C EF                MOV     A,R7
008D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1257
008E 1A                DEC     R2
                                           ; SOURCE LINE # 1258
008F         ?C0253:
008F 120000      R     LCALL   L?0286
                                           ; SOURCE LINE # 1259
0092 80ED              SJMP    ?C0194
0094         ?C0195:
                                           ; SOURCE LINE # 1260
0094 E4                CLR     A
0095 900000      R     MOV     DPTR,#error
0098 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1261
0099 8006              SJMP    ?C0197
009B         ?C0191:
                                           ; SOURCE LINE # 1268
                                           ; SOURCE LINE # 1269
009B         ?C0254:
009B 900000      R     MOV     DPTR,#error
009E 7401              MOV     A,#01H
00A0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1270
00A1         ?C0197:
                                           ; SOURCE LINE # 1272
00A1 900000      E     MOV     DPTR,#PSTB_RepeatCycle
00A4 120000      E     LCALL   ?C?LLDXDATA
00A7 EF                MOV     A,R7
00A8 24FF              ADD     A,#0FFH
00AA FF                MOV     R7,A
00AB EE                MOV     A,R6
00AC 34FF              ADDC    A,#0FFH
00AE FE                MOV     R6,A
00AF ED                MOV     A,R5
00B0 34FF              ADDC    A,#0FFH
00B2 FD                MOV     R5,A
00B3 EC                MOV     A,R4
00B4 34FF              ADDC    A,#0FFH
00B6 FC                MOV     R4,A
00B7 900000      E     MOV     DPTR,#PSTB_RepeatCycle
00BA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1273
00BD 120000      R     LCALL   L?0263
00C0 900000      E     MOV     DPTR,#PECI_StressToolBuf+03H
                                           ; SOURCE LINE # 1274
                                           ; SOURCE LINE # 1275
00C3 120000      R     LCALL   L?0261
00C6 900000      E     MOV     DPTR,#PECI_StressToolBuf+02H
                                           ; SOURCE LINE # 1276
                                           ; SOURCE LINE # 1277
00C9 120000      R     LCALL   L?0261
00CC 900000      E     MOV     DPTR,#PECI_StressToolBuf+01H
                                           ; SOURCE LINE # 1278
                                           ; SOURCE LINE # 1279
00CF 120000      R     LCALL   L?0262
00D2 900000      E     MOV     DPTR,#PECI_StressToolBuf
00D5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1281
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 69  

00D6 900000      E     MOV     DPTR,#PECI_StressToolBuf+04H
00D9 E0                MOVX    A,@DPTR
00DA 900000      E     MOV     DPTR,#PSTB_RepeatIntervalCount
00DD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1282
00DE 120000      R     LCALL   PECI_HostDisable
                                           ; SOURCE LINE # 1283
00E1 120000      R     LCALL   ResetPECIStatus
                                           ; SOURCE LINE # 1285
00E4 900000      R     MOV     DPTR,#error
00E7 E0                MOVX    A,@DPTR
00E8 6401              XRL     A,#01H
00EA 7042              JNZ     ?C0204
                                           ; SOURCE LINE # 1286
                                           ; SOURCE LINE # 1287
00EC 900000      E     MOV     DPTR,#PECI_StressToolBuf+09H
00EF E0                MOVX    A,@DPTR
00F0 B4A503            CJNE    A,#0A5H,?C0199
                                           ; SOURCE LINE # 1288
                                           ; SOURCE LINE # 1289
00F3 120000      R     LCALL   L?0286
                                           ; SOURCE LINE # 1290
00F6         ?C0199:
                                           ; SOURCE LINE # 1291
00F6 8009              SJMP    ?C0255
00F8         ?C0200:
                                           ; SOURCE LINE # 1293
00F8 EA                MOV     A,R2
00F9 600B              JZ      ?C0201
                                           ; SOURCE LINE # 1294
                                           ; SOURCE LINE # 1295
00FB 120000      R     LCALL   L?0282
00FE E4                CLR     A
00FF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1296
0100 1A                DEC     R2
                                           ; SOURCE LINE # 1297
0101         ?C0255:
0101 120000      R     LCALL   L?0286
                                           ; SOURCE LINE # 1298
0104 80F2              SJMP    ?C0200
0106         ?C0201:
                                           ; SOURCE LINE # 1300
0106 900000      E     MOV     DPTR,#PECI_ErrorCount
0109 120000      E     LCALL   ?C?LLDXDATA
010C EF                MOV     A,R7
010D 2401              ADD     A,#01H
010F FF                MOV     R7,A
0110 E4                CLR     A
0111 3E                ADDC    A,R6
0112 FE                MOV     R6,A
0113 E4                CLR     A
0114 3D                ADDC    A,R5
0115 FD                MOV     R5,A
0116 E4                CLR     A
0117 3C                ADDC    A,R4
0118 FC                MOV     R4,A
0119 900000      E     MOV     DPTR,#PECI_ErrorCount
011C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1301
011F 900000      E     MOV     DPTR,#PECI_StressToolBuf+05H
0122 E0                MOVX    A,@DPTR
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 70  

0123 6009              JZ      ?C0204
                                           ; SOURCE LINE # 1302
                                           ; SOURCE LINE # 1303
                                           ; SOURCE LINE # 1304
                                           ; SOURCE LINE # 1305
                                           ; SOURCE LINE # 1306
0125 8000              SJMP    ?C0256
0127         ?C0186:
                                           ; SOURCE LINE # 1308
                                           ; SOURCE LINE # 1309
0127         ?C0256:
0127 900000      E     MOV     DPTR,#PSTB_CmdStatus
012A E0                MOVX    A,@DPTR
012B 54FE              ANL     A,#0FEH
012D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1310
                                           ; SOURCE LINE # 1311
012E         ?C0204:
012E 22                RET     
             ; FUNCTION ProcessPSTCmd (END)

             ; FUNCTION PECI_PSTIssueCmd (BEGIN)
                                           ; SOURCE LINE # 1316
                                           ; SOURCE LINE # 1317
                                           ; SOURCE LINE # 1320
0000 900000      E     MOV     DPTR,#PECI_ErrorCount
0003 120000      E     LCALL   ?C?LSTKXDATA
0006 00                DB      00H
0007 00                DB      00H
0008 00                DB      00H
0009 00                DB      00H
                                           ; SOURCE LINE # 1321
000A E4                CLR     A
000B 900000      E     MOV     DPTR,#PSTB_Timer
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1322
000F 900000      E     MOV     DPTR,#PSTB_RepeatIntervalCount
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1323
0013 900000      E     MOV     DPTR,#PSTB_CmdStatus
0016 E0                MOVX    A,@DPTR
0017 4401              ORL     A,#01H
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1324
001A 7E00        E     MOV     R6,#HIGH PSTB_RepeatCycle
001C 7F00        E     MOV     R7,#LOW PSTB_RepeatCycle
;---- Variable 'xptr' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 1325
001E 900000      E     MOV     DPTR,#PECI_StressToolBuf+03H
0021 120000      R     LCALL   L?0302
                                           ; SOURCE LINE # 1326
0024 0F                INC     R7
0025 BF0001            CJNE    R7,#00H,?C0239
0028 0E                INC     R6
0029         ?C0239:
                                           ; SOURCE LINE # 1327
0029 900000      E     MOV     DPTR,#PECI_StressToolBuf+02H
002C 120000      R     LCALL   L?0302
                                           ; SOURCE LINE # 1328
002F 0F                INC     R7
0030 BF0001            CJNE    R7,#00H,?C0240
0033 0E                INC     R6
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 71  

0034         ?C0240:
                                           ; SOURCE LINE # 1329
0034 900000      E     MOV     DPTR,#PECI_StressToolBuf+01H
0037 120000      R     LCALL   L?0303
                                           ; SOURCE LINE # 1330
003A 0F                INC     R7
003B BF0001            CJNE    R7,#00H,?C0241
003E 0E                INC     R6
003F         ?C0241:
                                           ; SOURCE LINE # 1331
003F 900000      E     MOV     DPTR,#PECI_StressToolBuf
0042 120000      R     LCALL   L?0303
                                           ; SOURCE LINE # 1332
0045 22                RET     
             ; FUNCTION PECI_PSTIssueCmd (END)

             ; FUNCTION PECI_PSTEndCmd (BEGIN)
                                           ; SOURCE LINE # 1337
                                           ; SOURCE LINE # 1338
                                           ; SOURCE LINE # 1339
0000 020000      R     LJMP    PECI_ClearPSTVariables
             ; FUNCTION PECI_PSTEndCmd (END)

             ; FUNCTION PECI_PSTWriteBuffer (BEGIN)
                                           ; SOURCE LINE # 1345
                                           ; SOURCE LINE # 1346
                                           ; SOURCE LINE # 1347
0000 AF00        E     MOV     R7,PM3DataCount
0002 120000      R     LCALL   L?0288
0005 E500        E     MOV     A,PM3Data
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1348
0008 22                RET     
             ; FUNCTION PECI_PSTWriteBuffer (END)

             ; FUNCTION PECI_PSTReadBuffer (BEGIN)
                                           ; SOURCE LINE # 1353
                                           ; SOURCE LINE # 1354
                                           ; SOURCE LINE # 1355
0000 900000      E     MOV     DPTR,#StressToolReadBufIndex
0003 7418              MOV     A,#018H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1402
0006 22                RET     
             ; FUNCTION PECI_PSTReadBuffer (END)

             ; FUNCTION PECI_PSTReadErrorCount (BEGIN)
                                           ; SOURCE LINE # 1407
                                           ; SOURCE LINE # 1408
                                           ; SOURCE LINE # 1413
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#timeout
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1415
0005 7E00        E     MOV     R6,#HIGH PECI_ErrorCount
0007 7F00        E     MOV     R7,#LOW PECI_ErrorCount
;---- Variable 'xptr' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 1416
0009 8F82              MOV     DPL,R7
000B 8E83              MOV     DPH,R6
000D E0                MOVX    A,@DPTR
000E 900000      R     MOV     DPTR,#buffer+03H
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 72  

0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1417
0012 0F                INC     R7
0013 BF0001            CJNE    R7,#00H,?C0242
0016 0E                INC     R6
0017         ?C0242:
                                           ; SOURCE LINE # 1418
0017 8F82              MOV     DPL,R7
0019 8E83              MOV     DPH,R6
001B E0                MOVX    A,@DPTR
001C 900000      R     MOV     DPTR,#buffer+02H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1419
0020 0F                INC     R7
0021 BF0001            CJNE    R7,#00H,?C0243
0024 0E                INC     R6
0025         ?C0243:
                                           ; SOURCE LINE # 1420
0025 8F82              MOV     DPL,R7
0027 8E83              MOV     DPH,R6
0029 E0                MOVX    A,@DPTR
002A 900000      R     MOV     DPTR,#buffer+01H
002D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1421
002E 0F                INC     R7
002F BF0001            CJNE    R7,#00H,?C0244
0032 0E                INC     R6
0033         ?C0244:
                                           ; SOURCE LINE # 1422
0033 8F82              MOV     DPL,R7
0035 8E83              MOV     DPH,R6
0037 E0                MOVX    A,@DPTR
0038 900000      R     MOV     DPTR,#buffer
003B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1425
003C E4                CLR     A
003D 900000      R     MOV     DPTR,#index
0040 F0                MOVX    @DPTR,A
0041         ?C0209:
                                           ; SOURCE LINE # 1426
                                           ; SOURCE LINE # 1427
0041 C28E              CLR     TR1
                                           ; SOURCE LINE # 1428
0043 C2AB              CLR     ET1
                                           ; SOURCE LINE # 1429
0045 00                NOP     
                                           ; SOURCE LINE # 1430
0046 00                NOP     
                                           ; SOURCE LINE # 1431
0047 00                NOP     
                                           ; SOURCE LINE # 1432
0048 00                NOP     
                                           ; SOURCE LINE # 1433
                                           ; SOURCE LINE # 1434
                                           ; SOURCE LINE # 1435
                                           ; SOURCE LINE # 1436
0049 120000      R     LCALL   L?0289
004C         ?C0212:
                                           ; SOURCE LINE # 1438
004C 900000      E     MOV     DPTR,#PM3STS
004F E0                MOVX    A,@DPTR
0050 30E012            JNB     ACC.0,?C0213
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 73  

                                           ; SOURCE LINE # 1439
                                           ; SOURCE LINE # 1440
0053 308F08            JNB     TF1,?C0214
                                           ; SOURCE LINE # 1441
                                           ; SOURCE LINE # 1442
0056 900000      R     MOV     DPTR,#timeout
0059 7401              MOV     A,#01H
005B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1443
005C 8007              SJMP    ?C0213
                                           ; SOURCE LINE # 1444
005E         ?C0214:
                                           ; SOURCE LINE # 1446
                                           ; SOURCE LINE # 1447
005E E4                CLR     A
005F 900000      R     MOV     DPTR,#timeout
0062 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1448
                                           ; SOURCE LINE # 1449
0063 80E7              SJMP    ?C0212
0065         ?C0213:
                                           ; SOURCE LINE # 1451
0065 900000      R     MOV     DPTR,#timeout
0068 E0                MOVX    A,@DPTR
0069 6401              XRL     A,#01H
006B 601E              JZ      ?C0210
                                           ; SOURCE LINE # 1452
                                           ; SOURCE LINE # 1453
                                           ; SOURCE LINE # 1454
006D         ?C0216:
                                           ; SOURCE LINE # 1456
                                           ; SOURCE LINE # 1457
006D 900000      R     MOV     DPTR,#index
0070 E0                MOVX    A,@DPTR
0071 2400        R     ADD     A,#LOW buffer
0073 F582              MOV     DPL,A
0075 E4                CLR     A
0076 3400        R     ADDC    A,#HIGH buffer
0078 F583              MOV     DPH,A
007A E0                MOVX    A,@DPTR
007B FF                MOV     R7,A
007C 120000      E     LCALL   _PMC3Output
                                           ; SOURCE LINE # 1458
                                           ; SOURCE LINE # 1459
007F         ?C0211:
007F 900000      R     MOV     DPTR,#index
0082 E0                MOVX    A,@DPTR
0083 04                INC     A
0084 F0                MOVX    @DPTR,A
0085 E0                MOVX    A,@DPTR
0086 C3                CLR     C
0087 9404              SUBB    A,#04H
0089 40B6              JC      ?C0209
008B         ?C0210:
                                           ; SOURCE LINE # 1461
                                           ; SOURCE LINE # 1462
                                           ; SOURCE LINE # 1463
008B 120000      R     LCALL   L?0292
                                           ; SOURCE LINE # 1464
008E 22                RET     
             ; FUNCTION PECI_PSTReadErrorCount (END)

C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 74  

             ; FUNCTION PECI_PSTReadStatus (BEGIN)
                                           ; SOURCE LINE # 1469
                                           ; SOURCE LINE # 1470
                                           ; SOURCE LINE # 1471
0000 C28E              CLR     TR1
                                           ; SOURCE LINE # 1472
0002 C2AB              CLR     ET1
                                           ; SOURCE LINE # 1473
0004 00                NOP     
                                           ; SOURCE LINE # 1474
0005 00                NOP     
                                           ; SOURCE LINE # 1475
0006 00                NOP     
                                           ; SOURCE LINE # 1476
0007 00                NOP     
                                           ; SOURCE LINE # 1477
                                           ; SOURCE LINE # 1478
                                           ; SOURCE LINE # 1479
                                           ; SOURCE LINE # 1480
0008 120000      R     LCALL   L?0290
000B         ?C0219:
                                           ; SOURCE LINE # 1482
000B 900000      E     MOV     DPTR,#PM3STS
000E E0                MOVX    A,@DPTR
000F 30E003            JNB     ACC.0,?C0220
                                           ; SOURCE LINE # 1483
                                           ; SOURCE LINE # 1484
0012 308FF6            JNB     TF1,?C0219
                                           ; SOURCE LINE # 1485
                                           ; SOURCE LINE # 1486
                                           ; SOURCE LINE # 1487
                                           ; SOURCE LINE # 1488
0015         ?C0220:
                                           ; SOURCE LINE # 1490
0015 208F08            JB      TF1,?C0222
                                           ; SOURCE LINE # 1491
                                           ; SOURCE LINE # 1492
0018 900000      E     MOV     DPTR,#PSTB_CmdStatus
001B E0                MOVX    A,@DPTR
001C FF                MOV     R7,A
001D 120000      E     LCALL   _PMC3Output
                                           ; SOURCE LINE # 1493
0020         ?C0222:
                                           ; SOURCE LINE # 1495
                                           ; SOURCE LINE # 1496
                                           ; SOURCE LINE # 1497
0020 120000      R     LCALL   L?0292
                                           ; SOURCE LINE # 1498
0023 22                RET     
             ; FUNCTION PECI_PSTReadStatus (END)

             ; FUNCTION PECI_ClearPSTVariables (BEGIN)
                                           ; SOURCE LINE # 1503
                                           ; SOURCE LINE # 1504
                                           ; SOURCE LINE # 1505
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#PSTB_Timer
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1506
0005 900000      E     MOV     DPTR,#PSTB_CmdStatus
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1507
C51 COMPILER V7.50   OEM_PECI                                                              09/08/2020 15:56:25 PAGE 75  

0009 900000      E     MOV     DPTR,#PSTB_RepeatIntervalCount
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1508
000D 900000      E     MOV     DPTR,#PSTB_RepeatCycle
0010 120000      E     LCALL   ?C?LSTKXDATA
0013 00                DB      00H
0014 00                DB      00H
0015 00                DB      00H
0016 00                DB      00H
                                           ; SOURCE LINE # 1509
0017 E4                CLR     A
0018 900000      E     MOV     DPTR,#StressToolReadBufIndex
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1510
001C 22                RET     
             ; FUNCTION PECI_ClearPSTVariables (END)

             ; FUNCTION PECI_SendBufferData (BEGIN)
                                           ; SOURCE LINE # 1515
                                           ; SOURCE LINE # 1516
                                           ; SOURCE LINE # 1517
0000 900000      E     MOV     DPTR,#StressToolReadBufIndex
0003 E0                MOVX    A,@DPTR
0004 601A              JZ      ?C0227
                                           ; SOURCE LINE # 1518
                                           ; SOURCE LINE # 1519
0006 900000      E     MOV     DPTR,#PM3STS
0009 E0                MOVX    A,@DPTR
000A 20E013            JB      ACC.0,?C0227
                                           ; SOURCE LINE # 1520
                                           ; SOURCE LINE # 1521
000D 900000      E     MOV     DPTR,#StressToolReadBufIndex
0010 E0                MOVX    A,@DPTR
0011 FF                MOV     R7,A
0012 120000      R     LCALL   L?0288
0015 E0                MOVX    A,@DPTR
0016 FF                MOV     R7,A
0017 120000      E     LCALL   _PMC3Output
                                           ; SOURCE LINE # 1522
001A 900000      E     MOV     DPTR,#StressToolReadBufIndex
001D E0                MOVX    A,@DPTR
001E 14                DEC     A
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1523
                                           ; SOURCE LINE # 1524
                                           ; SOURCE LINE # 1525
0020         ?C0227:
0020 22                RET     
             ; FUNCTION PECI_SendBufferData (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3149    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      79
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
