C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE OEM_FAN
OBJECT MODULE PLACED IN Code\OEM\OEM_FAN.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\c51.exe Code\OEM\OEM_FAN.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR(.\Code\CORE\INC
                    -LUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\)

line level    source

   1          /*-----------------------------------------------------------------------------
   2           * TITLE: OEM_FAN.C
   3           *
   4           * Author : Dino
   5           *
   6           * Note : These functions are reference only.
   7           *        Please follow your project software specification to do some modification.
   8           *---------------------------------------------------------------------------*/
   9          
  10          #include <CORE_INCLUDE.H>
  11          #include <OEM_INCLUDE.H>
  12          
  13          //-----------------------------------------------------------------------------
  14          // Smart Fan control
  15          //-----------------------------------------------------------------------------
  16          // Fan table 1   2009/08/18 Rev.01
  17          //
  18          // T > on    level +1  ;   T < off ,Level -1
  19          //
  20          // Add function for linear calculation. Aping 2014/03/03, Label:Linear
  21          //-----------------------------------------------------------------------------
  22          
  23          //:Linear
  24          const thermal code ThermalTalbe1[]=
  25          {
  26           //Level CFanOn,CFanOff, CRPM,  IsLinear FanOn,                 FanOff,                 RPM,
  27                  //TF_018-->>
  28                  /*
  29                  {0,  40,        0,              0,              0,              &Fan1On_Step1,  &Fan1Off_Step1, &Fan1RPM_Step1  },      // Level 0      
  30                  {1,  45,        35,     34,     0,              &Fan1On_Step2,  &Fan1Off_Step2, &Fan1RPM_Step2  },      // Level 1      
  31                  {2,  55,        45,     34,     1,              &Fan1On_Step3,  &Fan1Off_Step3, &Fan1RPM_Step3  },      // Level 2
  32                  {3,  65,        55,     36,     0,              &Fan1On_Step4,  &Fan1Off_Step4, &Fan1RPM_Step4  },      // Level 3
  33                  {4,  80,        65,     36,     1,              &Fan1On_Step5,  &Fan1Off_Step5, &Fan1RPM_Step5  },      // Level 4
  34                  {5,  100,       80,     46,     0,              &Fan1On_Step6,  &Fan1Off_Step6, &Fan1RPM_Step6  },      // Level 5
  35                  */
  36                  //TF_018--<<
  37                  //TF_018++>>
  38                  {0,  40,        0,              0,              0,              &Fan1On_Step1,  &Fan1Off_Step1, &Fan1RPM_Step1  },      // Level 0      
  39                  {1,  45,        40,     30,     1,              &Fan1On_Step2,  &Fan1Off_Step2, &Fan1RPM_Step2  },      // Level 1      
  40                  {2,  55,        45,     34,     1,              &Fan1On_Step3,  &Fan1Off_Step3, &Fan1RPM_Step3  },      // Level 2
  41                  {3,  65,        55,     40,     1,              &Fan1On_Step4,  &Fan1Off_Step4, &Fan1RPM_Step4  },      // Level 3
  42                  {4,  80,        65,     49,     1,              &Fan1On_Step5,  &Fan1Off_Step5, &Fan1RPM_Step5  },      // Level 4
  43                  {5,  100,       80,     55,     0,              &Fan1On_Step6,  &Fan1Off_Step6, &Fan1RPM_Step6  },      // Level 5      
  44                  //TF_018++<<
  45          };
  46          
  47          //-----------------------------------------------------------------------------
  48          // Fan table 2
  49          //-----------------------------------------------------------------------------
  50          const thermal code ThermalTalbe2[]=
  51          {
  52          //Level CFanOn,CFanOff, CRPM,   IsLinear FanOn,                 FanOff,                 RPM,
  53                  //TF_018-->>
  54                  /*
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 2   

  55                  {0,      38,    0,              0,              0,              &Fan2On_Step1,  &Fan2Off_Step1, &Fan2RPM_Step1  },      // Level 0      
  56                  {1,      50,   36,              30,             0,              &Fan2On_Step2,  &Fan2Off_Step2, &Fan2RPM_Step2  },      // Level 1      
  57                  {2,      55,   48,              34,             0,              &Fan2On_Step3,  &Fan2Off_Step3, &Fan2RPM_Step3  },      // Level 2      
  58                  {3,      60,   53,              37,             0,              &Fan2On_Step4,  &Fan2Off_Step4, &Fan2RPM_Step4  },      // Level 3      
  59                  {4,      65,   58,              40,             0,              &Fan2On_Step5,  &Fan2Off_Step5, &Fan2RPM_Step5  },      // Level 4      
  60                  {5,      70,   63,              43,             0,              &Fan2On_Step6,  &Fan2Off_Step6, &Fan2RPM_Step6  },      // Level 5      
  61                  {6,      75,   68,              46,             0,              &Fan2On_Step7,  &Fan2Off_Step7, &Fan2RPM_Step7  },      // Level 6      
  62                  {7, 127,   73,          56,             0,              &Fan2On_Step8,  &Fan2Off_Step8, &Fan2RPM_Step8  },      // Level 7 
  63                  */
  64                  //TF_018--<<
  65                  //TF_018++>>
  66                  {0,  40,        0,              0,              0,              &Fan2On_Step1,  &Fan2Off_Step1, &Fan2RPM_Step1  },      // Level 0      
  67                  {1,  45,        40,     26,     1,              &Fan2On_Step2,  &Fan2Off_Step2, &Fan2RPM_Step2  },      // Level 1      
  68                  {2,  55,        45,     30,     1,              &Fan2On_Step3,  &Fan2Off_Step3, &Fan2RPM_Step3  },      // Level 2
  69                  {3,  65,        55,     36,     1,              &Fan2On_Step4,  &Fan2Off_Step4, &Fan2RPM_Step4  },      // Level 3
  70                  {4,  80,        65,     45,     1,              &Fan2On_Step5,  &Fan2Off_Step5, &Fan2RPM_Step5  },      // Level 4
  71                  {5,  100,       80,     51,     0,              &Fan2On_Step6,  &Fan2Off_Step6, &Fan2RPM_Step6  },      // Level 5
  72                  //TF_018++<<            
  73          };
  74          
  75          //-----------------------------------------------------------------------------
  76          // The function of check fan rpm 1     1sec-A  time base     
  77          //----------------------------------------------------------------------------- 
  78          void CheckFanRPM1(void)
  79          {
  80   1              BYTE FanLevel_t = FanLevel;     
  81   1              BYTE Fan1RPM_t = Fan1RPM;
  82   1      
  83   1              temperature1 = CpuTm;
  84   1              //TF_018-->>
  85   1              /*
  86   1              if(Debugtemperature1!=0x00)
  87   1              {
  88   1                      temperature1 = Debugtemperature1;
  89   1              }
  90   1              */
  91   1              //TF_018--<<    
  92   1              if(FanLevel_t <((sizeof(ThermalTalbe1)/sizeof(thermal))-1))
  93   1              {
  94   2                      if(temperature1> *ThermalTalbe1[FanLevel_t].FanOn)
  95   2                      {
  96   3                              FanLevel_t += 1;
  97   3                      }
  98   2              }
  99   1              
 100   1              if (FanLevel_t>0)
 101   1              {
 102   2                      if (temperature1< *ThermalTalbe1[FanLevel_t].FanOff)
 103   2                      {                       
 104   3                              FanLevel_t-=1;
 105   3                      }
 106   2              }
 107   1                      
 108   1              FanLevel = FanLevel_t;  
 109   1              //TF_018--      Fan1RPM = *ThermalTalbe1[FanLevel_t].RPM;
 110   1      
 111   1              if(FanLevel_t < sizeof(ThermalTalbe1)/sizeof(thermal)-1)        // :Linear level check
 112   1              {
 113   2                      if (ThermalTalbe1[FanLevel_t].IsLinear) // :Linear calc
 114   2                      {
 115   3                              BYTE RpmDiff = ThermalTalbe1[FanLevel_t+1].CRPM - ThermalTalbe1[FanLevel_t].CRPM;
 116   3                              BYTE TmDiff = temperature1 - ThermalTalbe1[FanLevel_t].CFanOff;
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 3   

 117   3                              BYTE CFanDiff = ThermalTalbe1[FanLevel_t].CFanOn - ThermalTalbe1[FanLevel_t].CFanOff;
 118   3                              //TF_018-->>
 119   3                              /*
 120   3                              *ThermalTalbe1[FanLevel_t].RPM = ThermalTalbe1[FanLevel_t].CRPM + RpmDiff * TmDiff / CFanDiff;
 121   3                              Fan1RPM = *ThermalTalbe1[FanLevel_t].RPM;
 122   3                              */
 123   3                              //TF_018--<<
 124   3                              Fan1RPM = ThermalTalbe1[FanLevel_t].CRPM + RpmDiff * TmDiff / CFanDiff; //TF_018++
 125   3                      }
 126   2                      //TF_018++>>
 127   2                      else    
 128   2                              Fan1RPM = *ThermalTalbe1[FanLevel_t].RPM;
 129   2                      //TF_018++<<
 130   2              }
 131   1              //TF_018-->>
 132   1              /*
 133   1              if(0x00==OS_mode)
 134   1                      Fan1RPM=FanDOSValue;
 135   1              */
 136   1              //TF_018--<<
 137   1      }
 138          
 139          //-----------------------------------------------------------------------------
 140          // The function of check fan rpm 2
 141          //-----------------------------------------------------------------------------
 142          void CheckFanRPM2(void)
 143          {
 144   1              BYTE FanLevel_t = FanLeve2;
 145   1              //TF_018-->>
 146   1              /*
 147   1              BYTE Fan1RPM_t = Fan2RPM;
 148   1      
 149   1              if(Debugtemperature2==0x00)
 150   1              {
 151   1                      temperature2 = TSys_temp;
 152   1              }
 153   1              else
 154   1              {
 155   1                      temperature2 = Debugtemperature2;
 156   1              }
 157   1              */
 158   1              //TF_018--<<
 159   1              //TF_018++>>    
 160   1              BYTE Fan2RPM_t = Fan2RPM;               
 161   1      
 162   1              temperature2 = CpuTm;
 163   1              //TF_018++<<
 164   1                      
 165   1              if(FanLevel_t <((sizeof(ThermalTalbe2)/sizeof(thermal))-1))
 166   1              {
 167   2                      if(temperature2> *ThermalTalbe2[FanLevel_t].FanOn)
 168   2                      {
 169   3                              FanLevel_t += 1;
 170   3                      }
 171   2              }
 172   1              
 173   1              if (FanLevel_t>0)
 174   1              {
 175   2                      if (temperature2< *ThermalTalbe2[FanLevel_t].FanOff)
 176   2                      {                       
 177   3                              FanLevel_t-=1;
 178   3                      }
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 4   

 179   2              }
 180   1                      
 181   1              FanLeve2 = FanLevel_t;  
 182   1              //TF_018--      Fan2RPM = *ThermalTalbe2[FanLevel_t].RPM;
 183   1              //TF_018++>>
 184   1              if(FanLevel_t < sizeof(ThermalTalbe2)/sizeof(thermal)-1)        // :Linear level check
 185   1              {
 186   2                      if (ThermalTalbe2[FanLevel_t].IsLinear) // :Linear calc
 187   2                      {
 188   3                              BYTE RpmDiff = ThermalTalbe2[FanLevel_t+1].CRPM - ThermalTalbe2[FanLevel_t].CRPM;
 189   3                              BYTE TmDiff = temperature2 - ThermalTalbe2[FanLevel_t].CFanOff;
 190   3                              BYTE CFanDiff = ThermalTalbe2[FanLevel_t].CFanOn - ThermalTalbe2[FanLevel_t].CFanOff;
 191   3                              Fan2RPM = ThermalTalbe2[FanLevel_t].CRPM + RpmDiff * TmDiff / CFanDiff;
 192   3                      }
 193   2                      else
 194   2                              Fan2RPM = *ThermalTalbe2[FanLevel_t].RPM;
 195   2              }
 196   1              //TF_018++<<
 197   1      }
 198          
 199          void Fan1MainControl(void)
 200          {
 201   1              //TF_018-->>
 202   1              /*
 203   1              if(Fan1RPM>=Fan2RPM)
 204   1              {       
 205   1                      if(((Fan1RPM*100)-RPMACC)>RPM1)
 206   1                      {
 207   1                              if(FanValue<MaxOutValue)
 208   1                                      FanValue++;     
 209   1                      }
 210   1                      else if(((Fan1RPM*100)+RPMACC)<RPM1)
 211   1                      {
 212   1                              if(FanValue>0x00)
 213   1                                      FanValue--;     
 214   1                      }
 215   1              }
 216   1              else
 217   1              {
 218   1                      if(((Fan2RPM*100)-RPMACC)>RPM1)
 219   1                      {
 220   1                              if(FanValue<MaxOutValue)
 221   1                                      FanValue++;     
 222   1                      }
 223   1                      else if(((Fan2RPM*100)+RPMACC)<RPM1)
 224   1                      {
 225   1                              if(FanValue>0x00)
 226   1                                      FanValue--;     
 227   1                      }               
 228   1              }
 229   1              */
 230   1              //TF_018--<<
 231   1              //TF_018++>>
 232   1              if(((Fan1RPM*100)-RPMACC)>RPM2)
 233   1              {
 234   2                      if(FanValue<MaxOutValue)
 235   2                              FanValue++;     
 236   2              }
 237   1              else if(((Fan1RPM*100)+RPMACC)<RPM2)
 238   1              {
 239   2                      if(FanValue>0x00)
 240   2                              FanValue--;     
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 5   

 241   2              }
 242   1              //TF_018++<<
 243   1      }
 244          
 245          void Fan2MainControl(void)
 246          {
 247   1              //TF_018-->>
 248   1              /*
 249   1              if(Fan2RPM>=Fan1RPM)
 250   1              {
 251   1                      if(((Fan2RPM*100)-RPMACC)>RPM1)
 252   1                      {
 253   1                              if(FanValue<MaxOutValue)
 254   1                                      FanValue++;     
 255   1                      }
 256   1                      else if(((Fan2RPM*100)+RPMACC)<RPM1)
 257   1                      {
 258   1                              if(FanValue>0x00)
 259   1                                      FanValue--;     
 260   1                      }                       
 261   1              }
 262   1          else
 263   1              {       
 264   1                      if(((Fan1RPM*100)-RPMACC)>RPM1)
 265   1                      {
 266   1                              if(FanValue<MaxOutValue)
 267   1                                      FanValue++;     
 268   1                      }
 269   1                      else if(((Fan1RPM*100)+RPMACC)<RPM1)
 270   1                      {
 271   1                              if(FanValue>0x00)
 272   1                                      FanValue--;     
 273   1                      }
 274   1              }
 275   1              */
 276   1              //TF_018--<<
 277   1              //TF_018++>>
 278   1              if(((Fan2RPM*100)-RPMACC)>RPM1)
 279   1              {
 280   2                      if(Fan2Value<MaxOutValue)
 281   2                              Fan2Value++;    
 282   2              }
 283   1                      else if(((Fan2RPM*100)+RPMACC)<RPM1)
 284   1              {
 285   2                      if(Fan2Value>0x00)
 286   2                              Fan2Value--;    
 287   2              }
 288   1              //TF_018++<<            
 289   1      }
 290          
 291          
 292          //-----------------------------------------------------------------------------
 293          // The function of fan rpm control
 294          //-----------------------------------------------------------------------------
 295          void FanControl(void)
 296          {
 297   1              //TF_018-->>
 298   1              /*
 299   1              if(     RPM1==0x0000)
 300   1              {
 301   1                      FanValue = FanInitValue;
 302   1              }
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 6   

 303   1              */
 304   1              //TF_018--<<
 305   1          if(Fan1RPM!=0x00)
 306   1          {
 307   2              Fan1MainControl();
 308   2          }
 309   1              //TF_018--      else
 310   1          if(Fan2RPM!=0x00)   //TF_018++
 311   1          {
 312   2              Fan2MainControl();
 313   2          }
 314   1      }
 315          
 316          
 317          //-----------------------------------------------------------------------------
 318          // Init. thermal table 1
 319          //-----------------------------------------------------------------------------
 320          void InitThermalTable1(void)
 321          {
 322   1              BYTE index;
 323   1              index=0x00;
 324   1              while(index<(sizeof(ThermalTalbe1)/sizeof(thermal)))
 325   1              {
 326   2                      *ThermalTalbe1[index].FanOn=ThermalTalbe1[index].CFanOn;
 327   2                      *ThermalTalbe1[index].FanOff=ThermalTalbe1[index].CFanOff;
 328   2                      *ThermalTalbe1[index].RPM=ThermalTalbe1[index].CRPM;
 329   2                      index++;
 330   2              }
 331   1      }
 332          
 333          //-----------------------------------------------------------------------------
 334          // Init. thermal table 2
 335          //-----------------------------------------------------------------------------
 336          void InitThermalTable2(void)
 337          {
 338   1              BYTE index;
 339   1              index=0x00;
 340   1              while(index<(sizeof(ThermalTalbe2)/sizeof(thermal)))
 341   1              {
 342   2                      *ThermalTalbe2[index].FanOn=ThermalTalbe2[index].CFanOn;
 343   2                      *ThermalTalbe2[index].FanOff=ThermalTalbe2[index].CFanOff;
 344   2                      *ThermalTalbe2[index].RPM=ThermalTalbe2[index].CRPM;
 345   2                      index++;
 346   2              }
 347   1      }
 348          
 349          //-----------------------------------------------------------------------------
 350          // Fan full on control
 351          //-----------------------------------------------------------------------------
 352          void FanFullOn(void)
 353          {
 354   1      
 355   1              FanValue = MaxOutValue;
 356   1              Fan2Value = MaxOutValue-3;
 357   1              FanFullOnCont = FullOnCounter;              //2sec
 358   1      }
 359          
 360          //-----------------------------------------------------------------------------
 361          // Fan full off control
 362          //-----------------------------------------------------------------------------
 363          void FanFullOff(void)
 364          {
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 7   

 365   1              FanValue = 0x00;
 366   1              Fan2Value = 0x00;
 367   1      }
 368          
 369          //-----------------------------------------------------------------------------
 370          // Fan Init on control
 371          //-----------------------------------------------------------------------------
 372          void FanInitOn(void)
 373          {
 374   1              FanValue = FanInitValue;
 375   1              FanFullOnCont = FullOnCounter;              //2sec
 376   1      }
 377          
 378          //-----------------------------------------------------------------------------
 379          // Fan Init on control
 380          //-----------------------------------------------------------------------------
 381          void S5S0FanInitOn(void)
 382          {
 383   1              FanValue = S5S0FanInitValue;
 384   1              //TF_018--      Fan2Value = S5S0FanInitValue-3;
 385   1              Fan2Value = S5S0FanInitValue;   //TF_018++
 386   1              FanFullOnCont = S5S0FullOnCounter;                  //10sec
 387   1      }
 388          
 389          //-----------------------------------------------------------------------------
 390          // Fan Init on control
 391          //-----------------------------------------------------------------------------
 392          void S4S0FanInitOn(void)
 393          {
 394   1              FanValue = S4S0FanInitValue;
 395   1              //TF_018--      Fan2Value = S4S0FanInitValue-3;
 396   1              Fan2Value = S4S0FanInitValue;   //TF_018++
 397   1              FanFullOnCont = S4S0FullOnCounter;                  //10sec
 398   1      }
 399          
 400          
 401          //-----------------------------------------------------------------------------
 402          // Fan Init on control
 403          //-----------------------------------------------------------------------------
 404          void S3S0FanInitOn(void)
 405          {
 406   1              FanValue = S3S0FanInitValue;
 407   1              //TF_018--      Fan2Value = S3S0FanInitValue-3;
 408   1              Fan2Value = S3S0FanInitValue;   //TF_018++
 409   1              FanFullOnCont = S3S0FullOnCounter;                  //2sec
 410   1      }
 411          
 412          
 413          //-----------------------------------------------------------------------------
 414          // Clear fan manual control 
 415          //-----------------------------------------------------------------------------
 416          void Clear_Fan_Debug(void)
 417          {
 418   1              DebugFan1RPMT = 0x00;
 419   1              DebugFan2RPMT = 0x00;
 420   1              CLEAR_MASK(DebugFanStatus,Debug_Fan_enable);
 421   1      }
 422          
 423          
 424          
 425          //-----------------------------------------------------------------------------
 426          // The function of get fan current RPM
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 8   

 427          //-----------------------------------------------------------------------------
 428          void GetRPM1(void)
 429          {
 430   1          BYTE tach_H;
 431   1          BYTE tach_L;
 432   1      
 433   1          tach_H = F1TMRR;
 434   1          tach_L = F1TLRR;   //{F1TMRR,F1TLRR} is the current RPM of RegValue, read from Reg
 435   1          if((tach_H!=0x00)||(tach_L!=0x00))
 436   1          {
 437   2                      if(((tach_H*256) + tach_L)<RPM1Max)
 438   2                      {
 439   3                  RPM1=(4312500/TACH1P/((tach_H*256) + tach_L));   //calculate current RPM
 440   3                      }
 441   2              else
 442   2              {
 443   3                  RPM1=RPM1Max;
 444   3              }
 445   2          }
 446   1          else
 447   1          {
 448   2              RPM1=0x0000;
 449   2          }
 450   1              
 451   1              FAN1_CurrentRPM = RPM1;
 452   1      }
 453          
 454          //-----------------------------------------------------------------------------
 455          // The function of smart fan
 456          // base 100ms-C
 457          //-----------------------------------------------------------------------------
 458          void GetRPM2(void)
 459          {
 460   1          BYTE tach_H;
 461   1          BYTE tach_L;
 462   1      
 463   1          tach_H = F2TMRR;
 464   1          tach_L = F2TLRR;   //{F1TMRR,F1TLRR} is the current RPM of RegValue, read from Reg
 465   1          if((tach_H!=0x00)||(tach_L!=0x00))
 466   1          {
 467   2                      if(((tach_H*256) + tach_L)<RPM1Max)
 468   2                      {
 469   3                  RPM2=(4312500/TACH1P/((tach_H*256) + tach_L));   //calculate current RPM
 470   3                      }
 471   2              else
 472   2              {
 473   3                  RPM2=RPM1Max;
 474   3              }
 475   2          }
 476   1          else
 477   1          {
 478   2              RPM2=0x0000;
 479   2          }
 480   1              
 481   1              FAN2_CurrentRPM = RPM2;
 482   1      }
 483          
 484          
 485          //-----------------------------------------------------------------------------
 486          // The function of smart fan
 487          // base 100ms-C
 488          //-----------------------------------------------------------------------------
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 9   

 489          void FanManager(void)
 490          {
 491   1              if(FanFullOnCont!=0x00)  // Fan full speed count (continue time)
 492   1              {
 493   2                      FanFullOnCont--;
 494   2                      return;
 495   2              }
 496   1      //--------------------- Fan dust mode control stop -----------------------
 497   1      
 498   1      
 499   1              if(((DebugFan1RPMT==0x00) || (DebugFan2RPMT == 0x00)) && (IS_MASK_CLEAR(DebugFanStatus,Debug_Fan_enable))
             -)// In normal control mode
 500   1              {
 501   2                      if((Fan1RPM!=0x00)||(Fan2RPM!=0x00))
 502   2                              FanControl();
 503   2                      else
 504   2                      {
 505   3                              if(FanValue != 0x00)
 506   3                              {
 507   4                                      RPM1=0x0000;
 508   4                                      FanFullOff();
 509   4                              }
 510   3                      }
 511   2                      //TF_018-->>
 512   2                      /*
 513   2                      if(FanValue > 3)
 514   2                              Fan2Value = FanValue - 3;
 515   2                      */
 516   2                      //TF_018--<<
 517   2              }
 518   1              else//------------------------------------In RPM debug mode
 519   1              {       
 520   2                      SET_MASK(DebugFanStatus,Debug_Fan_enable);
 521   2                      if((DebugFan1RPMT==0x00) && (DebugFan2RPMT == 0x00))
 522   2                      {
 523   3                              FanValue = 0;
 524   3                              Fan2Value = 0;
 525   3                              CLEAR_MASK(DebugFanStatus,Debug_Fan_enable);
 526   3                              return;
 527   3                      }       
 528   2                              
 529   2                      if(RPM1==0x0000)
 530   2                      {
 531   3                              FanValue = FanInitValue;
 532   3                      } 
 533   2                      else if(RPM2==0x0000)
 534   2                      {
 535   3                              Fan2Value = FanInitValue;
 536   3                      }
 537   2                      else
 538   2                      {
 539   3                              if(((DebugFan1RPMT*100)-RPMACC)>RPM1)
 540   3                              {
 541   4                                      if(FanValue<MaxOutValue)
 542   4                                              FanValue++;     
 543   4                              }
 544   3                              else if(((DebugFan1RPMT*100)+RPMACC)<RPM1)
 545   3                              {
 546   4                                      if(FanValue>0x00)
 547   4                                              FanValue--;     
 548   4                              }
 549   3      
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 10  

 550   3                              if(((DebugFan2RPMT*100)-RPMACC)>RPM2)
 551   3                              {
 552   4                                      if(Fan2Value<MaxOutValue)
 553   4                                              Fan2Value++;    
 554   4                              }
 555   3                              else if(((DebugFan2RPMT*100)+RPMACC)<RPM2)
 556   3                              {
 557   4                                      if(Fan2Value>0x00)
 558   4                                              Fan2Value--;    
 559   4                              }
 560   3                      }
 561   2              }
 562   1      }
 563          
 564          //-----------------------------------------------------------------------------
 565          // Moniter temperature
 566          //-----------------------------------------------------------------------------
 567          const sTooHot code asTooHot[]=
 568          {
 569                  { &TCPU_temp,   CpuTooHot, &VeryHotCnt,         CpuTooHotTimes },
 570                  { &TPCH_temp,   PCHTooHot, &PCHVeryHotCnt,      PCHTooHotTimes }        
 571          };
 572          
 573          //-----------------------------------------------------------------------------
 574          //T=87  centigrade      Enable  EC throttle     50%  
 575          //T=77  centigrade  Disable EC throttle 50%
 576          //T=89  centigrade  EC shutdown System
 577          // base 1sec-C
 578          //-----------------------------------------------------------------------------
 579          void MoniterTemprature(void)
 580          {
 581   1              if(Debugtemperature1!=0x00)
 582   1                      TCPU_temp = Debugtemperature1;
 583   1              else
 584   1                      TCPU_temp = CpuTm;
 585   1      
 586   1              if(TCPU_temp >= ProchotOnTM)  // CPU drop half frequency
 587   1              {
 588   2                      Oem_Globe_Flag1 |= Oem_CPU_Temp_OV_f;
 589   2                      //PCH_PROCHOT_ON();
 590   2              }
 591   1              else if(TCPU_temp <= ProchotOffTM) // CPU restore all frequency
 592   1              {               
 593   2                      Oem_Globe_Flag1 &= ~Oem_CPU_Temp_OV_f;
 594   2                      //PCH_PROCHOT_OFF();
 595   2              }
 596   1                      
 597   1      
 598   1              if(TCPU_temp >= ShutdownTM)    //EC shutdown
 599   1              {
 600   2                      CPU_TooHot_Cnt += 1;
 601   2                      if(CPU_TooHot_Cnt>3)
 602   2                      {
 603   3                              BRAMDebug(TCPU_temp);
 604   3      
 605   3                              OEM_Debug_flag |= OEM_Temp_Stop_f;
 606   3      
 607   3                              BRAM_TEMP_OV = 0x55;
 608   3                              ETWCFG   = 0x20;
 609   3                      EWDCNTLR = WATCHDOG_COUNTER_1S;    // for 1s counter
 610   3                      EWDKEYR  = 0x5A;     // External WDTreset not match
 611   3                              while(1);                                                       // Wait for watch dog time-out  
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 11  

 612   3                      }
 613   2              }
 614   1              else
 615   1              {
 616   2                      CPU_TooHot_Cnt = 0x00;
 617   2              }
 618   1      }
 619          
 620          //-----------------------------------------------------------------------------
 621          // Function Name : ReadCPUTemp   1sec time base
 622          //-----------------------------------------------------------------------------
 623          #if GetCPUTempSupport
              void ReadCPUTemp(void) 
              {
                  if(SystemIsS0)
                  {
                      // Use PECI interface to read cpu temperature
                      #ifdef PECI_Support
                          #if ReadCPUTemperature
                          if(CPUTjmax==0x00)         // Need to read CPU Tjmax
                          {
                              PECI_ReadCPUTJMAX();
                          }
                          else
                          {
                              PECI_ReadCPUTemp();     // Use PECI interface to read cpu temperature
                          }
                          #endif
                      #endif 
                      
                      // Use thermal sensor to read cpu temperature
                      //SET_MASK(SMBus2Flag1, PollRemote);
                  }
              }
              #endif
 647          
 648          //-----------------------------------------------------------------------------
 649          // Function Name : ReadSysTemp
 650          //-----------------------------------------------------------------------------
 651          #if GetSysTempSupport
              void ReadSysTemp(void) 
              {
                  if(SystemIsS0)
                  {
              
                              #if OEM_GPU_ITS_SUPPORT
                              if(IS_MASK_SET(GPU_INFO_FLG, GPU_INIT_OK))
                              {
                                      SET_MASK(SMBus2Flag1, GPUPackage);
                                      CLEAR_MASK(GPU_INFO_FLG, GPU_INIT_OK);
                              }       
                              #endif
                  }
              }
              #endif
 667          
 668          //-----------------------------------------------------------------------------
 669          // Function Name : InitThermalChip
 670          //-----------------------------------------------------------------------------
 671          void InitThermalChip(void)
 672          {
 673   1              BYTE LimitTm, ReadData;
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 12  

 674   1              LimitTm = 125;
 675   1              TmToSensor = 0xFF;
 676   1      
 677   1      
 678   1              bRWSMBus(SMbusCh2, SMbusWB, 0x98, 0x19, &LimitTm, 0);
 679   1              bRWSMBus(SMbusCh2, SMbusWB, 0x98, 0x20, &LimitTm, 0);
 680   1      
 681   1              if (bRWSMBus(SMbusCh2, SMbusRB, 0x98, 0x19, &ReadData, 0))              // Read for compare
 682   1                      if (ReadData == LimitTm)
 683   1                              if (bRWSMBus(SMbusCh2, SMbusRB, 0x98, 0x20, &ReadData, 0))
 684   1                                      if (ReadData == LimitTm)
 685   1                                              TmToSensor = LimitTm;
 686   1      
 687   1              if (TmToSensor == 0xFF)         // Write fail, enable CR03 bit 1
 688   1              {
 689   2                      if (bRWSMBus(SMbusCh2, SMbusRB, 0x98, 0x03, &ReadData, 0))
 690   2                      {
 691   3                              SET_MASK(ReadData,BIT1);
 692   3                              bRWSMBus(SMbusCh2, SMbusWB, 0x98, 0x03, &ReadData, 0);  //Set CR03 bit 1
 693   3      
 694   3                              bRWSMBus(SMbusCh2, SMbusWB, 0x98, 0x19, &LimitTm, 0);
 695   3                              bRWSMBus(SMbusCh2, SMbusWB, 0x98, 0x20, &LimitTm, 0);
 696   3      
 697   3                              if (bRWSMBus(SMbusCh2, SMbusRB, 0x98, 0x19, &ReadData, 0))              // Read for compare
 698   3                                      if (ReadData == LimitTm)
 699   3                                              if (bRWSMBus(SMbusCh2, SMbusRB, 0x98, 0x20, &ReadData, 0))
 700   3                                                      if (ReadData == LimitTm)
 701   3                                                              TmToSensor = LimitTm;
 702   3                      }
 703   2              }
 704   1      }    
 705          
 706          
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 13  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com006F (BEGIN)
0000         L?0112:
0000         L?0113:
0000 F583              MOV     DPH,A
0002 E4                CLR     A
0003 93                MOVC    A,@A+DPTR
0004 FC                MOV     R4,A
0005 7401              MOV     A,#01H
0007 93                MOVC    A,@A+DPTR
0008 F582              MOV     DPL,A
000A 8C83              MOV     DPH,R4
000C EE                MOV     A,R6
000D F0                MOVX    @DPTR,A
000E 22                RET     
000F         L?0114:
000F         L?0115:
000F F583              MOV     DPH,A
0011 E4                CLR     A
0012 93                MOVC    A,@A+DPTR
0013 FE                MOV     R6,A
0014 7401              MOV     A,#01H
0016 93                MOVC    A,@A+DPTR
0017 F582              MOV     DPL,A
0019 8E83              MOV     DPH,R6
001B E0                MOVX    A,@DPTR
001C 22                RET     
001D         L?0117:
001D E0                MOVX    A,@DPTR
001E 900000      E     MOV     DPTR,#RPM2+01H
0021         L?0118:
0021 75F064            MOV     B,#064H
0024 A4                MUL     AB
0025 249C              ADD     A,#09CH
0027 FF                MOV     R7,A
0028 E5F0              MOV     A,B
002A 34FF              ADDC    A,#0FFH
002C FE                MOV     R6,A
002D C3                CLR     C
002E E0                MOVX    A,@DPTR
002F 9F                SUBB    A,R7
0030 22                RET     
0031         L?0119:
0031 E0                MOVX    A,@DPTR
0032 900000      E     MOV     DPTR,#RPM1+01H
0035         L?0120:
0035 75F064            MOV     B,#064H
0038 A4                MUL     AB
0039 2464              ADD     A,#064H
003B FF                MOV     R7,A
003C E4                CLR     A
003D 35F0              ADDC    A,B
003F FE                MOV     R6,A
0040 D3                SETB    C
0041 E0                MOVX    A,@DPTR
0042 9F                SUBB    A,R7
0043 22                RET     
0044         L?0121:
0044         L?0122:
0044 F583              MOV     DPH,A
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 14  

0046 E4                CLR     A
0047 93                MOVC    A,@A+DPTR
0048 FE                MOV     R6,A
0049 EF                MOV     A,R7
004A 75F00B            MOV     B,#0BH
004D A4                MUL     AB
004E 22                RET     
004F         L?0123:
004F CF                XCH     A,R7
0050 ED                MOV     A,R5
0051 CF                XCH     A,R7
0052 ED                MOV     A,R5
0053 FE                MOV     R6,A
0054 CD                XCH     A,R5
0055 EC                MOV     A,R4
0056 CD                XCH     A,R5
0057 7C00              MOV     R4,#00H
0059 E4                CLR     A
005A 2D                ADD     A,R5
005B FF                MOV     R7,A
005C EC                MOV     A,R4
005D 3E                ADDC    A,R6
005E CB                XCH     A,R3
005F EF                MOV     A,R7
0060 CB                XCH     A,R3
0061 FA                MOV     R2,A
0062 E4                CLR     A
0063 F9                MOV     R1,A
0064 F8                MOV     R0,A
0065 7FDA              MOV     R7,#0DAH
0067 7EE6              MOV     R6,#0E6H
0069 7D20              MOV     R5,#020H
006B 020000      E     LJMP    ?C?SLDIV
006E         L?0124:
006E         L?0125:
006E 900000      E     MOV     DPTR,#DCR4
0071 7414              MOV     A,#014H
0073 F0                MOVX    @DPTR,A
0074 900000      E     MOV     DPTR,#DCR7
0077 F0                MOVX    @DPTR,A
0078 900000      E     MOV     DPTR,#FanFullOnCont
007B 22                RET     
007C         L?0126:
007C 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
007F 7403              MOV     A,#03H
0081 F0                MOVX    @DPTR,A
0082 A3                INC     DPTR
0083 7400        R     MOV     A,#HIGH ReadData
0085 F0                MOVX    @DPTR,A
0086 A3                INC     DPTR
0087 7400        R     MOV     A,#LOW ReadData
0089 F0                MOVX    @DPTR,A
008A E4                CLR     A
008B A3                INC     DPTR
008C F0                MOVX    @DPTR,A
008D 7B98              MOV     R3,#098H
008F 22                RET     
0090         L?0127:
0090 ED                MOV     A,R5
0091 FE                MOV     R6,A
0092 EC                MOV     A,R4
0093 7A00              MOV     R2,#00H
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 15  

0095 2400              ADD     A,#00H
0097 FF                MOV     R7,A
0098 EA                MOV     A,R2
0099 3E                ADDC    A,R6
009A FE                MOV     R6,A
009B C3                CLR     C
009C EF                MOV     A,R7
009D 9458              SUBB    A,#058H
009F EE                MOV     A,R6
00A0 941B              SUBB    A,#01BH
00A2 22                RET     
00A3         L?0128:
00A3         L?0129:
00A3 900000      R     MOV     DPTR,#LimitTm
00A6 E0                MOVX    A,@DPTR
00A7 FF                MOV     R7,A
00A8 A3                INC     DPTR
00A9 E0                MOVX    A,@DPTR
00AA 6F                XRL     A,R7
00AB 22                RET     
00AC         L?0130:
00AC 75F00B            MOV     B,#0BH
00AF A4                MUL     AB
00B0 2400        R     ADD     A,#LOW ThermalTalbe1+03H
00B2 F582              MOV     DPL,A
00B4 E4                CLR     A
00B5 3400        R     ADDC    A,#HIGH ThermalTalbe1+03H
00B7 22                RET     
00B8         L?0131:
00B8 75F00B            MOV     B,#0BH
00BB A4                MUL     AB
00BC 2400        R     ADD     A,#LOW ThermalTalbe1+02H
00BE F582              MOV     DPL,A
00C0 E4                CLR     A
00C1 3400        R     ADDC    A,#HIGH ThermalTalbe1+02H
00C3 22                RET     
00C4         L?0132:
00C4 75F00B            MOV     B,#0BH
00C7 A4                MUL     AB
00C8 2400        R     ADD     A,#LOW ThermalTalbe1+01H
00CA F582              MOV     DPL,A
00CC E4                CLR     A
00CD 3400        R     ADDC    A,#HIGH ThermalTalbe1+01H
00CF 22                RET     
00D0         L?0133:
00D0 FE                MOV     R6,A
00D1 E0                MOVX    A,@DPTR
00D2 8EF0              MOV     B,R6
00D4 A4                MUL     AB
00D5 8FF0              MOV     B,R7
00D7 84                DIV     AB
00D8 FF                MOV     R7,A
00D9 EC                MOV     A,R4
00DA 2F                ADD     A,R7
00DB 22                RET     
00DC         L?0134:
00DC 75F00B            MOV     B,#0BH
00DF A4                MUL     AB
00E0 2400        R     ADD     A,#LOW ThermalTalbe2+03H
00E2 F582              MOV     DPL,A
00E4 E4                CLR     A
00E5 3400        R     ADDC    A,#HIGH ThermalTalbe2+03H
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 16  

00E7 22                RET     
00E8         L?0135:
00E8 75F00B            MOV     B,#0BH
00EB A4                MUL     AB
00EC 2400        R     ADD     A,#LOW ThermalTalbe2+02H
00EE F582              MOV     DPL,A
00F0 E4                CLR     A
00F1 3400        R     ADDC    A,#HIGH ThermalTalbe2+02H
00F3 22                RET     
00F4         L?0136:
00F4 75F00B            MOV     B,#0BH
00F7 A4                MUL     AB
00F8 2400        R     ADD     A,#LOW ThermalTalbe2+01H
00FA F582              MOV     DPL,A
00FC E4                CLR     A
00FD 3400        R     ADDC    A,#HIGH ThermalTalbe2+01H
00FF 22                RET     
0100         L?0137:
0100 F583              MOV     DPH,A
0102 E4                CLR     A
0103 93                MOVC    A,@A+DPTR
0104 FC                MOV     R4,A
0105 ED                MOV     A,R5
0106 75F00B            MOV     B,#0BH
0109 A4                MUL     AB
010A 22                RET     
             ; FUNCTION Com006F (END)

             ; FUNCTION CheckFanRPM1 (BEGIN)
                                           ; SOURCE LINE # 78
                                           ; SOURCE LINE # 79
                                           ; SOURCE LINE # 80
0000 900000      E     MOV     DPTR,#FanLevel
0003 E0                MOVX    A,@DPTR
;---- Variable 'FanLevel_t' assigned to Register 'R5' ----
0004 FD                MOV     R5,A
                                           ; SOURCE LINE # 81
0005 900000      E     MOV     DPTR,#Fan1RPM
0008 E0                MOVX    A,@DPTR
0009 900000      R     MOV     DPTR,#Fan1RPM_t
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 83
000D 900000      E     MOV     DPTR,#CpuTm
0010 E0                MOVX    A,@DPTR
0011 900000      E     MOV     DPTR,#temperature1
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 92
0015 ED                MOV     A,R5
0016 C3                CLR     C
0017 9405              SUBB    A,#05H
0019 5019              JNC     ?C0001
                                           ; SOURCE LINE # 93
                                           ; SOURCE LINE # 94
001B ED                MOV     A,R5
001C 75F00B            MOV     B,#0BH
001F A4                MUL     AB
0020 2400        R     ADD     A,#LOW ThermalTalbe1+05H
0022 F582              MOV     DPL,A
0024 E4                CLR     A
0025 3400        R     ADDC    A,#HIGH ThermalTalbe1+05H
0027 120000      R     LCALL   L?0114
002A FF                MOV     R7,A
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 17  

002B 900000      E     MOV     DPTR,#temperature1
002E E0                MOVX    A,@DPTR
002F D3                SETB    C
0030 9F                SUBB    A,R7
0031 4001              JC      ?C0001
                                           ; SOURCE LINE # 95
                                           ; SOURCE LINE # 96
0033 0D                INC     R5
                                           ; SOURCE LINE # 97
                                           ; SOURCE LINE # 98
0034         ?C0001:
                                           ; SOURCE LINE # 100
0034 ED                MOV     A,R5
0035 D3                SETB    C
0036 9400              SUBB    A,#00H
0038 4019              JC      ?C0003
                                           ; SOURCE LINE # 101
                                           ; SOURCE LINE # 102
003A ED                MOV     A,R5
003B 75F00B            MOV     B,#0BH
003E A4                MUL     AB
003F 2400        R     ADD     A,#LOW ThermalTalbe1+07H
0041 F582              MOV     DPL,A
0043 E4                CLR     A
0044 3400        R     ADDC    A,#HIGH ThermalTalbe1+07H
0046 120000      R     LCALL   L?0114
0049 FF                MOV     R7,A
004A 900000      E     MOV     DPTR,#temperature1
004D E0                MOVX    A,@DPTR
004E C3                CLR     C
004F 9F                SUBB    A,R7
0050 5001              JNC     ?C0003
                                           ; SOURCE LINE # 103
                                           ; SOURCE LINE # 104
0052 1D                DEC     R5
                                           ; SOURCE LINE # 105
                                           ; SOURCE LINE # 106
0053         ?C0003:
                                           ; SOURCE LINE # 108
0053 900000      E     MOV     DPTR,#FanLevel
0056 ED                MOV     A,R5
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 111
0058 C3                CLR     C
0059 9405              SUBB    A,#05H
005B 506E              JNC     ?C0008
                                           ; SOURCE LINE # 112
                                           ; SOURCE LINE # 113
005D ED                MOV     A,R5
005E 75F00B            MOV     B,#0BH
0061 A4                MUL     AB
0062 2400        R     ADD     A,#LOW ThermalTalbe1+04H
0064 F582              MOV     DPL,A
0066 E4                CLR     A
0067 3400        R     ADDC    A,#HIGH ThermalTalbe1+04H
0069 F583              MOV     DPH,A
006B E4                CLR     A
006C 93                MOVC    A,@A+DPTR
006D 6046              JZ      ?C0006
                                           ; SOURCE LINE # 114
                                           ; SOURCE LINE # 115
006F ED                MOV     A,R5
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 18  

0070 120000      R     LCALL   L?0130
0073 120000      R     LCALL   L?0137
0076 2400        R     ADD     A,#LOW ThermalTalbe1+0EH
0078 F582              MOV     DPL,A
007A E4                CLR     A
007B 3400        R     ADDC    A,#HIGH ThermalTalbe1+0EH
007D F583              MOV     DPH,A
007F E4                CLR     A
0080 93                MOVC    A,@A+DPTR
0081 C3                CLR     C
0082 9C                SUBB    A,R4
0083 900000      R     MOV     DPTR,#RpmDiff
0086 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 116
0087 ED                MOV     A,R5
0088 120000      R     LCALL   L?0131
008B F583              MOV     DPH,A
008D E4                CLR     A
008E 93                MOVC    A,@A+DPTR
008F FB                MOV     R3,A
0090 900000      E     MOV     DPTR,#temperature1
0093 E0                MOVX    A,@DPTR
0094 C3                CLR     C
0095 9B                SUBB    A,R3
0096 900000      R     MOV     DPTR,#TmDiff
0099 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 117
009A ED                MOV     A,R5
009B 120000      R     LCALL   L?0132
009E F583              MOV     DPH,A
00A0 E4                CLR     A
00A1 93                MOVC    A,@A+DPTR
00A2 C3                CLR     C
00A3 9B                SUBB    A,R3
00A4 FF                MOV     R7,A
00A5 900000      R     MOV     DPTR,#CFanDiff
00A8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 124
00A9 900000      R     MOV     DPTR,#TmDiff
00AC E0                MOVX    A,@DPTR
00AD 900000      R     MOV     DPTR,#RpmDiff
00B0 120000      R     LCALL   L?0133
                                           ; SOURCE LINE # 125
00B3 8012              SJMP    ?C0105
00B5         ?C0006:
                                           ; SOURCE LINE # 128
00B5 CF                XCH     A,R7
00B6 ED                MOV     A,R5
00B7 CF                XCH     A,R7
00B8 ED                MOV     A,R5
00B9 75F00B            MOV     B,#0BH
00BC A4                MUL     AB
00BD 2400        R     ADD     A,#LOW ThermalTalbe1+09H
00BF F582              MOV     DPL,A
00C1 E4                CLR     A
00C2 3400        R     ADDC    A,#HIGH ThermalTalbe1+09H
00C4 120000      R     LCALL   L?0115
00C7         ?C0105:
00C7 900000      E     MOV     DPTR,#Fan1RPM
00CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 130
                                           ; SOURCE LINE # 137
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 19  

00CB         ?C0008:
00CB 22                RET     
             ; FUNCTION CheckFanRPM1 (END)

             ; FUNCTION CheckFanRPM2 (BEGIN)
                                           ; SOURCE LINE # 142
                                           ; SOURCE LINE # 143
                                           ; SOURCE LINE # 144
0000 900000      E     MOV     DPTR,#FanLeve2
0003 E0                MOVX    A,@DPTR
;---- Variable 'FanLevel_t' assigned to Register 'R5' ----
0004 FD                MOV     R5,A
                                           ; SOURCE LINE # 160
0005 900000      E     MOV     DPTR,#Fan2RPM
0008 E0                MOVX    A,@DPTR
0009 900000      R     MOV     DPTR,#Fan2RPM_t
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 162
000D 900000      E     MOV     DPTR,#CpuTm
0010 E0                MOVX    A,@DPTR
0011 900000      E     MOV     DPTR,#temperature2
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 165
0015 ED                MOV     A,R5
0016 C3                CLR     C
0017 9405              SUBB    A,#05H
0019 5019              JNC     ?C0009
                                           ; SOURCE LINE # 166
                                           ; SOURCE LINE # 167
001B ED                MOV     A,R5
001C 75F00B            MOV     B,#0BH
001F A4                MUL     AB
0020 2400        R     ADD     A,#LOW ThermalTalbe2+05H
0022 F582              MOV     DPL,A
0024 E4                CLR     A
0025 3400        R     ADDC    A,#HIGH ThermalTalbe2+05H
0027 120000      R     LCALL   L?0115
002A FF                MOV     R7,A
002B 900000      E     MOV     DPTR,#temperature2
002E E0                MOVX    A,@DPTR
002F D3                SETB    C
0030 9F                SUBB    A,R7
0031 4001              JC      ?C0009
                                           ; SOURCE LINE # 168
                                           ; SOURCE LINE # 169
0033 0D                INC     R5
                                           ; SOURCE LINE # 170
                                           ; SOURCE LINE # 171
0034         ?C0009:
                                           ; SOURCE LINE # 173
0034 ED                MOV     A,R5
0035 D3                SETB    C
0036 9400              SUBB    A,#00H
0038 4019              JC      ?C0011
                                           ; SOURCE LINE # 174
                                           ; SOURCE LINE # 175
003A ED                MOV     A,R5
003B 75F00B            MOV     B,#0BH
003E A4                MUL     AB
003F 2400        R     ADD     A,#LOW ThermalTalbe2+07H
0041 F582              MOV     DPL,A
0043 E4                CLR     A
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 20  

0044 3400        R     ADDC    A,#HIGH ThermalTalbe2+07H
0046 120000      R     LCALL   L?0115
0049 FF                MOV     R7,A
004A 900000      E     MOV     DPTR,#temperature2
004D E0                MOVX    A,@DPTR
004E C3                CLR     C
004F 9F                SUBB    A,R7
0050 5001              JNC     ?C0011
                                           ; SOURCE LINE # 176
                                           ; SOURCE LINE # 177
0052 1D                DEC     R5
                                           ; SOURCE LINE # 178
                                           ; SOURCE LINE # 179
0053         ?C0011:
                                           ; SOURCE LINE # 181
0053 900000      E     MOV     DPTR,#FanLeve2
0056 ED                MOV     A,R5
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 184
0058 C3                CLR     C
0059 9405              SUBB    A,#05H
005B 506E              JNC     ?C0016
                                           ; SOURCE LINE # 185
                                           ; SOURCE LINE # 186
005D ED                MOV     A,R5
005E 75F00B            MOV     B,#0BH
0061 A4                MUL     AB
0062 2400        R     ADD     A,#LOW ThermalTalbe2+04H
0064 F582              MOV     DPL,A
0066 E4                CLR     A
0067 3400        R     ADDC    A,#HIGH ThermalTalbe2+04H
0069 F583              MOV     DPH,A
006B E4                CLR     A
006C 93                MOVC    A,@A+DPTR
006D 6046              JZ      ?C0014
                                           ; SOURCE LINE # 187
                                           ; SOURCE LINE # 188
006F ED                MOV     A,R5
0070 120000      R     LCALL   L?0134
0073 120000      R     LCALL   L?0137
0076 2400        R     ADD     A,#LOW ThermalTalbe2+0EH
0078 F582              MOV     DPL,A
007A E4                CLR     A
007B 3400        R     ADDC    A,#HIGH ThermalTalbe2+0EH
007D F583              MOV     DPH,A
007F E4                CLR     A
0080 93                MOVC    A,@A+DPTR
0081 C3                CLR     C
0082 9C                SUBB    A,R4
0083 900000      R     MOV     DPTR,#RpmDiff
0086 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 189
0087 ED                MOV     A,R5
0088 120000      R     LCALL   L?0135
008B F583              MOV     DPH,A
008D E4                CLR     A
008E 93                MOVC    A,@A+DPTR
008F FB                MOV     R3,A
0090 900000      E     MOV     DPTR,#temperature2
0093 E0                MOVX    A,@DPTR
0094 C3                CLR     C
0095 9B                SUBB    A,R3
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 21  

0096 900000      R     MOV     DPTR,#TmDiff
0099 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 190
009A ED                MOV     A,R5
009B 120000      R     LCALL   L?0136
009E F583              MOV     DPH,A
00A0 E4                CLR     A
00A1 93                MOVC    A,@A+DPTR
00A2 C3                CLR     C
00A3 9B                SUBB    A,R3
00A4 FF                MOV     R7,A
00A5 900000      R     MOV     DPTR,#CFanDiff
00A8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 191
00A9 900000      R     MOV     DPTR,#TmDiff
00AC E0                MOVX    A,@DPTR
00AD 900000      R     MOV     DPTR,#RpmDiff
00B0 120000      R     LCALL   L?0133
                                           ; SOURCE LINE # 192
00B3 8012              SJMP    ?C0106
00B5         ?C0014:
                                           ; SOURCE LINE # 194
00B5 CF                XCH     A,R7
00B6 ED                MOV     A,R5
00B7 CF                XCH     A,R7
00B8 ED                MOV     A,R5
00B9 75F00B            MOV     B,#0BH
00BC A4                MUL     AB
00BD 2400        R     ADD     A,#LOW ThermalTalbe2+09H
00BF F582              MOV     DPL,A
00C1 E4                CLR     A
00C2 3400        R     ADDC    A,#HIGH ThermalTalbe2+09H
00C4 120000      R     LCALL   L?0115
00C7         ?C0106:
00C7 900000      E     MOV     DPTR,#Fan2RPM
00CA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 195
                                           ; SOURCE LINE # 197
00CB         ?C0016:
00CB 22                RET     
             ; FUNCTION CheckFanRPM2 (END)

             ; FUNCTION Fan1MainControl (BEGIN)
                                           ; SOURCE LINE # 199
                                           ; SOURCE LINE # 200
                                           ; SOURCE LINE # 232
0000 900000      E     MOV     DPTR,#Fan1RPM
0003 120000      R     LCALL   L?0117
0006 900000      E     MOV     DPTR,#RPM2
0009 E0                MOVX    A,@DPTR
000A 9E                SUBB    A,R6
000B 500D              JNC     ?C0017
                                           ; SOURCE LINE # 233
                                           ; SOURCE LINE # 234
000D 900000      E     MOV     DPTR,#DCR4
0010 E0                MOVX    A,@DPTR
0011 C3                CLR     C
0012 943F              SUBB    A,#03FH
0014 5021              JNC     ?C0022
                                           ; SOURCE LINE # 235
0016 E0                MOVX    A,@DPTR
0017 04                INC     A
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 22  

0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 236
0019 22                RET     
001A         ?C0017:
                                           ; SOURCE LINE # 237
001A 900000      E     MOV     DPTR,#Fan1RPM
001D E0                MOVX    A,@DPTR
001E 900000      E     MOV     DPTR,#RPM2+01H
0021 120000      R     LCALL   L?0120
0024 900000      E     MOV     DPTR,#RPM2
0027 E0                MOVX    A,@DPTR
0028 9E                SUBB    A,R6
0029 400C              JC      ?C0022
                                           ; SOURCE LINE # 238
                                           ; SOURCE LINE # 239
002B 900000      E     MOV     DPTR,#DCR4
002E E0                MOVX    A,@DPTR
002F D3                SETB    C
0030 9400              SUBB    A,#00H
0032 4003              JC      ?C0022
                                           ; SOURCE LINE # 240
0034 E0                MOVX    A,@DPTR
0035 14                DEC     A
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 241
                                           ; SOURCE LINE # 243
0037         ?C0022:
0037 22                RET     
             ; FUNCTION Fan1MainControl (END)

             ; FUNCTION Fan2MainControl (BEGIN)
                                           ; SOURCE LINE # 245
                                           ; SOURCE LINE # 246
                                           ; SOURCE LINE # 278
0000 900000      E     MOV     DPTR,#Fan2RPM
0003 E0                MOVX    A,@DPTR
0004 900000      E     MOV     DPTR,#RPM1+01H
0007 120000      R     LCALL   L?0118
000A 900000      E     MOV     DPTR,#RPM1
000D E0                MOVX    A,@DPTR
000E 9E                SUBB    A,R6
000F 500D              JNC     ?C0023
                                           ; SOURCE LINE # 279
                                           ; SOURCE LINE # 280
0011 900000      E     MOV     DPTR,#DCR7
0014 E0                MOVX    A,@DPTR
0015 C3                CLR     C
0016 943F              SUBB    A,#03FH
0018 501D              JNC     ?C0028
                                           ; SOURCE LINE # 281
001A E0                MOVX    A,@DPTR
001B 04                INC     A
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 282
001D 22                RET     
001E         ?C0023:
                                           ; SOURCE LINE # 283
001E 900000      E     MOV     DPTR,#Fan2RPM
0021 120000      R     LCALL   L?0119
0024 900000      E     MOV     DPTR,#RPM1
0027 E0                MOVX    A,@DPTR
0028 9E                SUBB    A,R6
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 23  

0029 400C              JC      ?C0028
                                           ; SOURCE LINE # 284
                                           ; SOURCE LINE # 285
002B 900000      E     MOV     DPTR,#DCR7
002E E0                MOVX    A,@DPTR
002F D3                SETB    C
0030 9400              SUBB    A,#00H
0032 4003              JC      ?C0028
                                           ; SOURCE LINE # 286
0034 E0                MOVX    A,@DPTR
0035 14                DEC     A
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 287
                                           ; SOURCE LINE # 289
0037         ?C0028:
0037 22                RET     
             ; FUNCTION Fan2MainControl (END)

             ; FUNCTION FanControl (BEGIN)
                                           ; SOURCE LINE # 295
                                           ; SOURCE LINE # 296
                                           ; SOURCE LINE # 305
0000 900000      E     MOV     DPTR,#Fan1RPM
0003 E0                MOVX    A,@DPTR
0004 6003              JZ      ?C0029
                                           ; SOURCE LINE # 306
                                           ; SOURCE LINE # 307
0006 120000      R     LCALL   Fan1MainControl
                                           ; SOURCE LINE # 308
0009         ?C0029:
                                           ; SOURCE LINE # 310
0009 900000      E     MOV     DPTR,#Fan2RPM
000C E0                MOVX    A,@DPTR
000D 6003              JZ      ?C0031
                                           ; SOURCE LINE # 311
                                           ; SOURCE LINE # 312
000F 120000      R     LCALL   Fan2MainControl
                                           ; SOURCE LINE # 313
                                           ; SOURCE LINE # 314
0012         ?C0031:
0012 22                RET     
             ; FUNCTION FanControl (END)

             ; FUNCTION InitThermalTable1 (BEGIN)
                                           ; SOURCE LINE # 320
                                           ; SOURCE LINE # 321
                                           ; SOURCE LINE # 323
;---- Variable 'index' assigned to Register 'R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
0002         ?C0032:
                                           ; SOURCE LINE # 324
                                           ; SOURCE LINE # 325
                                           ; SOURCE LINE # 326
0002 EF                MOV     A,R7
0003 120000      R     LCALL   L?0132
0006 120000      R     LCALL   L?0121
0009 2400        R     ADD     A,#LOW ThermalTalbe1+05H
000B F582              MOV     DPL,A
000D E4                CLR     A
000E 3400        R     ADDC    A,#HIGH ThermalTalbe1+05H
0010 120000      R     LCALL   L?0112
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 24  

                                           ; SOURCE LINE # 327
0013 EF                MOV     A,R7
0014 120000      R     LCALL   L?0131
0017 120000      R     LCALL   L?0121
001A 2400        R     ADD     A,#LOW ThermalTalbe1+07H
001C F582              MOV     DPL,A
001E E4                CLR     A
001F 3400        R     ADDC    A,#HIGH ThermalTalbe1+07H
0021 120000      R     LCALL   L?0112
                                           ; SOURCE LINE # 328
0024 EF                MOV     A,R7
0025 120000      R     LCALL   L?0130
0028 120000      R     LCALL   L?0122
002B 2400        R     ADD     A,#LOW ThermalTalbe1+09H
002D F582              MOV     DPL,A
002F E4                CLR     A
0030 3400        R     ADDC    A,#HIGH ThermalTalbe1+09H
0032 120000      R     LCALL   L?0113
                                           ; SOURCE LINE # 329
0035 0F                INC     R7
                                           ; SOURCE LINE # 330
0036 EF                MOV     A,R7
0037 6406              XRL     A,#06H
0039 70C7              JNZ     ?C0032
                                           ; SOURCE LINE # 331
003B         ?C0034:
003B 22                RET     
             ; FUNCTION InitThermalTable1 (END)

             ; FUNCTION InitThermalTable2 (BEGIN)
                                           ; SOURCE LINE # 336
                                           ; SOURCE LINE # 337
                                           ; SOURCE LINE # 339
;---- Variable 'index' assigned to Register 'R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
0002         ?C0035:
                                           ; SOURCE LINE # 340
                                           ; SOURCE LINE # 341
                                           ; SOURCE LINE # 342
0002 EF                MOV     A,R7
0003 120000      R     LCALL   L?0136
0006 120000      R     LCALL   L?0122
0009 2400        R     ADD     A,#LOW ThermalTalbe2+05H
000B F582              MOV     DPL,A
000D E4                CLR     A
000E 3400        R     ADDC    A,#HIGH ThermalTalbe2+05H
0010 120000      R     LCALL   L?0113
                                           ; SOURCE LINE # 343
0013 EF                MOV     A,R7
0014 120000      R     LCALL   L?0135
0017 120000      R     LCALL   L?0122
001A 2400        R     ADD     A,#LOW ThermalTalbe2+07H
001C F582              MOV     DPL,A
001E E4                CLR     A
001F 3400        R     ADDC    A,#HIGH ThermalTalbe2+07H
0021 120000      R     LCALL   L?0113
                                           ; SOURCE LINE # 344
0024 EF                MOV     A,R7
0025 120000      R     LCALL   L?0134
0028 120000      R     LCALL   L?0122
002B 2400        R     ADD     A,#LOW ThermalTalbe2+09H
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 25  

002D F582              MOV     DPL,A
002F E4                CLR     A
0030 3400        R     ADDC    A,#HIGH ThermalTalbe2+09H
0032 120000      R     LCALL   L?0113
                                           ; SOURCE LINE # 345
0035 0F                INC     R7
                                           ; SOURCE LINE # 346
0036 EF                MOV     A,R7
0037 6406              XRL     A,#06H
0039 70C7              JNZ     ?C0035
                                           ; SOURCE LINE # 347
003B         ?C0037:
003B 22                RET     
             ; FUNCTION InitThermalTable2 (END)

             ; FUNCTION FanFullOn (BEGIN)
                                           ; SOURCE LINE # 352
                                           ; SOURCE LINE # 353
                                           ; SOURCE LINE # 355
0000 900000      E     MOV     DPTR,#DCR4
0003 743F              MOV     A,#03FH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 356
0006 900000      E     MOV     DPTR,#DCR7
0009 743C              MOV     A,#03CH
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 357
000C 900000      E     MOV     DPTR,#FanFullOnCont
000F 7414              MOV     A,#014H
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 358
0012 22                RET     
             ; FUNCTION FanFullOn (END)

             ; FUNCTION FanFullOff (BEGIN)
                                           ; SOURCE LINE # 363
                                           ; SOURCE LINE # 364
                                           ; SOURCE LINE # 365
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#DCR4
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 366
0005 900000      E     MOV     DPTR,#DCR7
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 367
0009 22                RET     
             ; FUNCTION FanFullOff (END)

             ; FUNCTION FanInitOn (BEGIN)
                                           ; SOURCE LINE # 372
                                           ; SOURCE LINE # 373
                                           ; SOURCE LINE # 374
0000 900000      E     MOV     DPTR,#DCR4
0003 7414              MOV     A,#014H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 375
0006 900000      E     MOV     DPTR,#FanFullOnCont
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 376
000A 22                RET     
             ; FUNCTION FanInitOn (END)

C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 26  

             ; FUNCTION S5S0FanInitOn (BEGIN)
                                           ; SOURCE LINE # 381
                                           ; SOURCE LINE # 382
                                           ; SOURCE LINE # 383
                                           ; SOURCE LINE # 385
                                           ; SOURCE LINE # 386
0000 120000      R     LCALL   L?0124
0003 7464              MOV     A,#064H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 387
0006 22                RET     
             ; FUNCTION S5S0FanInitOn (END)

             ; FUNCTION S4S0FanInitOn (BEGIN)
                                           ; SOURCE LINE # 392
                                           ; SOURCE LINE # 393
                                           ; SOURCE LINE # 394
                                           ; SOURCE LINE # 396
                                           ; SOURCE LINE # 397
0000 120000      R     LCALL   L?0124
0003 7464              MOV     A,#064H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 398
0006 22                RET     
             ; FUNCTION S4S0FanInitOn (END)

             ; FUNCTION S3S0FanInitOn (BEGIN)
                                           ; SOURCE LINE # 404
                                           ; SOURCE LINE # 405
                                           ; SOURCE LINE # 406
                                           ; SOURCE LINE # 408
                                           ; SOURCE LINE # 409
0000 120000      R     LCALL   L?0125
0003 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 410
0004 22                RET     
             ; FUNCTION S3S0FanInitOn (END)

             ; FUNCTION Clear_Fan_Debug (BEGIN)
                                           ; SOURCE LINE # 416
                                           ; SOURCE LINE # 417
                                           ; SOURCE LINE # 418
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#DebugFan1RPMT
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 419
0005 900000      E     MOV     DPTR,#DebugFan2RPMT
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 420
0009 900000      E     MOV     DPTR,#DebugFanStatus
000C E0                MOVX    A,@DPTR
000D 54FE              ANL     A,#0FEH
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 421
0010 22                RET     
             ; FUNCTION Clear_Fan_Debug (END)

             ; FUNCTION GetRPM1 (BEGIN)
                                           ; SOURCE LINE # 428
                                           ; SOURCE LINE # 429
                                           ; SOURCE LINE # 433
0000 900000      E     MOV     DPTR,#F1TMRR
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 27  

0003 E0                MOVX    A,@DPTR
;---- Variable 'tach_H' assigned to Register 'R5' ----
0004 FD                MOV     R5,A
                                           ; SOURCE LINE # 434
0005 900000      E     MOV     DPTR,#F1TLRR
0008 E0                MOVX    A,@DPTR
;---- Variable 'tach_L' assigned to Register 'R4' ----
0009 FC                MOV     R4,A
                                           ; SOURCE LINE # 435
000A ED                MOV     A,R5
000B 7003              JNZ     ?C0046
000D EC                MOV     A,R4
000E 601E              JZ      ?C0045
0010         ?C0046:
                                           ; SOURCE LINE # 436
                                           ; SOURCE LINE # 437
0010 120000      R     LCALL   L?0127
0013 500D              JNC     ?C0047
                                           ; SOURCE LINE # 438
                                           ; SOURCE LINE # 439
0015 120000      R     LCALL   L?0123
0018 900000      E     MOV     DPTR,#RPM1
001B EE                MOV     A,R6
001C F0                MOVX    @DPTR,A
001D A3                INC     DPTR
001E EF                MOV     A,R7
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 440
0020 8013              SJMP    ?C0049
0022         ?C0047:
                                           ; SOURCE LINE # 442
                                           ; SOURCE LINE # 443
0022 900000      E     MOV     DPTR,#RPM1
0025 741B              MOV     A,#01BH
0027 F0                MOVX    @DPTR,A
0028 A3                INC     DPTR
0029 7458              MOV     A,#058H
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 444
                                           ; SOURCE LINE # 445
002C 8007              SJMP    ?C0049
002E         ?C0045:
                                           ; SOURCE LINE # 447
                                           ; SOURCE LINE # 448
002E E4                CLR     A
002F 900000      E     MOV     DPTR,#RPM1
0032 F0                MOVX    @DPTR,A
0033 A3                INC     DPTR
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 449
0035         ?C0049:
                                           ; SOURCE LINE # 451
0035 900000      E     MOV     DPTR,#RPM1
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
003A A3                INC     DPTR
003B E0                MOVX    A,@DPTR
003C 900000      E     MOV     DPTR,#FAN1_CurrentRPM
003F CF                XCH     A,R7
0040 F0                MOVX    @DPTR,A
0041 A3                INC     DPTR
0042 EF                MOV     A,R7
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 28  

0043 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 452
0044 22                RET     
             ; FUNCTION GetRPM1 (END)

             ; FUNCTION GetRPM2 (BEGIN)
                                           ; SOURCE LINE # 458
                                           ; SOURCE LINE # 459
                                           ; SOURCE LINE # 463
0000 900000      E     MOV     DPTR,#F2TMRR
0003 E0                MOVX    A,@DPTR
;---- Variable 'tach_H' assigned to Register 'R5' ----
0004 FD                MOV     R5,A
                                           ; SOURCE LINE # 464
0005 900000      E     MOV     DPTR,#F2TLRR
0008 E0                MOVX    A,@DPTR
;---- Variable 'tach_L' assigned to Register 'R4' ----
0009 FC                MOV     R4,A
                                           ; SOURCE LINE # 465
000A ED                MOV     A,R5
000B 7003              JNZ     ?C0052
000D EC                MOV     A,R4
000E 601E              JZ      ?C0051
0010         ?C0052:
                                           ; SOURCE LINE # 466
                                           ; SOURCE LINE # 467
0010 120000      R     LCALL   L?0127
0013 500D              JNC     ?C0053
                                           ; SOURCE LINE # 468
                                           ; SOURCE LINE # 469
0015 120000      R     LCALL   L?0123
0018 900000      E     MOV     DPTR,#RPM2
001B EE                MOV     A,R6
001C F0                MOVX    @DPTR,A
001D A3                INC     DPTR
001E EF                MOV     A,R7
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 470
0020 8013              SJMP    ?C0055
0022         ?C0053:
                                           ; SOURCE LINE # 472
                                           ; SOURCE LINE # 473
0022 900000      E     MOV     DPTR,#RPM2
0025 741B              MOV     A,#01BH
0027 F0                MOVX    @DPTR,A
0028 A3                INC     DPTR
0029 7458              MOV     A,#058H
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 474
                                           ; SOURCE LINE # 475
002C 8007              SJMP    ?C0055
002E         ?C0051:
                                           ; SOURCE LINE # 477
                                           ; SOURCE LINE # 478
002E E4                CLR     A
002F 900000      E     MOV     DPTR,#RPM2
0032 F0                MOVX    @DPTR,A
0033 A3                INC     DPTR
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 479
0035         ?C0055:
                                           ; SOURCE LINE # 481
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 29  

0035 900000      E     MOV     DPTR,#RPM2
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
003A A3                INC     DPTR
003B E0                MOVX    A,@DPTR
003C 900000      E     MOV     DPTR,#FAN2_CurrentRPM
003F CF                XCH     A,R7
0040 F0                MOVX    @DPTR,A
0041 A3                INC     DPTR
0042 EF                MOV     A,R7
0043 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 482
0044 22                RET     
             ; FUNCTION GetRPM2 (END)

             ; FUNCTION FanManager (BEGIN)
                                           ; SOURCE LINE # 489
                                           ; SOURCE LINE # 490
                                           ; SOURCE LINE # 491
0000 900000      E     MOV     DPTR,#FanFullOnCont
0003 E0                MOVX    A,@DPTR
0004 6003              JZ      ?C0057
                                           ; SOURCE LINE # 492
                                           ; SOURCE LINE # 493
0006 020000      R     LJMP    ?C0107
                                           ; SOURCE LINE # 495
0009         ?C0057:
                                           ; SOURCE LINE # 499
0009 900000      E     MOV     DPTR,#DebugFan1RPMT
000C E0                MOVX    A,@DPTR
000D 6006              JZ      ?C0060
000F 900000      E     MOV     DPTR,#DebugFan2RPMT
0012 E0                MOVX    A,@DPTR
0013 7029              JNZ     ?C0059
0015         ?C0060:
0015 900000      E     MOV     DPTR,#DebugFanStatus
0018 E0                MOVX    A,@DPTR
0019 20E022            JB      ACC.0,?C0059
                                           ; SOURCE LINE # 500
                                           ; SOURCE LINE # 501
001C 900000      E     MOV     DPTR,#Fan1RPM
001F E0                MOVX    A,@DPTR
0020 7006              JNZ     ?C0062
0022 900000      E     MOV     DPTR,#Fan2RPM
0025 E0                MOVX    A,@DPTR
0026 6003              JZ      ?C0061
0028         ?C0062:
                                           ; SOURCE LINE # 502
0028 020000      R     LJMP    FanControl
002B         ?C0061:
                                           ; SOURCE LINE # 504
                                           ; SOURCE LINE # 505
002B 900000      E     MOV     DPTR,#DCR4
002E E0                MOVX    A,@DPTR
002F 7003              JNZ     $ + 5H
0031 020000      R     LJMP    ?C0058
                                           ; SOURCE LINE # 506
                                           ; SOURCE LINE # 507
0034 E4                CLR     A
0035 900000      E     MOV     DPTR,#RPM1
0038 F0                MOVX    @DPTR,A
0039 A3                INC     DPTR
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 30  

003A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 508
003B 020000      R     LJMP    FanFullOff
                                           ; SOURCE LINE # 509
                                           ; SOURCE LINE # 510
                                           ; SOURCE LINE # 517
003E         ?C0059:
                                           ; SOURCE LINE # 519
                                           ; SOURCE LINE # 520
003E 900000      E     MOV     DPTR,#DebugFanStatus
0041 E0                MOVX    A,@DPTR
0042 4401              ORL     A,#01H
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 521
0045 900000      E     MOV     DPTR,#DebugFan1RPMT
0048 E0                MOVX    A,@DPTR
0049 7016              JNZ     ?C0066
004B 900000      E     MOV     DPTR,#DebugFan2RPMT
004E E0                MOVX    A,@DPTR
004F 7010              JNZ     ?C0066
                                           ; SOURCE LINE # 522
                                           ; SOURCE LINE # 523
0051 900000      E     MOV     DPTR,#DCR4
0054 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 524
0055 900000      E     MOV     DPTR,#DCR7
0058 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 525
0059 900000      E     MOV     DPTR,#DebugFanStatus
005C E0                MOVX    A,@DPTR
005D 54FE              ANL     A,#0FEH
005F F0                MOVX    @DPTR,A
0060 22                RET     
                                           ; SOURCE LINE # 527
0061         ?C0066:
                                           ; SOURCE LINE # 529
0061 900000      E     MOV     DPTR,#RPM1
0064 E0                MOVX    A,@DPTR
0065 7002              JNZ     ?C0103
0067 A3                INC     DPTR
0068 E0                MOVX    A,@DPTR
0069         ?C0103:
0069 7005              JNZ     ?C0067
                                           ; SOURCE LINE # 530
                                           ; SOURCE LINE # 531
006B 900000      E     MOV     DPTR,#DCR4
                                           ; SOURCE LINE # 532
006E 800D              SJMP    ?C0108
0070         ?C0067:
                                           ; SOURCE LINE # 533
0070 900000      E     MOV     DPTR,#RPM2
0073 E0                MOVX    A,@DPTR
0074 7002              JNZ     ?C0104
0076 A3                INC     DPTR
0077 E0                MOVX    A,@DPTR
0078         ?C0104:
0078 7007              JNZ     ?C0069
                                           ; SOURCE LINE # 534
                                           ; SOURCE LINE # 535
007A 900000      E     MOV     DPTR,#DCR7
007D         ?C0108:
007D 7414              MOV     A,#014H
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 31  

007F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 536
0080 22                RET     
0081         ?C0069:
                                           ; SOURCE LINE # 538
                                           ; SOURCE LINE # 539
0081 900000      E     MOV     DPTR,#DebugFan1RPMT
0084 E0                MOVX    A,@DPTR
0085 75F064            MOV     B,#064H
0088 A4                MUL     AB
0089 249C              ADD     A,#09CH
008B FF                MOV     R7,A
008C E5F0              MOV     A,B
008E 34FF              ADDC    A,#0FFH
0090 FE                MOV     R6,A
0091 C3                CLR     C
0092 900000      E     MOV     DPTR,#RPM1+01H
0095 E0                MOVX    A,@DPTR
0096 9F                SUBB    A,R7
0097 900000      E     MOV     DPTR,#RPM1
009A E0                MOVX    A,@DPTR
009B 9E                SUBB    A,R6
009C 500E              JNC     ?C0071
                                           ; SOURCE LINE # 540
                                           ; SOURCE LINE # 541
009E 900000      E     MOV     DPTR,#DCR4
00A1 E0                MOVX    A,@DPTR
00A2 C3                CLR     C
00A3 943F              SUBB    A,#03FH
00A5 501E              JNC     ?C0073
                                           ; SOURCE LINE # 542
00A7 E0                MOVX    A,@DPTR
00A8 04                INC     A
00A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 543
00AA 8019              SJMP    ?C0073
00AC         ?C0071:
                                           ; SOURCE LINE # 544
00AC 900000      E     MOV     DPTR,#DebugFan1RPMT
00AF 120000      R     LCALL   L?0119
00B2 900000      E     MOV     DPTR,#RPM1
00B5 E0                MOVX    A,@DPTR
00B6 9E                SUBB    A,R6
00B7 400C              JC      ?C0073
                                           ; SOURCE LINE # 545
                                           ; SOURCE LINE # 546
00B9 900000      E     MOV     DPTR,#DCR4
00BC E0                MOVX    A,@DPTR
00BD D3                SETB    C
00BE 9400              SUBB    A,#00H
00C0 4003              JC      ?C0073
                                           ; SOURCE LINE # 547
00C2 E0                MOVX    A,@DPTR
00C3 14                DEC     A
00C4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 548
00C5         ?C0073:
                                           ; SOURCE LINE # 550
00C5 900000      E     MOV     DPTR,#DebugFan2RPMT
00C8 120000      R     LCALL   L?0117
00CB 900000      E     MOV     DPTR,#RPM2
00CE E0                MOVX    A,@DPTR
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 32  

00CF 9E                SUBB    A,R6
00D0 500D              JNC     ?C0076
                                           ; SOURCE LINE # 551
                                           ; SOURCE LINE # 552
00D2 900000      E     MOV     DPTR,#DCR7
00D5 E0                MOVX    A,@DPTR
00D6 C3                CLR     C
00D7 943F              SUBB    A,#03FH
00D9 502C              JNC     ?C0058
                                           ; SOURCE LINE # 553
00DB E0                MOVX    A,@DPTR
00DC 04                INC     A
00DD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 554
00DE 22                RET     
00DF         ?C0076:
                                           ; SOURCE LINE # 555
00DF 900000      E     MOV     DPTR,#DebugFan2RPMT
00E2 E0                MOVX    A,@DPTR
00E3 75F064            MOV     B,#064H
00E6 A4                MUL     AB
00E7 2464              ADD     A,#064H
00E9 FF                MOV     R7,A
00EA E4                CLR     A
00EB 35F0              ADDC    A,B
00ED FE                MOV     R6,A
00EE D3                SETB    C
00EF 900000      E     MOV     DPTR,#RPM2+01H
00F2 E0                MOVX    A,@DPTR
00F3 9F                SUBB    A,R7
00F4 900000      E     MOV     DPTR,#RPM2
00F7 E0                MOVX    A,@DPTR
00F8 9E                SUBB    A,R6
00F9 400C              JC      ?C0058
                                           ; SOURCE LINE # 556
                                           ; SOURCE LINE # 557
00FB 900000      E     MOV     DPTR,#DCR7
00FE E0                MOVX    A,@DPTR
00FF D3                SETB    C
0100 9400              SUBB    A,#00H
0102 4003              JC      ?C0058
                                           ; SOURCE LINE # 558
0104         ?C0107:
0104 E0                MOVX    A,@DPTR
0105 14                DEC     A
0106 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 559
                                           ; SOURCE LINE # 560
                                           ; SOURCE LINE # 561
                                           ; SOURCE LINE # 562
0107         ?C0058:
0107 22                RET     
             ; FUNCTION FanManager (END)

             ; FUNCTION MoniterTemprature (BEGIN)
                                           ; SOURCE LINE # 579
                                           ; SOURCE LINE # 580
                                           ; SOURCE LINE # 581
0000 900000      E     MOV     DPTR,#Debugtemperature1
0003 E0                MOVX    A,@DPTR
0004 6002              JZ      ?C0081
                                           ; SOURCE LINE # 582
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 33  

0006 8003              SJMP    ?C0109
0008         ?C0081:
                                           ; SOURCE LINE # 584
0008 900000      E     MOV     DPTR,#CpuTm
000B         ?C0109:
000B E0                MOVX    A,@DPTR
000C 900000      E     MOV     DPTR,#TCPU_temp
000F F0                MOVX    @DPTR,A
0010         ?C0082:
                                           ; SOURCE LINE # 586
0010 900000      E     MOV     DPTR,#TCPU_temp
0013 E0                MOVX    A,@DPTR
0014 C3                CLR     C
0015 9457              SUBB    A,#057H
0017 4009              JC      ?C0083
                                           ; SOURCE LINE # 587
                                           ; SOURCE LINE # 588
0019 900000      E     MOV     DPTR,#Oem_Globe_Flag1
001C E0                MOVX    A,@DPTR
001D 4410              ORL     A,#010H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 590
0020 8010              SJMP    ?C0084
0022         ?C0083:
                                           ; SOURCE LINE # 591
0022 900000      E     MOV     DPTR,#TCPU_temp
0025 E0                MOVX    A,@DPTR
0026 D3                SETB    C
0027 944D              SUBB    A,#04DH
0029 5007              JNC     ?C0084
                                           ; SOURCE LINE # 592
                                           ; SOURCE LINE # 593
002B 900000      E     MOV     DPTR,#Oem_Globe_Flag1
002E E0                MOVX    A,@DPTR
002F 54EF              ANL     A,#0EFH
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 595
0032         ?C0084:
                                           ; SOURCE LINE # 598
0032 900000      E     MOV     DPTR,#TCPU_temp
0035 E0                MOVX    A,@DPTR
0036 C3                CLR     C
0037 9459              SUBB    A,#059H
0039 4035              JC      ?C0086
                                           ; SOURCE LINE # 599
                                           ; SOURCE LINE # 600
003B 900000      E     MOV     DPTR,#CPU_TooHot_Cnt
003E E0                MOVX    A,@DPTR
003F 04                INC     A
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 601
0041 E0                MOVX    A,@DPTR
0042 D3                SETB    C
0043 9403              SUBB    A,#03H
0045 402E              JC      ?C0091
                                           ; SOURCE LINE # 602
                                           ; SOURCE LINE # 603
0047 900000      E     MOV     DPTR,#TCPU_temp
004A E0                MOVX    A,@DPTR
004B FF                MOV     R7,A
004C 120000      E     LCALL   _BRAMDebug
                                           ; SOURCE LINE # 605
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 34  

004F 900000      E     MOV     DPTR,#OEM_Debug_flag+01H
0052 E0                MOVX    A,@DPTR
0053 4401              ORL     A,#01H
0055 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 607
0056 900000      E     MOV     DPTR,#BRAM_OEM+04H
0059 7455              MOV     A,#055H
005B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 608
005C 900000      E     MOV     DPTR,#ETWCFG
005F 7420              MOV     A,#020H
0061 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 609
0062 900000      E     MOV     DPTR,#EWDCNTLR
0065 7401              MOV     A,#01H
0067 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 610
0068 900000      E     MOV     DPTR,#EWDKEYR
006B 745A              MOV     A,#05AH
006D F0                MOVX    @DPTR,A
006E         ?C0088:
                                           ; SOURCE LINE # 611
006E 80FE              SJMP    ?C0088
                                           ; SOURCE LINE # 612
                                           ; SOURCE LINE # 613
0070         ?C0086:
                                           ; SOURCE LINE # 615
                                           ; SOURCE LINE # 616
0070 E4                CLR     A
0071 900000      E     MOV     DPTR,#CPU_TooHot_Cnt
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 617
                                           ; SOURCE LINE # 618
0075         ?C0091:
0075 22                RET     
             ; FUNCTION MoniterTemprature (END)

             ; FUNCTION InitThermalChip (BEGIN)
                                           ; SOURCE LINE # 671
                                           ; SOURCE LINE # 672
                                           ; SOURCE LINE # 674
0000 900000      R     MOV     DPTR,#LimitTm
0003 747D              MOV     A,#07DH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 675
0006 900000      E     MOV     DPTR,#TmToSensor
0009 74FF              MOV     A,#0FFH
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 678
                                           ; SOURCE LINE # 679
                                           ; SOURCE LINE # 681
000C 120000      R     LCALL   L?0110
000F EF                MOV     A,R7
0010 6015              JZ      ?C0092
                                           ; SOURCE LINE # 682
0012 120000      R     LCALL   L?0128
0015 7010              JNZ     ?C0092
                                           ; SOURCE LINE # 683
0017 120000      R     LCALL   L?0116
001A EF                MOV     A,R7
001B 600A              JZ      ?C0092
                                           ; SOURCE LINE # 684
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 35  

001D 120000      R     LCALL   L?0128
0020 7005              JNZ     ?C0092
                                           ; SOURCE LINE # 685
0022 900000      E     MOV     DPTR,#TmToSensor
0025 EF                MOV     A,R7
0026 F0                MOVX    @DPTR,A
0027         ?C0092:
                                           ; SOURCE LINE # 687
0027 900000      E     MOV     DPTR,#TmToSensor
002A E0                MOVX    A,@DPTR
002B F4                CPL     A
002C 7039              JNZ     ?C0102
                                           ; SOURCE LINE # 688
                                           ; SOURCE LINE # 689
002E 120000      R     LCALL   L?0126
0031 7D08              MOV     R5,#08H
0033 7F01              MOV     R7,#01H
0035 120000      E     LCALL   _bRWSMBus
0038 EF                MOV     A,R7
0039 602C              JZ      ?C0102
                                           ; SOURCE LINE # 690
                                           ; SOURCE LINE # 691
003B 900000      R     MOV     DPTR,#ReadData
003E E0                MOVX    A,@DPTR
003F 4402              ORL     A,#02H
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 692
0042 120000      R     LCALL   L?0126
0045 7D88              MOV     R5,#088H
0047 7F01              MOV     R7,#01H
0049 120000      E     LCALL   _bRWSMBus
                                           ; SOURCE LINE # 694
                                           ; SOURCE LINE # 695
                                           ; SOURCE LINE # 697
004C 120000      R     LCALL   L?0110
004F EF                MOV     A,R7
0050 6015              JZ      ?C0102
                                           ; SOURCE LINE # 698
0052 120000      R     LCALL   L?0129
0055 7010              JNZ     ?C0102
                                           ; SOURCE LINE # 699
0057 120000      R     LCALL   L?0116
005A EF                MOV     A,R7
005B 600A              JZ      ?C0102
                                           ; SOURCE LINE # 700
005D 120000      R     LCALL   L?0129
0060 7005              JNZ     ?C0102
                                           ; SOURCE LINE # 701
0062 900000      E     MOV     DPTR,#TmToSensor
0065 EF                MOV     A,R7
0066 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 702
                                           ; SOURCE LINE # 703
                                           ; SOURCE LINE # 704
0067         ?C0102:
0067 22                RET     
0068         L?0110:
0068 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
006B 7419              MOV     A,#019H
006D F0                MOVX    @DPTR,A
006E A3                INC     DPTR
006F 7400        R     MOV     A,#HIGH LimitTm
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 36  

0071 F0                MOVX    @DPTR,A
0072 A3                INC     DPTR
0073 7400        R     MOV     A,#LOW LimitTm
0075 F0                MOVX    @DPTR,A
0076 E4                CLR     A
0077 A3                INC     DPTR
0078 F0                MOVX    @DPTR,A
0079 7B98              MOV     R3,#098H
007B 7D88              MOV     R5,#088H
007D 7F01              MOV     R7,#01H
007F 120000      E     LCALL   _bRWSMBus
0082 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
0085 7420              MOV     A,#020H
0087 F0                MOVX    @DPTR,A
0088 A3                INC     DPTR
0089 7400        R     MOV     A,#HIGH LimitTm
008B F0                MOVX    @DPTR,A
008C A3                INC     DPTR
008D 7400        R     MOV     A,#LOW LimitTm
008F F0                MOVX    @DPTR,A
0090 E4                CLR     A
0091 A3                INC     DPTR
0092 F0                MOVX    @DPTR,A
0093 7B98              MOV     R3,#098H
0095 7D88              MOV     R5,#088H
0097 7F01              MOV     R7,#01H
0099 120000      E     LCALL   _bRWSMBus
009C 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
009F 7419              MOV     A,#019H
00A1 F0                MOVX    @DPTR,A
00A2 A3                INC     DPTR
00A3 7400        R     MOV     A,#HIGH ReadData
00A5 F0                MOVX    @DPTR,A
00A6 A3                INC     DPTR
00A7 7400        R     MOV     A,#LOW ReadData
00A9 F0                MOVX    @DPTR,A
00AA E4                CLR     A
00AB A3                INC     DPTR
00AC F0                MOVX    @DPTR,A
00AD 7B98              MOV     R3,#098H
00AF 7D08              MOV     R5,#08H
00B1 7F01              MOV     R7,#01H
00B3 120000      E     LCALL   _bRWSMBus
00B6 22                RET     
00B7         L?0116:
00B7 900000      E     MOV     DPTR,#?_bRWSMBus?BYTE+03H
00BA 7420              MOV     A,#020H
00BC F0                MOVX    @DPTR,A
00BD A3                INC     DPTR
00BE 7400        R     MOV     A,#HIGH ReadData
00C0 F0                MOVX    @DPTR,A
00C1 A3                INC     DPTR
00C2 7400        R     MOV     A,#LOW ReadData
00C4 F0                MOVX    @DPTR,A
00C5 E4                CLR     A
00C6 A3                INC     DPTR
00C7 F0                MOVX    @DPTR,A
00C8 7B98              MOV     R3,#098H
00CA 7D08              MOV     R5,#08H
00CC 7F01              MOV     R7,#01H
00CE 120000      E     LCALL   _bRWSMBus
00D1 22                RET     
C51 COMPILER V7.50   OEM_FAN                                                               09/08/2020 15:56:21 PAGE 37  

             ; FUNCTION InitThermalChip (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1732    ----
   CONSTANT SIZE    =    144    ----
   XDATA SIZE       =   ----      10
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
